This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.env.example
.gitignore
ì¶”ê°€ë¡œ í•„ìš”í•œê²ƒ.txt
ai-music-backend/app-5.7.1/bin/Audiveris
ai-music-backend/app-5.7.1/bin/Audiveris.bat
ai-music-backend/app-5.7.1/lib/angus-activation-2.0.2.jar
ai-music-backend/app-5.7.1/lib/args4j-2.33.jar
ai-music-backend/app-5.7.1/lib/audiveris.jar
ai-music-backend/app-5.7.1/lib/bsaf-1.9.2.jar
ai-music-backend/app-5.7.1/lib/commons-io-2.8.0.jar
ai-music-backend/app-5.7.1/lib/commons-lang3-3.9.jar
ai-music-backend/app-5.7.1/lib/commons-logging-1.3.4.jar
ai-music-backend/app-5.7.1/lib/eventbus-1.4.jar
ai-music-backend/app-5.7.1/lib/fontbox-3.0.4.jar
ai-music-backend/app-5.7.1/lib/github-api-1.301.jar
ai-music-backend/app-5.7.1/lib/ij-1.53j.jar
ai-music-backend/app-5.7.1/lib/istack-commons-runtime-4.1.2.jar
ai-music-backend/app-5.7.1/lib/itextpdf-5.5.13.2.jar
ai-music-backend/app-5.7.1/lib/jackson-annotations-2.13.0.jar
ai-music-backend/app-5.7.1/lib/jackson-core-2.13.0.jar
ai-music-backend/app-5.7.1/lib/jackson-databind-2.13.0.jar
ai-music-backend/app-5.7.1/lib/jai-core-1.1.3.jar
ai-music-backend/app-5.7.1/lib/jai-imageio-core-1.4.0.jar
ai-music-backend/app-5.7.1/lib/jai-imageio-jpeg2000-1.4.0.jar
ai-music-backend/app-5.7.1/lib/jakarta.activation-api-2.1.3.jar
ai-music-backend/app-5.7.1/lib/jakarta.xml.bind-api-4.0.2.jar
ai-music-backend/app-5.7.1/lib/jama-1.0.3.jar
ai-music-backend/app-5.7.1/lib/javacpp-1.5.12.jar
ai-music-backend/app-5.7.1/lib/javassist-3.28.0-GA.jar
ai-music-backend/app-5.7.1/lib/javax.activation-api-1.2.0.jar
ai-music-backend/app-5.7.1/lib/jaxb-api-2.3.1.jar
ai-music-backend/app-5.7.1/lib/jaxb-core-2.3.0.1.jar
ai-music-backend/app-5.7.1/lib/jaxb-core-4.0.5.jar
ai-music-backend/app-5.7.1/lib/jaxb-impl-2.3.1.jar
ai-music-backend/app-5.7.1/lib/jaxb-runtime-4.0.5.jar
ai-music-backend/app-5.7.1/lib/jbig2-imageio-3.0.4.jar
ai-music-backend/app-5.7.1/lib/jcip-annotations-1.0.jar
ai-music-backend/app-5.7.1/lib/jfreechart-1.5.3.jar
ai-music-backend/app-5.7.1/lib/jgoodies-common-1.8.1.jar
ai-music-backend/app-5.7.1/lib/jgoodies-forms-1.9.0.jar
ai-music-backend/app-5.7.1/lib/jgoodies-looks-2.7.0.jar
ai-music-backend/app-5.7.1/lib/jgrapht-core-1.5.1.jar
ai-music-backend/app-5.7.1/lib/jheaps-0.13.jar
ai-music-backend/app-5.7.1/lib/jsr305-3.0.2.jar
ai-music-backend/app-5.7.1/lib/leptonica-1.85.0-1.5.12-windows-x86_64.jar
ai-music-backend/app-5.7.1/lib/leptonica-1.85.0-1.5.12.jar
ai-music-backend/app-5.7.1/lib/logback-classic-1.4.14.jar
ai-music-backend/app-5.7.1/lib/logback-core-1.4.14.jar
ai-music-backend/app-5.7.1/lib/org.apache.commons.io-2.4.jar
ai-music-backend/app-5.7.1/lib/pdfbox-3.0.4.jar
ai-music-backend/app-5.7.1/lib/pdfbox-io-3.0.4.jar
ai-music-backend/app-5.7.1/lib/proxymusic-4.0.3.jar
ai-music-backend/app-5.7.1/lib/reflections-0.10.2.jar
ai-music-backend/app-5.7.1/lib/slf4j-api-2.0.16.jar
ai-music-backend/app-5.7.1/lib/tesseract-5.5.1-1.5.12-windows-x86_64.jar
ai-music-backend/app-5.7.1/lib/tesseract-5.5.1-1.5.12.jar
ai-music-backend/app-5.7.1/lib/txw2-4.0.5.jar
ai-music-backend/generated_midi/00fe626c-add6-481b-b249-e266359047b3.mid
ai-music-backend/generated_midi/193064a0-1c2c-4fb6-925c-8736d38d313d.mid
ai-music-backend/generated_midi/4abb3f6b-c1d5-42b9-a488-f954c03a6d22.mid
ai-music-backend/generated_midi/4d9e9cc2-280f-4306-9d7a-08386d33240b.mid
ai-music-backend/generated_midi/54771ea9-055e-4ee5-b5a2-a27b28a9e29a.mid
ai-music-backend/generated_midi/6943ea14-61c5-420a-9d98-c6110137abe5.mid
ai-music-backend/generated_midi/696443f2-a5b2-47a1-bd16-47ad14eaa565.mid
ai-music-backend/generated_midi/6b8308be-1527-4a8b-8088-47bf5b80d43b.mid
ai-music-backend/generated_midi/6d739e76-df0b-47e0-a1a9-0831d101db77.mid
ai-music-backend/generated_midi/72bb7ca3-eff0-4d15-a616-74af6f4eaf92.mid
ai-music-backend/generated_midi/7504e681-2fb6-49f6-8447-875aa4cdd846.mid
ai-music-backend/generated_midi/7504e681-2fb6-49f6-8447-875aa4cdd846.wav
ai-music-backend/generated_midi/7f66f13b-9865-4a02-be0d-84d995775f6b.mid
ai-music-backend/generated_midi/8376aae8-ea9f-45a3-85a9-576722cf36c1.mid
ai-music-backend/generated_midi/84115a81-8316-4b0d-9599-2af287154198.mid
ai-music-backend/generated_midi/8f1784f5-0610-45ae-a459-537aadb4deab.mid
ai-music-backend/generated_midi/91dbe5ae-15d9-412d-96aa-8261ad069e02.mid
ai-music-backend/generated_midi/91dbe5ae-15d9-412d-96aa-8261ad069e02.wav
ai-music-backend/generated_midi/93a1ac25-1a71-4d3f-bb0c-7ab4cd835914.mid
ai-music-backend/generated_midi/b396da51-ce15-4f4b-8c23-41a7529d3040.mid
ai-music-backend/generated_midi/b6ae5825-9742-4db6-bae1-7e99765c2d57.mid
ai-music-backend/generated_midi/be32e1ec-6534-462d-8b32-fb687a789af0.mid
ai-music-backend/generated_midi/be32e1ec-6534-462d-8b32-fb687a789af0.wav
ai-music-backend/generated_midi/fb8eb1f2-415e-4744-a52e-a0a13cfd237a.mid
ai-music-backend/requirements.txt
ai-music-backend/server.py
ai-music-backend/temp_scores/0f23714a-e99e-426c-a52a-b8a43f6f97f7.pdf
ai-music-backend/temp_scores/2f1e0fa0-bb71-47b6-b7f6-fe2c0bfb5a65.pdf
ai-music-backend/temp_scores/373c8952-b353-4010-ac47-8049d1a7bb93.pdf
ai-music-backend/temp_scores/375127be-ff48-44f1-a8ff-317bc79021e3.pdf
ai-music-backend/temp_scores/37a9c5f0-9780-4fb2-a7d0-6d0ea0279199.pdf
ai-music-backend/temp_scores/3f7e6083-88af-4c2d-a11d-a9882da2082e.pdf
ai-music-backend/temp_scores/5a4e98fd-304a-4fec-aed2-20f2a233868a.pdf
ai-music-backend/temp_scores/6c754529-4cb7-4eef-8ec4-6ebbf02fc6bb.pdf
ai-music-backend/temp_scores/8366990d-1e37-4875-bd48-c67601412e15.pdf
ai-music-backend/temp_scores/838591e9-05a4-4555-b308-68dc929fe168.mxl
ai-music-backend/temp_scores/838591e9-05a4-4555-b308-68dc929fe168.pdf
ai-music-backend/temp_scores/8d7fc51f-f638-47c3-b6d8-985cc837227f.pdf
ai-music-backend/temp_scores/8fdb4e6b-264e-4153-9ca2-5694bf2a9250.pdf
ai-music-backend/temp_scores/a06adf5a-57ad-437d-821f-9999c064b436.pdf
ai-music-backend/temp_scores/b003e4cc-d541-40ad-a97d-04961b8d9da3.pdf
ai-music-backend/temp_scores/cca4b819-70c0-4b23-9e83-7f5638baa2b7.mxl
ai-music-backend/temp_scores/cca4b819-70c0-4b23-9e83-7f5638baa2b7.pdf
ai-music-backend/temp_scores/d05d2fed-a0e1-4aa2-9cae-114785e60add.pdf
ai-music-backend/temp_scores/daf87e00-863c-4bbb-a021-3110678e2943.mxl
ai-music-backend/temp_scores/daf87e00-863c-4bbb-a021-3110678e2943.pdf
ai-music-backend/temp_scores/db0875a6-aa17-4097-b691-d18e1ab98678.pdf
ai-music-backend/temp_scores/ebd9490f-b2ec-4002-957f-fbe36847330a.pdf
docs/firebase-integration-plan.md
images/screenshot.png
package.json
PROJECT_DOCUMENTATION.md
public/favicon.ico
public/images/genres/citypop.jpg
public/images/genres/classic.jpg
public/images/genres/edm.jpg
public/images/genres/jazz.jpg
public/images/genres/lofi.jpg
public/images/genres/README.txt
public/index.html
public/logo192.png
public/logo512.png
public/manifest.json
public/robots.txt
public/samples/505/crash.mp3
public/samples/505/hat-close.mp3
public/samples/505/hat-open.mp3
public/samples/505/kick.mp3
public/samples/505/ride.mp3
public/samples/505/snare.mp3
public/samples/505/tom-high.mp3
public/samples/505/tom-low.mp3
public/samples/505/tom-mid.mp3
README.md
src/App.css
src/App.js
src/App.test.js
src/components/beat/BeatGrid.jsx
src/components/beat/BlendPad.jsx
src/components/beat/BlendPadCanvas.jsx
src/components/beat/BlendPadGhostLayer.jsx
src/components/beat/PadToolbar.jsx
src/components/beat/PathOverlay.jsx
src/components/beat/presets.js
src/components/beat/SampleKit.js
src/components/beat/SimpleBlendPad.jsx
src/components/beat/TransportBar.jsx
src/components/common/AudioWaveform.js
src/components/common/GenreCardSelector.js
src/components/common/GenreSelector.js
src/components/common/MoodSelector.js
src/components/common/RequireAuth.jsx
src/components/layout/Navbar.js
src/context/MusicContext.js
src/hooks/useCellGrid.js
src/hooks/useLerpTween.js
src/hooks/usePathMode.js
src/index.css
src/index.js
src/lib/beatblender/cellCache.js
src/lib/beatblender/color.js
src/lib/beatblender/coords.js
src/lib/beatblender/gradients.extras.js
src/lib/beatblender/previewRender.js
src/lib/drumsVAE.js
src/lib/firebase.js
src/lib/magentaCompat.js
src/lib/toneCompat.js
src/logo.svg
src/pages/Auth.js
src/pages/Library.js
src/pages/MusicConversion.js
src/pages/MusicGeneration.js
src/pages/ResultPage.js
src/pages/ScoreToMusic.js
src/polyfills.js
src/reportWebVitals.js
src/services/libraryApi.js
src/services/libraryWriter.js
src/services/musicApi.js
src/setupTests.js
src/state/beatPadStore.js
src/styles/beatpad.css
src/utils/audioExport.js
UI_UX_DESIGN.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="ì¶”ê°€ë¡œ í•„ìš”í•œê²ƒ.txt">
FluidR3_GM ë‹¤ìš´ -> C:\soundfonts\FluidR3_GM.sf2
fluidsynth ë‹¤ìš´ https://github.com/FluidSynth/fluidsynth/releases/tag/v2.3.7 

ì‹œìŠ¤í…œ ë³€ìˆ˜ í™˜ê²½ë³€ìˆ˜ ì¶”ê°€ Path->C:\Program Files\fluidsynth\bin
</file>

<file path="src/components/beat/SimpleBlendPad.jsx">
// src/components/beat/SimpleBlendPad.jsx
import React, { useEffect, useRef, useState } from 'react';

export default function SimpleBlendPad({
  width = 420,
  height = 420,
  grid = 16,             // 16x16 ê²©ìì„ 
  initial = { x: 0.5, y: 0.5 },
  onChange,              // (x01, y01) ì½œë°±
}) {
  const canvasRef = useRef(null);
  const [pos, setPos] = useState(initial);
  const [dragging, setDragging] = useState(false);

  const draw = () => {
    const cvs = canvasRef.current;
    if (!cvs) return;
    const ctx = cvs.getContext('2d');
    const w = cvs.width;
    const h = cvs.height;

    // ë°°ê²½
    ctx.clearRect(0, 0, w, h);
    // ì€ì€í•œ ë°°ê²½ ê·¸ë¼ë””ì–¸íŠ¸(ì¢Œìƒâ†”ìš°í•˜)
    const grad = ctx.createLinearGradient(0, 0, w, h);
    grad.addColorStop(0, '#111826');  // ì¢Œìƒ
    grad.addColorStop(1, '#10211e');  // ìš°í•˜
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, w, h);

    // ê²©ì
    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
    ctx.lineWidth = 1;
    const stepX = w / grid;
    const stepY = h / grid;
    for (let i = 0; i <= grid; i++) {
      ctx.beginPath();
      ctx.moveTo(i * stepX + 0.5, 0);
      ctx.lineTo(i * stepX + 0.5, h);
      ctx.stroke();
    }
    for (let j = 0; j <= grid; j++) {
      ctx.beginPath();
      ctx.moveTo(0, j * stepY + 0.5);
      ctx.lineTo(w, j * stepY + 0.5);
      ctx.stroke();
    }

    // í½
    const px = pos.x * w;
    const py = pos.y * h;
    ctx.beginPath();
    ctx.arc(px, py, 10, 0, Math.PI * 2);
    ctx.fillStyle = '#2DD4BF';
    ctx.fill();

    // êµì°¨ì„ 
    ctx.strokeStyle = 'rgba(45, 212, 191, 0.25)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(px, 0);
    ctx.lineTo(px, h);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(0, py);
    ctx.lineTo(w, py);
    ctx.stroke();
  };

  useEffect(draw, [pos, width, height, grid]);

  const getXY01 = (e) => {
    const rect = e.currentTarget.getBoundingClientRect();
    const x = Math.min(Math.max((e.clientX - rect.left) / rect.width, 0), 1);
    const y = Math.min(Math.max((e.clientY - rect.top) / rect.height, 0), 1);
    return { x, y };
  };

  const start = (e) => {
    setDragging(true);
    const p = getXY01(e);
    setPos(p);
    onChange?.(p.x, p.y);
  };
  const move = (e) => {
    if (!dragging) return;
    const p = getXY01(e);
    setPos(p);
    onChange?.(p.x, p.y);
  };
  const end = () => setDragging(false);

  return (
    <canvas
      ref={canvasRef}
      width={width}
      height={height}
      style={{
        width,
        height,
        borderRadius: 16,
        border: '1px solid #333',
        display: 'block',
        background: '#0b0b0b',
        boxShadow: 'inset 0 0 0 1px rgba(255,255,255,0.02)',
        cursor: 'crosshair',
      }}
      onMouseDown={start}
      onMouseMove={move}
      onMouseUp={end}
      onMouseLeave={end}
    />
  );
}
</file>

<file path=".env.example">
REACT_APP_API_BASE_URL=http://127.0.0.1:5000/api

# Firebase configuration
REACT_APP_FIREBASE_API_KEY=AIzaSyBQb-wItViVr7R0Ey89jPjBL4ihpxPXU9o
REACT_APP_FIREBASE_AUTH_DOMAIN=ai-music-lab-b0d74.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=ai-music-lab-b0d74
REACT_APP_FIREBASE_STORAGE_BUCKET=ai-music-lab-b0d74.firebasestorage.app
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=40739414852
REACT_APP_FIREBASE_APP_ID=1:40739414852:web:21b9c1eacdff7c460e6d11
REACT_APP_FIREBASE_MEASUREMENT_ID=
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/
# --- CRA ê¸°ë³¸ ---
/node_modules
/.pnp
.pnp.js

# testing
/coverage

# production
/build

# misc
.DS_Store
.env.local
.env.development.local
.env.test.local
.env.production.local
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# --- ì¶”ê°€: í”„ë¡ íŠ¸ì—”ë“œ ---
.env            # ë£¨íŠ¸ .env
*.env           # í˜¹ì‹œ ë‹¤ë¥¸ ì´ë¦„ì˜ env íŒŒì¼
*.log           # ê¸°íƒ€ ë¡œê·¸

# --- ì¶”ê°€: ë°±ì—”ë“œ(Flask) ---
ai-music-backend/.env
ai-music-backend/venv/
ai-music-backend/tmp/
ai-music-backend/static/audio/
ai-music-backend/__pycache__/
ai-music-backend/*.pyc

# --- ê³µí†µ íŒŒì´ì¬ ìºì‹œ ---
__pycache__/
*.pyc
</file>

<file path="ai-music-backend/app-5.7.1/bin/Audiveris">
#!/bin/sh

#
# Copyright Â© 2015-2021 the original authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

##############################################################################
#
#   Audiveris start up script for POSIX generated by Gradle.
#
#   Important for running:
#
#   (1) You need a POSIX-compliant shell to run this script. If your /bin/sh is
#       noncompliant, but you have some other compliant shell such as ksh or
#       bash, then to run this script, type that shell name before the whole
#       command line, like:
#
#           ksh Audiveris
#
#       Busybox and similar reduced shells will NOT work, because this script
#       requires all of these POSIX shell features:
#         * functions;
#         * expansions Â«$varÂ», Â«${var}Â», Â«${var:-default}Â», Â«${var+SET}Â»,
#           Â«${var#prefix}Â», Â«${var%suffix}Â», and Â«$( cmd )Â»;
#         * compound commands having a testable exit status, especially Â«caseÂ»;
#         * various built-in commands including Â«commandÂ», Â«setÂ», and Â«ulimitÂ».
#
#   Important for patching:
#
#   (2) This script targets any POSIX shell, so it avoids extensions provided
#       by Bash, Ksh, etc; in particular arrays are avoided.
#
#       The "traditional" practice of packing multiple parameters into a
#       space-separated string is a well documented source of bugs and security
#       problems, so this is (mostly) avoided, by progressively accumulating
#       options in "$@", and eventually passing that to Java.
#
#       Where the inherited environment variables (DEFAULT_JVM_OPTS, JAVA_OPTS,
#       and AUDIVERIS_OPTS) rely on word-splitting, this is performed explicitly;
#       see the in-line comments for details.
#
#       There are tweaks for specific operating systems such as AIX, CygWin,
#       Darwin, MinGW, and NonStop.
#
#   (3) This script is generated from the Groovy template
#       https://github.com/gradle/gradle/blob/HEAD/subprojects/plugins/src/main/resources/org/gradle/api/internal/plugins/unixStartScript.txt
#       within the Gradle project.
#
#       You can find Gradle at https://github.com/gradle/gradle/.
#
##############################################################################

# Attempt to set APP_HOME

# Resolve links: $0 may be a link
app_path=$0

# Need this for daisy-chained symlinks.
while
    APP_HOME=${app_path%"${app_path##*/}"}  # leaves a trailing /; empty if no leading path
    [ -h "$app_path" ]
do
    ls=$( ls -ld "$app_path" )
    link=${ls#*' -> '}
    case $link in             #(
      /*)   app_path=$link ;; #(
      *)    app_path=$APP_HOME$link ;;
    esac
done

# This is normally unused
# shellcheck disable=SC2034
APP_BASE_NAME=${0##*/}
# Discard cd standard output in case $CDPATH is set (https://github.com/gradle/gradle/issues/25036)
APP_HOME=$( cd "${APP_HOME:-./}.." > /dev/null && pwd -P ) || exit

# Use the maximum available, or set MAX_FD != -1 to use that value.
MAX_FD=maximum

warn () {
    echo "$*"
} >&2

die () {
    echo
    echo "$*"
    echo
    exit 1
} >&2

# OS specific support (must be 'true' or 'false').
cygwin=false
msys=false
darwin=false
nonstop=false
case "$( uname )" in                #(
  CYGWIN* )         cygwin=true  ;; #(
  Darwin* )         darwin=true  ;; #(
  MSYS* | MINGW* )  msys=true    ;; #(
  NONSTOP* )        nonstop=true ;;
esac

CLASSPATH=$APP_HOME/lib/audiveris.jar:$APP_HOME/lib/args4j-2.33.jar:$APP_HOME/lib/logback-classic-1.4.14.jar:$APP_HOME/lib/jai-imageio-jpeg2000-1.4.0.jar:$APP_HOME/lib/jai-imageio-core-1.4.0.jar:$APP_HOME/lib/itextpdf-5.5.13.2.jar:$APP_HOME/lib/jgoodies-forms-1.9.0.jar:$APP_HOME/lib/jgoodies-looks-2.7.0.jar:$APP_HOME/lib/jaxb-core-2.3.0.1.jar:$APP_HOME/lib/jaxb-impl-2.3.1.jar:$APP_HOME/lib/jama-1.0.3.jar:$APP_HOME/lib/jai-core-1.1.3.jar:$APP_HOME/lib/jaxb-api-2.3.1.jar:$APP_HOME/lib/ij-1.53j.jar:$APP_HOME/lib/jcip-annotations-1.0.jar:$APP_HOME/lib/org.apache.commons.io-2.4.jar:$APP_HOME/lib/jbig2-imageio-3.0.4.jar:$APP_HOME/lib/pdfbox-3.0.4.jar:$APP_HOME/lib/fontbox-3.0.4.jar:$APP_HOME/lib/pdfbox-io-3.0.4.jar:$APP_HOME/lib/proxymusic-4.0.3.jar:$APP_HOME/lib/eventbus-1.4.jar:$APP_HOME/lib/tesseract-5.5.1-1.5.12.jar:$APP_HOME/lib/tesseract-5.5.1-1.5.12-windows-x86_64.jar:$APP_HOME/lib/leptonica-1.85.0-1.5.12.jar:$APP_HOME/lib/leptonica-1.85.0-1.5.12-windows-x86_64.jar:$APP_HOME/lib/javacpp-1.5.12.jar:$APP_HOME/lib/bsaf-1.9.2.jar:$APP_HOME/lib/jfreechart-1.5.3.jar:$APP_HOME/lib/jgrapht-core-1.5.1.jar:$APP_HOME/lib/github-api-1.301.jar:$APP_HOME/lib/reflections-0.10.2.jar:$APP_HOME/lib/slf4j-api-2.0.16.jar:$APP_HOME/lib/logback-core-1.4.14.jar:$APP_HOME/lib/jgoodies-common-1.8.1.jar:$APP_HOME/lib/javax.activation-api-1.2.0.jar:$APP_HOME/lib/commons-io-2.8.0.jar:$APP_HOME/lib/commons-logging-1.3.4.jar:$APP_HOME/lib/jaxb-runtime-4.0.5.jar:$APP_HOME/lib/jaxb-core-4.0.5.jar:$APP_HOME/lib/jakarta.xml.bind-api-4.0.2.jar:$APP_HOME/lib/jheaps-0.13.jar:$APP_HOME/lib/commons-lang3-3.9.jar:$APP_HOME/lib/jackson-annotations-2.13.0.jar:$APP_HOME/lib/jackson-core-2.13.0.jar:$APP_HOME/lib/jackson-databind-2.13.0.jar:$APP_HOME/lib/javassist-3.28.0-GA.jar:$APP_HOME/lib/jsr305-3.0.2.jar:$APP_HOME/lib/angus-activation-2.0.2.jar:$APP_HOME/lib/jakarta.activation-api-2.1.3.jar:$APP_HOME/lib/txw2-4.0.5.jar:$APP_HOME/lib/istack-commons-runtime-4.1.2.jar


# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD=$JAVA_HOME/jre/sh/java
    else
        JAVACMD=$JAVA_HOME/bin/java
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD=java
    if ! command -v java >/dev/null 2>&1
    then
        die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
fi

# Increase the maximum file descriptors if we can.
if ! "$cygwin" && ! "$darwin" && ! "$nonstop" ; then
    case $MAX_FD in #(
      max*)
        # In POSIX sh, ulimit -H is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        MAX_FD=$( ulimit -H -n ) ||
            warn "Could not query maximum file descriptor limit"
    esac
    case $MAX_FD in  #(
      '' | soft) :;; #(
      *)
        # In POSIX sh, ulimit -n is undefined. That's why the result is checked to see if it worked.
        # shellcheck disable=SC2039,SC3045
        ulimit -n "$MAX_FD" ||
            warn "Could not set maximum file descriptor limit to $MAX_FD"
    esac
fi

# Collect all arguments for the java command, stacking in reverse order:
#   * args from the command line
#   * the main class name
#   * -classpath
#   * -D...appname settings
#   * --module-path (only if needed)
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, and AUDIVERIS_OPTS environment variables.

# For Cygwin or MSYS, switch paths to Windows format before running java
if "$cygwin" || "$msys" ; then
    APP_HOME=$( cygpath --path --mixed "$APP_HOME" )
    CLASSPATH=$( cygpath --path --mixed "$CLASSPATH" )

    JAVACMD=$( cygpath --unix "$JAVACMD" )

    # Now convert the arguments - kludge to limit ourselves to /bin/sh
    for arg do
        if
            case $arg in                                #(
              -*)   false ;;                            # don't mess with options #(
              /?*)  t=${arg#/} t=/${t%%/*}              # looks like a POSIX filepath
                    [ -e "$t" ] ;;                      #(
              *)    false ;;
            esac
        then
            arg=$( cygpath --path --ignore --mixed "$arg" )
        fi
        # Roll the args list around exactly as many times as the number of
        # args, so each arg winds up back in the position where it started, but
        # possibly modified.
        #
        # NB: a `for` loop captures its iteration list before it begins, so
        # changing the positional parameters here affects neither the number of
        # iterations, nor the values presented in `arg`.
        shift                   # remove old arg
        set -- "$@" "$arg"      # push replacement arg
    done
fi

# Start script customization ---

# Actual value for min_java_version is to be provided by script post-processing
min_java_version="24" 
java_version=$("$JAVACMD" -version 2>&1 | head -1 | cut -d'"' -f2 | sed 's/^1\.//' | cut -d'.' -f1)

if [ $java_version -lt $min_java_version ]
then
  die "Java $min_java_version or higher is required. You have version $java_version"
fi

# Stop script customization ---


# Add default JVM options here. You can also use JAVA_OPTS and AUDIVERIS_OPTS to pass JVM options to this script.
DEFAULT_JVM_OPTS='"--add-exports=java.desktop/sun.awt.image=ALL-UNNAMED" "--enable-native-access=ALL-UNNAMED"'

# Collect all arguments for the java command:
#   * DEFAULT_JVM_OPTS, JAVA_OPTS, JAVA_OPTS, and optsEnvironmentVar are not allowed to contain shell fragments,
#     and any embedded shellness will be escaped.
#   * For example: A user cannot expect ${Hostname} to be expanded, as it is an environment variable and will be
#     treated as '${Hostname}' itself on the command line.

set -- \
        -classpath "$CLASSPATH" \
        Audiveris \
        "$@"

# Stop when "xargs" is not available.
if ! command -v xargs >/dev/null 2>&1
then
    die "xargs is not available"
fi

# Use "xargs" to parse quoted args.
#
# With -n1 it outputs one arg per line, with the quotes and backslashes removed.
#
# In Bash we could simply go:
#
#   readarray ARGS < <( xargs -n1 <<<"$var" ) &&
#   set -- "${ARGS[@]}" "$@"
#
# but POSIX shell has neither arrays nor command substitution, so instead we
# post-process each arg (as a line of input to sed) to backslash-escape any
# character that might be a shell metacharacter, then use eval to reverse
# that process (while maintaining the separation between arguments), and wrap
# the whole thing up as a single "set" statement.
#
# This will of course break if any of these variables contains a newline or
# an unmatched quote.
#

eval "set -- $(
        printf '%s\n' "$DEFAULT_JVM_OPTS $JAVA_OPTS $AUDIVERIS_OPTS" |
        xargs -n1 |
        sed ' s~[^-[:alnum:]+,./:=@_]~\\&~g; ' |
        tr '\n' ' '
    )" '"$@"'

exec "$JAVACMD" "$@"
</file>

<file path="ai-music-backend/app-5.7.1/bin/Audiveris.bat">
@rem
@rem Copyright 2015 the original author or authors.
@rem
@rem Licensed under the Apache License, Version 2.0 (the "License");
@rem you may not use this file except in compliance with the License.
@rem You may obtain a copy of the License at
@rem
@rem      https://www.apache.org/licenses/LICENSE-2.0
@rem
@rem Unless required by applicable law or agreed to in writing, software
@rem distributed under the License is distributed on an "AS IS" BASIS,
@rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
@rem See the License for the specific language governing permissions and
@rem limitations under the License.
@rem

@if "%DEBUG%"=="" @echo off
@rem ##########################################################################
@rem
@rem  Audiveris startup script for Windows
@rem
@rem ##########################################################################

@rem Set local scope for the variables with windows NT shell
if "%OS%"=="Windows_NT" setlocal

set DIRNAME=%~dp0
if "%DIRNAME%"=="" set DIRNAME=.
@rem This is normally unused
set APP_BASE_NAME=%~n0
set APP_HOME=%DIRNAME%..

@rem Resolve any "." and ".." in APP_HOME to make it shorter.
for %%i in ("%APP_HOME%") do set APP_HOME=%%~fi

@rem Add default JVM options here. You can also use JAVA_OPTS and AUDIVERIS_OPTS to pass JVM options to this script.
set DEFAULT_JVM_OPTS="--add-exports=java.desktop/sun.awt.image=ALL-UNNAMED" "--enable-native-access=ALL-UNNAMED"

@rem Find java.exe
if defined JAVA_HOME goto findJavaFromJavaHome

set JAVA_EXE=java.exe
%JAVA_EXE% -version >NUL 2>&1
if %ERRORLEVEL% equ 0 goto execute

echo.
echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
echo.
echo Please set the JAVA_HOME variable in your environment to match the
echo location of your Java installation.

goto fail

:findJavaFromJavaHome
set JAVA_HOME=%JAVA_HOME:"=%
set JAVA_EXE=%JAVA_HOME%/bin/java.exe

if exist "%JAVA_EXE%" goto execute

echo.
echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME%
echo.
echo Please set the JAVA_HOME variable in your environment to match the
echo location of your Java installation.

goto fail

:execute

@rem Start script customization ---

@rem Actual value for min_java_version is to be provided by script post-processing
set /a min_java_version=24

for /f tokens^=2-5^ delims^=.-_^" %%j in ('"%JAVA_EXE%" -fullversion 2^>^&1') do (
    set "full_version=%%j.%%k.%%l-%%m"
    set "version=%%j"
)

if %version% LSS %min_java_version% (
    echo WARNING:
    echo WARNING: Current Java version %version% is lower than required %min_java_version%
    echo WARNING: Please install Java version %min_java_version% or higher
    echo WARNING:
@rem    start cmd /c "@echo off & mode con cols=50 lines=10 & echo // & echo // Audiveris WARNING: & echo // & echo // Your Java version is %version% (%full_version%) & echo // Please, install Java %min_java_version% or above. & echo // & pause"
    pause
    goto fail
)

@rem Stop script customization ---

@rem Setup the command line

set CLASSPATH=%APP_HOME%\lib\audiveris.jar;%APP_HOME%\lib\args4j-2.33.jar;%APP_HOME%\lib\logback-classic-1.4.14.jar;%APP_HOME%\lib\jai-imageio-jpeg2000-1.4.0.jar;%APP_HOME%\lib\jai-imageio-core-1.4.0.jar;%APP_HOME%\lib\itextpdf-5.5.13.2.jar;%APP_HOME%\lib\jgoodies-forms-1.9.0.jar;%APP_HOME%\lib\jgoodies-looks-2.7.0.jar;%APP_HOME%\lib\jaxb-core-2.3.0.1.jar;%APP_HOME%\lib\jaxb-impl-2.3.1.jar;%APP_HOME%\lib\jama-1.0.3.jar;%APP_HOME%\lib\jai-core-1.1.3.jar;%APP_HOME%\lib\jaxb-api-2.3.1.jar;%APP_HOME%\lib\ij-1.53j.jar;%APP_HOME%\lib\jcip-annotations-1.0.jar;%APP_HOME%\lib\org.apache.commons.io-2.4.jar;%APP_HOME%\lib\jbig2-imageio-3.0.4.jar;%APP_HOME%\lib\pdfbox-3.0.4.jar;%APP_HOME%\lib\fontbox-3.0.4.jar;%APP_HOME%\lib\pdfbox-io-3.0.4.jar;%APP_HOME%\lib\proxymusic-4.0.3.jar;%APP_HOME%\lib\eventbus-1.4.jar;%APP_HOME%\lib\tesseract-5.5.1-1.5.12.jar;%APP_HOME%\lib\tesseract-5.5.1-1.5.12-windows-x86_64.jar;%APP_HOME%\lib\leptonica-1.85.0-1.5.12.jar;%APP_HOME%\lib\leptonica-1.85.0-1.5.12-windows-x86_64.jar;%APP_HOME%\lib\javacpp-1.5.12.jar;%APP_HOME%\lib\bsaf-1.9.2.jar;%APP_HOME%\lib\jfreechart-1.5.3.jar;%APP_HOME%\lib\jgrapht-core-1.5.1.jar;%APP_HOME%\lib\github-api-1.301.jar;%APP_HOME%\lib\reflections-0.10.2.jar;%APP_HOME%\lib\slf4j-api-2.0.16.jar;%APP_HOME%\lib\logback-core-1.4.14.jar;%APP_HOME%\lib\jgoodies-common-1.8.1.jar;%APP_HOME%\lib\javax.activation-api-1.2.0.jar;%APP_HOME%\lib\commons-io-2.8.0.jar;%APP_HOME%\lib\commons-logging-1.3.4.jar;%APP_HOME%\lib\jaxb-runtime-4.0.5.jar;%APP_HOME%\lib\jaxb-core-4.0.5.jar;%APP_HOME%\lib\jakarta.xml.bind-api-4.0.2.jar;%APP_HOME%\lib\jheaps-0.13.jar;%APP_HOME%\lib\commons-lang3-3.9.jar;%APP_HOME%\lib\jackson-annotations-2.13.0.jar;%APP_HOME%\lib\jackson-core-2.13.0.jar;%APP_HOME%\lib\jackson-databind-2.13.0.jar;%APP_HOME%\lib\javassist-3.28.0-GA.jar;%APP_HOME%\lib\jsr305-3.0.2.jar;%APP_HOME%\lib\angus-activation-2.0.2.jar;%APP_HOME%\lib\jakarta.activation-api-2.1.3.jar;%APP_HOME%\lib\txw2-4.0.5.jar;%APP_HOME%\lib\istack-commons-runtime-4.1.2.jar


@rem Execute Audiveris
"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %AUDIVERIS_OPTS%  -classpath "%CLASSPATH%" Audiveris %*

:end
@rem End local scope for the variables with windows NT shell
if %ERRORLEVEL% equ 0 goto mainEnd

:fail
rem Set variable AUDIVERIS_EXIT_CONSOLE if you need the _script_ return code instead of
rem the _cmd.exe /c_ return code!
set EXIT_CODE=%ERRORLEVEL%
if %EXIT_CODE% equ 0 set EXIT_CODE=1
if not ""=="%AUDIVERIS_EXIT_CONSOLE%" exit %EXIT_CODE%
exit /b %EXIT_CODE%

:mainEnd
if "%OS%"=="Windows_NT" endlocal

:omega
</file>

<file path="ai-music-backend/requirements.txt">
flask
flask-cors
python-dotenv
requests
huggingface_hub
replicate
</file>

<file path="docs/firebase-integration-plan.md">
# Firebase Integration & Auth Plan

## 1. ëª©í‘œì™€ ë²”ìœ„
- ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜ì´ì§€ì— ì‚¬ìš©ìë³„ ìŒì•…/ë¹„íŠ¸ ë°ì´í„°ë¥¼ Firestoreì—ì„œ ì½ì–´ì™€ í‘œì‹œí•œë‹¤.
- ìŒì•… ìƒì„±/ë¹„íŠ¸ ìƒì„± ì›Œí¬í”Œë¡œê°€ ì™„ë£Œë  ë•Œ ê²°ê³¼ ë©”íƒ€ë°ì´í„°ì™€ ì˜¤ë””ì˜¤ íŒŒì¼ì„ Firebaseì— ì €ì¥í•œë‹¤.
- Firebase Authenticationì„ ì´ìš©í•´ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê¸°ë°˜ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ì„ ì œê³µí•˜ê³ , ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ UIì™€ ì ‘ê·¼ ê¶Œí•œì„ ì œì–´í•œë‹¤.
- ì¦ê²¨ì°¾ê¸°, ì‚­ì œ, ë‹¤ìš´ë¡œë“œ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒí˜¸ì‘ìš©ì„ ì‚¬ìš©ì ê¶Œí•œì— ë§ì¶° ë™ì‘ì‹œí‚¤ê³  ê°ì‚¬ ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ë§ˆë ¨í•œë‹¤.

## 2. í˜„ì¬ ìƒíƒœ ìš”ì•½
- `Library.js`ëŠ” `musicList` ìƒíƒœì™€ ë”ë¯¸ ë°ì´í„°ë¥¼ ê²°í•©í•˜ì—¬ í™”ë©´ë§Œ ë Œë”ë§í•œë‹¤. ì‹¤ì œ ë°ì´í„° ë¡œë”©, ì¦ê²¨ì°¾ê¸° í† ê¸€, ì‚­ì œ ë“±ì€ ì „ë¶€ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ë„ìš°ëŠ” ìˆ˜ì¤€ì´ë‹¤.
- ìƒì„± í˜ì´ì§€(`MusicGeneration`, `MusicConversion`)ëŠ” ì„±ê³µ ì‹œ ì„ì‹œ ê°ì²´ë¥¼ ìƒíƒœì— ë„£ì§€ë§Œ ì˜ì† ì €ì¥ì†Œê°€ ì—†ì–´ ìƒˆë¡œê³ ì¹¨ ì‹œ ë°ì´í„°ê°€ ì‚¬ë¼ì§„ë‹¤.
- ì‚¬ìš©ì ì¸ì¦ ê¸°ëŠ¥ì´ ì—†ê³ , `MusicContext`ëŠ” ë‹¨ì¼ ì‚¬ìš©ì ê°€ì •ìœ¼ë¡œ ë™ì‘í•œë‹¤.

## 3. ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ (í•µì‹¬ í”Œë¡œìš°)
1. **íšŒì›ê°€ì…**: ì‚¬ìš©ìê°€ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ë¡œ ê°€ì… â†’ displayName ì…ë ¥ â†’ Firestore `users` ë¬¸ì„œ ìƒì„±.
2. **ë¡œê·¸ì¸**: ì¸ì¦ ì„±ê³µ í›„ í† í° ê¸°ë°˜ ì„¸ì…˜ ìœ ì§€ â†’ ì „ì—­ ì»¨í…ìŠ¤íŠ¸ì— ì‚¬ìš©ì ì •ë³´ ì €ì¥ â†’ ë¼ì´ë¸ŒëŸ¬ë¦¬/ìƒì„± ê¸°ëŠ¥ ì ‘ê·¼ ê°€ëŠ¥.
3. **ìŒì•… ìƒì„±**: MusicGen API í˜¸ì¶œ ì™„ë£Œ â†’ ê²°ê³¼ ì˜¤ë””ì˜¤ë¥¼ Firebase Storage ì—…ë¡œë“œ â†’ Firestore `tracks` ì»¬ë ‰ì…˜ì— ë©”íƒ€ë°ì´í„° + Storage URL ì €ì¥ â†’ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì¦‰ì‹œ ë°˜ì˜.
4. **ë¹„íŠ¸ ìƒì„±**: ë“œëŸ¼ íŒ¨í„´ WAV export â†’ Storage ì—…ë¡œë“œ â†’ Firestore `beats` ë¬¸ì„œ ìƒì„± â†’ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í‘œì‹œ.
5. **ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒí˜¸ì‘ìš©**: ê²€ìƒ‰Â·í•„í„°ëŠ” Firestore ì¿¼ë¦¬ or í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§. ì¦ê²¨ì°¾ê¸° í† ê¸€ ì‹œ `favorites` ì„œë¸Œì»¬ë ‰ì…˜(ë˜ëŠ” ë°°ì—´)ì„ ì—…ë°ì´íŠ¸. ì‚­ì œ ì‹œ Storage íŒŒì¼ ì‚­ì œ í›„ ë¬¸ì„œ soft delete.
6. **ë¹„ë¡œê·¸ì¸ ì ‘ê·¼**: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§„ì… ì‹œ ë¡œê·¸ì¸ ìœ ë„ ëª¨ë‹¬/ë¦¬ë‹¤ì´ë ‰íŠ¸, ìƒì„± í˜ì´ì§€ëŠ” ì½ê¸°ë§Œ í—ˆìš©í•˜ê±°ë‚˜ ë¡œê·¸ì¸ ìš”êµ¬.

## 4. ë°ì´í„° ëª¨ë¸ ì œì•ˆ (Cloud Firestore)

### 4.1 ì»¬ë ‰ì…˜ êµ¬ì¡°
| ì»¬ë ‰ì…˜ | ë¬¸ì„œ ID | ì£¼ìš” í•„ë“œ | ë¹„ê³  |
| --- | --- | --- | --- |
| `users` | Firebase UID | `email`, `displayName`, `photoURL`, `createdAt`, `role` | role: `user`, `admin` |
| `tracks` | auto ID | `ownerId`, `title`, `genres`, `moods`, `durationSec`, `createdAt`, `audioPath`, `source` (`musicgen`/`upload`), `status` (`ready`/`processing`), `thumbnailPath?` | ìƒì„± ìŒì•… |
| `beats` | auto ID | `ownerId`, `title`, `bpm`, `bars`, `pattern` (16Ã—N bool ë°°ì—´ or flattened string), `createdAt`, `audioPath`, `sourcePresetMeta` | íŒ¨ë“œ ë¸”ë Œë” ê²°ê³¼ |
| `favorites` | `${ownerId}` doc with subcollection `items` or top-level collection keyed by user | `targetType` (`track`/`beat`), `targetId`, `createdAt` | ë‹¨ìˆœí™” ìœ„í•´ `users/{uid}/favorites/{targetId}` êµ¬ì¡° ê¶Œì¥ |
| `activityLogs` (ì„ íƒ) | auto ID | `ownerId`, `type`, `targetId`, `timestamp`, `payload` | ê°ì‚¬/ë””ë²„ê¹…ìš© |

### 4.2 Firebase Storage ê²½ë¡œ
- `audio/tracks/{uid}/{trackId}.wav`
- `audio/beats/{uid}/{beatId}.wav`
- (`thumbnails/â€¦` ë“± í›„ì† í™•ì¥ ê°€ëŠ¥)

### 4.3 í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ë§¤í•‘
- `MusicContext` ë‚´ `library.musicList` â†’ Firestore `tracks` + `beats` í†µí•© ê²°ê³¼.
- ì¦ê²¨ì°¾ê¸°: ë¡œê·¸ì¸ ì‚¬ìš©ìì˜ favorites ë¬¸ì„œë¥¼ `onSnapshot`ìœ¼ë¡œ êµ¬ë…í•˜ì—¬ UI ë°˜ì˜.

## 5. Firebase Authentication ì„¤ê³„
- **ë°©ì‹**: 1ì°¨ ë¦´ë¦¬ìŠ¤ëŠ” ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸. ì¶”í›„ Google OAuth ì¶”ê°€ ê°€ëŠ¥ (UI/UX ê³ ë ¤í•˜ì—¬ í™•ì¥ í¬ì¸íŠ¸ ë§ˆë ¨).
- **ê°€ì… í”Œë¡œìš°**
  1. `createUserWithEmailAndPassword`
  2. `updateProfile`ë¡œ displayName ì„¤ì •
  3. Firestore `users/{uid}` ë¬¸ì„œ ìƒì„± (`setDoc` with merge)
- **ë¡œê·¸ì¸ í”Œë¡œìš°**: `signInWithEmailAndPassword` â†’ `onAuthStateChanged`ë¡œ ì „ì—­ ìƒíƒœ ë™ê¸°í™”.
- **ì„¸ì…˜ ìœ ì§€**: Firebase SDK ê¸°ë³¸ persistence (`local`). CSR í™˜ê²½ìœ¼ë¡œ ì¶©ë¶„.
- **ë³´í˜¸ ë¼ìš°íŒ…**: React Router `PrivateRoute` íŒ¨í„´ ë˜ëŠ” `RequireAuth` ì»´í¬ë„ŒíŠ¸ ë„ì….

## 6. ë³´ì•ˆ ê·œì¹™ (ì´ˆì•ˆ)
- `users/{uid}`: ì½ê¸°/ì“°ê¸° ë³¸ì¸ë§Œ í—ˆìš©. Admin roleì€ ì „ì²´ ì¡°íšŒ ê°€ëŠ¥.
- `tracks/{id}` & `beats/{id}`:
  - ì½ê¸°: ì¸ì¦ëœ ì‚¬ìš©ìì´ë©´ì„œ `resource.data.ownerId == request.auth.uid` ë˜ëŠ” `resource.data.visibility == 'public'` (ì¶”í›„ ê³µê°œ ê¸°ëŠ¥ ê³ ë ¤).
  - ì“°ê¸°: ì‹ ê·œ ì‘ì„± ì‹œ `request.auth.uid`ê°€ ownerIdì™€ ì¼ì¹˜í•´ì•¼ í•¨.
  - ì—…ë°ì´íŠ¸: ownerId ë¶ˆë³€, íŠ¹ì • í•„ë“œë§Œ ìˆ˜ì • í—ˆìš©.
- `users/{uid}/favorites/{itemId}`: ë³¸ì¸ë§Œ ì½ê¸°/ì“°ê¸°. ì¡´ì¬ ì—¬ë¶€ ê²€ì¦ìœ¼ë¡œ ì¦ê²¨ì°¾ê¸° í‘œì‹œ.
- Storage ê·œì¹™: `/audio/{type}/{uid}/**` ê²½ë¡œëŠ” uid ë³¸ì¸ë§Œ ì½ê¸°/ì“°ê¸°. ë‹¤ìš´ë¡œë“œ ê³µìœ  ì‹œ ê³µê°œ URL ìƒì„± ê¸°ëŠ¥ ì‚¬ìš©.

## 7. í”„ë¡ íŠ¸ì—”ë“œ í†µí•© í¬ì¸íŠ¸
- `src/lib/firebase.js`: Firebase ì•± ì´ˆê¸°í™”, `auth`, `db`, `storage` export.
- `src/context/MusicContext.js` ê°œí¸: auth ìƒíƒœ ì €ì¥, Firestore ë¦¬ìŠ¤ë„ˆ êµ¬ë…, ë¼ì´ë¸ŒëŸ¬ë¦¬ ìºì‹œ êµ¬ì„±.
- ì„œë¹„ìŠ¤ ë ˆì´ì–´:
  - `services/libraryApi.js` (ì‹ ê·œ): Firestore CRUD ë˜í•‘ (ëª©ë¡ ì¡°íšŒ, ì¦ê²¨ì°¾ê¸° í† ê¸€, ì‚­ì œ ë“±).
  - ê¸°ì¡´ `musicApi.js`ëŠ” ìƒì„± ìš”ì²­ í›„ Firebase ì €ì¥ ë¡œì§ì„ ì—°ê²°.
- UI ì—…ë°ì´íŠ¸: Navbarì— ë¡œê·¸ì¸/íšŒì›ê°€ì… ë²„íŠ¼, ì‚¬ìš©ì ì•„ë°”íƒ€, ë¡œê·¸ì•„ì›ƒ ë©”ë‰´ ì¶”ê°€. Library í˜ì´ì§€ì—ì„œ ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ ë Œë”ë§.

## 8. ë‹¨ê³„ë³„ ì‹¤í–‰ ë¡œë“œë§µ
1. **í™˜ê²½ êµ¬ì„±**: Firebase í”„ë¡œì íŠ¸ ìƒì„±, `.env.example` ì—…ë°ì´íŠ¸, ì´ˆê¸°í™” ëª¨ë“ˆ ì‘ì„±.
2. **Auth UI & ë¡œì§**: ê°€ì…/ë¡œê·¸ì¸ í¼ + ì»¨í…ìŠ¤íŠ¸ ë¦¬ìŠ¤ë„ˆ + ë³´í˜¸ ë¼ìš°íŠ¸.
3. **ë°ì´í„° ì“°ê¸° íŒŒì´í”„ë¼ì¸**: ìƒì„±/ë³€í™˜ ì™„ë£Œ ì‹œ Firestore & Storage ë°˜ì˜.
4. **ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½ê¸°**: Firestoreì—ì„œ ì‚¬ìš©ì ì†Œìœ  `tracks`/`beats` êµ¬ë…, ë¦¬ìŠ¤íŠ¸ ë Œë”ë§. ê²€ìƒ‰/ì •ë ¬ì€ í´ë¼ì´ì–¸íŠ¸ë¶€í„° ì‹œì‘.
5. **ì¦ê²¨ì°¾ê¸° ë° ì•¡ì…˜**: favorites ì»¬ë ‰ì…˜, ì‚­ì œ(soft delete), ë‹¤ìš´ë¡œë“œ(Storage URL) ì²˜ë¦¬.
6. **ë³´ì•ˆ ê·œì¹™/í…ŒìŠ¤íŠ¸**: ë¡œì»¬ ì—ë®¬ë ˆì´í„° ë˜ëŠ” ì‹œë®¬ë ˆì´í„°ë¡œ ê·œì¹™ ê²€ì¦, ì—ëŸ¬ ì²˜ë¦¬ UX ê°œì„ .
7. **ì¶”ê°€ ê³ ë„í™”** (ì„ íƒ): ê³µìœ  ë§í¬, ê³µê°œ ë¼ì´ë¸ŒëŸ¬ë¦¬, ì†Œì…œ ë¡œê·¸ì¸, ì˜¤í”„ë¼ì¸ ìºì‹±.

## 9. ë¦¬ìŠ¤í¬ì™€ ëŒ€ì‘
- **ì˜¤ë””ì˜¤ íŒŒì¼ ìš©ëŸ‰**: Storage ë¹„ìš©/ì—…ë¡œë“œ ì‹œê°„ â†’ ì›Œí¬í”Œë¡œì— ì—…ë¡œë“œ ì§„í–‰ í‘œì‹œ, ìš©ëŸ‰ ì œí•œ.
- **ì‹¤ì‹œê°„ ë™ê¸°í™” ì§€ì—°**: ëŒ€ìš©ëŸ‰ ì¿¼ë¦¬ ëŒ€ë¹„ í˜ì´ì§€ë„¤ì´ì…˜ or ì‹œê°„ìˆœ ì •ë ¬ í•„ë“œ ì¤€ë¹„.
- **ë³´ì•ˆ ê·œì¹™ ì‹¤ìˆ˜**: ë°°í¬ ì „ ì‹œë®¬ë ˆì´í„° í…ŒìŠ¤íŠ¸, ìµœì†Œê¶Œí•œ ì›ì¹™ ì¤€ìˆ˜.
- **API ì‹¤íŒ¨ ì²˜ë¦¬**: Firebase ì—°ë™ ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ì „ëµ (ì˜ˆ: Storage ì—…ë¡œë“œ ì„±ê³µ / Firestore ì‹¤íŒ¨ â†’ ì—…ë¡œë“œ ì‚­ì œ).

## 10. ë‹¤ìŒ ì•¡ì…˜
1. Firebase í”„ë¡œì íŠ¸ ìƒì„± ë° ìê²© ì •ë³´ í™•ë³´.
2. ë¦¬í¬ì§€í„°ë¦¬ì— `.env.example`ì— Firebase í‚¤ í•„ë“œ ì¶”ê°€.
3. `src/lib/firebase.js` ì´ˆê¸°í™” ì½”ë“œì™€ ê¸°ë³¸ SDK ì…‹ì—….
4. Auth ì „ì—­ ìƒíƒœë¥¼ ì„¤ê³„í•˜ê¸° ìœ„í•´ `MusicContext` êµ¬ì¡° ë¶„ì„ (ë‹¤ìŒ ë‹¨ê³„ ì‘ì—…).

## ë¶€ë¡ A. MusicContext ê°œí¸ ë°©í–¥
- **í˜„ì¬ êµ¬ì¡° ìš”ì•½**: ë‹¨ì¼ `useReducer`ë¡œ ìƒì„±/ë³€í™˜/ë¼ì´ë¸ŒëŸ¬ë¦¬/UI ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë©° ì‚¬ìš©ì ê°œë…ì´ ì—†ë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë¡œì»¬ ë°°ì—´ì´ë©° ì¦ê²¨ì°¾ê¸°, ì‚­ì œ ë“±ì€ ë‹¨ìˆœ ì•Œë¦¼ë§Œ í‘œì‹œí•œë‹¤.
- **í•„ìš” ë³€ê²½ ì‚¬í•­**
  - `auth` ìŠ¬ë¼ì´ìŠ¤ ì¶”ê°€: `user`, `authStatus`(`idle`/`loading`/`authenticated`/`error`), `error` í•„ë“œ ë“±.
  - Firebase `onAuthStateChanged`ë¥¼ êµ¬ë…í•˜ëŠ” `useEffect`ë¥¼ Providerì— ë„ì…í•˜ê³ , ê²°ê³¼ë¥¼ `dispatch`í•˜ì—¬ ìƒíƒœë¥¼ ê°±ì‹ .
  - ë¼ì´ë¸ŒëŸ¬ë¦¬ ì•¡ì…˜ì„ Firestore ì—°ë™ê³¼ ì—°ê²°í•˜ê¸° ìœ„í•´ `actions`ì— async í•¨ìˆ˜ë¥¼ í—ˆìš©í•˜ê±°ë‚˜ ë³„ë„ ì„œë¹„ìŠ¤ í›…ì„ ì •ì˜.
  - ìƒì„±/ë³€í™˜ ì™„ë£Œ ì•¡ì…˜ì—ì„œ Firestore ì €ì¥ìœ¼ë¡œì˜ íŒŒì´í”„ë¥¼ ì—°ê²°í•˜ê¸° ì‰¬ìš´ êµ¬ì¡°(ì˜ˆ: action ëŒ€ì‹  thunk)ë¡œ ì ì§„ì  ë¦¬íŒ©í† ë§ ê³ ë ¤.
- **ë‹¨ê¸° ì ‘ê·¼**
  1. `auth` ìƒíƒœë¥¼ ì¶”ê°€í•˜ê³  Firebase Auth ë³€í™” ê°ì§€ í›„ `state.auth.user` ì—…ë°ì´íŠ¸.
  2. ë¡œê·¸ì¸ í•„ìš” í˜ì´ì§€ ë³´í˜¸ë¥¼ ìœ„í•´ Contextì—ì„œ ì œê³µí•  `requireAuth` í—¬í¼ ë˜ëŠ” React Router ê°€ë“œ êµ¬í˜„.
  3. ë¼ì´ë¸ŒëŸ¬ë¦¬ ë°ì´í„°ëŠ” Auth ì¤€ë¹„ ì´í›„ `useEffect`ì—ì„œ ì‚¬ìš©ì ID ê¸°ë°˜ Firestore êµ¬ë…ìœ¼ë¡œ ì±„ìš´ë‹¤.
</file>

<file path="PROJECT_DOCUMENTATION.md">
# AI ê¸°ë°˜ ë°°ê²½ìŒì•… ìƒì„± ë° ë³€í™˜ ì‹œìŠ¤í…œ - í”„ë¡ íŠ¸ì—”ë“œ ë¬¸ì„œ

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

ë³¸ í”„ë¡œì íŠ¸ëŠ” AIë¥¼ í™œìš©í•˜ì—¬ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ë¶„ìœ„ê¸°ì™€ ì¥ë¥´ì˜ ë°°ê²½ìŒì•…ì„ ìƒì„±í•˜ê³ , ê¸°ì¡´ ìŒì•…ì„ ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ë¡œ ë³€í™˜í•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í”„ë¡ íŠ¸ì—”ë“œ ë¶€ë¶„ì…ë‹ˆë‹¤.

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

### ì „ì²´ ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
ai-music-frontend/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/           # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ common/          # ê³µí†µ UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ GenreSelector.js
â”‚   â”‚   â”‚   â””â”€â”€ MoodSelector.js
â”‚   â”‚   â”œâ”€â”€ layout/          # ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ Navbar.js
â”‚   â”‚   â””â”€â”€ music/           # ìŒì•… ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ (ì¶”í›„ í™•ì¥)
â”‚   â”œâ”€â”€ pages/               # í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ MusicGeneration.js
â”‚   â”‚   â”œâ”€â”€ MusicConversion.js
â”‚   â”‚   â”œâ”€â”€ ResultPage.js
â”‚   â”‚   â””â”€â”€ Library.js
â”‚   â”œâ”€â”€ context/             # ì „ì—­ ìƒíƒœ ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ MusicContext.js
â”‚   â”œâ”€â”€ services/            # API í†µì‹  ì„œë¹„ìŠ¤
â”‚   â”‚   â””â”€â”€ musicApi.js
â”‚   â”œâ”€â”€ utils/               # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”‚   â”œâ”€â”€ hooks/               # ì»¤ìŠ¤í…€ í›… (ì¶”í›„ í™•ì¥)
â”‚   â”œâ”€â”€ App.js              # ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ index.js            # ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸
â”œâ”€â”€ UI_UX_DESIGN.md         # UI/UX ì„¤ê³„ ë¬¸ì„œ
â”œâ”€â”€ PROJECT_DOCUMENTATION.md # ì´ ë¬¸ì„œ
â””â”€â”€ package.json
```

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### 1. ìŒì•… ìƒì„± (MusicGeneration.js)
- **ì¥ë¥´ ì„ íƒ**: ìµœëŒ€ 3ê°œì˜ ì¥ë¥´ ì„ íƒ ê°€ëŠ¥
- **ë¶„ìœ„ê¸° í‚¤ì›Œë“œ**: ìµœëŒ€ 5ê°œì˜ ë¶„ìœ„ê¸° íƒœê·¸ ì„ íƒ
- **ìƒì„¸ ì„¤ëª…**: ììœ  í…ìŠ¤íŠ¸ë¡œ ì›í•˜ëŠ” ìŒì•… ì„¤ëª…
- **ìŒì•… ê¸¸ì´**: 30ì´ˆ~10ë¶„ ì‚¬ì´ ì„¤ì • ê°€ëŠ¥
- **ì‹¤ì‹œê°„ ì§„í–‰ë¥ **: AI ìƒì„± ê³¼ì • ì‹œê°í™”

### 2. ìŒì•… ë³€í™˜ (MusicConversion.js)
- **íŒŒì¼ ì—…ë¡œë“œ**: ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë˜ëŠ” í´ë¦­ìœ¼ë¡œ íŒŒì¼ ì„ íƒ
- **ë¯¸ë¦¬ ë“£ê¸°**: ì—…ë¡œë“œëœ ì›ë³¸ íŒŒì¼ ì¬ìƒ ê¸°ëŠ¥
- **ë³€í™˜ ìŠ¤íƒ€ì¼**: ë‹¨ì¼ ì¥ë¥´ ì„ íƒ
- **ë³€í™˜ ê°•ë„**: 1-5 ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜ ì •ë„ ì¡°ì ˆ

### 3. ê²°ê³¼ í˜ì´ì§€ (ResultPage.js)
- **ìŒì•… í”Œë ˆì´ì–´**: ìƒì„±/ë³€í™˜ëœ ìŒì•… ì¬ìƒ
- **ì •ë³´ í‘œì‹œ**: ì¥ë¥´, ë¶„ìœ„ê¸°, ìƒì„± ì‹œê°„ ë“±
- **ì•¡ì…˜ ë²„íŠ¼**: ë‹¤ìš´ë¡œë“œ, ì¦ê²¨ì°¾ê¸°, ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
- **ì¶”ê°€ í–‰ë™**: ì¬ìƒì„±, ê³µìœ  ë“±

### 4. ë¼ì´ë¸ŒëŸ¬ë¦¬ (Library.js)
- **ìŒì•… ëª©ë¡**: ìƒì„±/ë³€í™˜ëœ ëª¨ë“  ìŒì•… ê´€ë¦¬
- **ê²€ìƒ‰ ë° í•„í„°**: ì œëª©, íƒ€ì…, ì¥ë¥´ë³„ í•„í„°ë§
- **ì •ë ¬**: ë‚ ì§œ, ì œëª©, ê¸¸ì´, ì¦ê²¨ì°¾ê¸°ìˆœ ì •ë ¬
- **ì¹´ë“œ UI**: ì‹œê°ì ìœ¼ë¡œ êµ¬ì¡°í™”ëœ ìŒì•… ì •ë³´

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

### í”„ë¡ íŠ¸ì—”ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **React 18**: ë©”ì¸ UI ë¼ì´ë¸ŒëŸ¬ë¦¬
- **React Router DOM**: í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë¼ìš°íŒ…
- **Material-UI (MUI)**: ë””ìì¸ ì‹œìŠ¤í…œ ë° ì»´í¬ë„ŒíŠ¸
- **React Dropzone**: íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥

### ìƒíƒœ ê´€ë¦¬
- **React Context + useReducer**: ì „ì—­ ìƒíƒœ ê´€ë¦¬
- **localStorage**: í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë°ì´í„° ì €ì¥ (ì¶”í›„ êµ¬í˜„ ì˜ˆì •)

### ìŠ¤íƒ€ì¼ë§
- **Material-UI Theme**: ì¼ê´€ëœ ë””ìì¸ ì‹œìŠ¤í…œ
- **CSS-in-JS**: Emotion ê¸°ë°˜ ìŠ¤íƒ€ì¼ë§
- **ë°˜ì‘í˜• ë””ìì¸**: ëª¨ë°”ì¼/íƒœë¸”ë¦¿/ë°ìŠ¤í¬í†± ëŒ€ì‘

## ğŸ¨ ë””ìì¸ ì‹œìŠ¤í…œ

### ì»¬ëŸ¬ íŒ”ë ˆíŠ¸
- **Primary**: #6366F1 (ì¸ë””ê³ ) - ë©”ì¸ ì•¡ì…˜ ë²„íŠ¼, ë§í¬
- **Secondary**: #8B5CF6 (ë³´ë¼) - ë³´ì¡° ì•¡ì…˜, ê°•ì¡°
- **Success**: #10B981 (ì´ˆë¡) - ì„±ê³µ ë©”ì‹œì§€
- **Background**: #F8FAFC (ì—°í•œ íšŒìƒ‰) - í˜ì´ì§€ ë°°ê²½

### ì»´í¬ë„ŒíŠ¸ ì›ì¹™
- **ì¬ì‚¬ìš©ì„±**: ê³µí†µ UI ìš”ì†ŒëŠ” ë³„ë„ ì»´í¬ë„ŒíŠ¸í™”
- **ì ‘ê·¼ì„±**: WCAG 2.1 ê°€ì´ë“œë¼ì¸ ì¤€ìˆ˜
- **ë°˜ì‘í˜•**: ëª¨ë“  í™”ë©´ í¬ê¸°ì—ì„œ ìµœì í™”ëœ ê²½í—˜

## ğŸ“Š ìƒíƒœ ê´€ë¦¬ êµ¬ì¡°

### MusicContext ìƒíƒœ êµ¬ì¡°
```javascript
{
  generation: {
    selectedGenres: [],      // ì„ íƒëœ ì¥ë¥´
    selectedMoods: [],       // ì„ íƒëœ ë¶„ìœ„ê¸°
    description: '',         // ìƒì„¸ ì„¤ëª…
    duration: 120,          // ìŒì•… ê¸¸ì´ (ì´ˆ)
    isGenerating: false,    // ìƒì„± ì¤‘ ì—¬ë¶€
    generationProgress: 0   // ìƒì„± ì§„í–‰ë¥ 
  },
  conversion: {
    uploadedFile: null,     // ì—…ë¡œë“œëœ íŒŒì¼
    targetGenre: '',        // ë³€í™˜í•  ì¥ë¥´
    conversionIntensity: 3, // ë³€í™˜ ê°•ë„
    isConverting: false,    // ë³€í™˜ ì¤‘ ì—¬ë¶€
    conversionProgress: 0   // ë³€í™˜ ì§„í–‰ë¥ 
  },
  result: {
    generatedMusic: null,   // ìƒì„±ëœ ìŒì•… ë°ì´í„°
    convertedMusic: null,   // ë³€í™˜ëœ ìŒì•… ë°ì´í„°
    isPlaying: false,       // ì¬ìƒ ìƒíƒœ
    currentTime: 0,         // í˜„ì¬ ì¬ìƒ ì‹œê°„
    duration: 0             // ì „ì²´ ê¸¸ì´
  },
  library: {
    musicList: [],          // ë¼ì´ë¸ŒëŸ¬ë¦¬ ìŒì•… ëª©ë¡
    sortBy: 'date',         // ì •ë ¬ ê¸°ì¤€
    filterBy: 'all'         // í•„í„° ê¸°ì¤€
  },
  ui: {
    currentPage: 'generate', // í˜„ì¬ í˜ì´ì§€
    notifications: [],       // ì•Œë¦¼ ëª©ë¡
    loading: false,          // ë¡œë”© ìƒíƒœ
    error: null             // ì—ëŸ¬ ìƒíƒœ
  }
}
```

## ğŸ”Œ API ì—°ë™ êµ¬ì¡°

### ì„œë¹„ìŠ¤ ë ˆì´ì–´ (musicApi.js)
- **ìƒì„± API**: ìŒì•… ìƒì„± ìš”ì²­ ë° ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§
- **ë³€í™˜ API**: íŒŒì¼ ì—…ë¡œë“œ ë° ë³€í™˜ ì§„í–‰ë¥  ì¶”ì 
- **ë¼ì´ë¸ŒëŸ¬ë¦¬ API**: ìŒì•… ëª©ë¡ ì¡°íšŒ, ì¶”ê°€, ì‚­ì œ
- **ë‹¤ìš´ë¡œë“œ API**: ìŒì•… íŒŒì¼ ë‹¤ìš´ë¡œë“œ

### API ì—°ë™ íŒ¨í„´
```javascript
// ì˜ˆì‹œ: ìŒì•… ìƒì„± API í˜¸ì¶œ
const handleGenerateMusic = async () => {
  try {
    actions.startGeneration();
    
    const result = await generateMusic(
      generationParams,
      (progress) => actions.updateGenerationProgress(progress)
    );
    
    actions.completeGeneration(result);
    navigate('/result');
    
  } catch (error) {
    actions.setError(error.message);
  }
};
```

## ğŸ§© ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ì„¤ëª…

### 1. GenreSelector ì»´í¬ë„ŒíŠ¸
- **ëª©ì **: ì¥ë¥´ ì„ íƒ UI ì œê³µ
- **ê¸°ëŠ¥**: ë‹¤ì¤‘/ë‹¨ì¼ ì„ íƒ, ìµœëŒ€ ì„ íƒ ê°œìˆ˜ ì œí•œ
- **ì¬ì‚¬ìš©ì„±**: ìƒì„± ë° ë³€í™˜ í˜ì´ì§€ì—ì„œ ê³µí†µ ì‚¬ìš©
- **Props**:
  - `selectedGenres`: ì„ íƒëœ ì¥ë¥´ ë°°ì—´
  - `onGenreChange`: ì„ íƒ ë³€ê²½ í•¸ë“¤ëŸ¬
  - `multiSelect`: ë‹¤ì¤‘ ì„ íƒ í—ˆìš© ì—¬ë¶€
  - `maxSelection`: ìµœëŒ€ ì„ íƒ ê°œìˆ˜

### 2. MoodSelector ì»´í¬ë„ŒíŠ¸
- **ëª©ì **: ë¶„ìœ„ê¸° í‚¤ì›Œë“œ ì„ íƒ UI ì œê³µ
- **ê¸°ëŠ¥**: ì´ëª¨ì§€ì™€ í•¨ê»˜ í‘œì‹œ, ì§„í–‰ë¥  ì‹œê°í™”
- **íŠ¹ì§•**: í•´ì‹œíƒœê·¸ ìŠ¤íƒ€ì¼ ë””ìì¸
- **Props**:
  - `selectedMoods`: ì„ íƒëœ ë¶„ìœ„ê¸° ë°°ì—´
  - `onMoodChange`: ì„ íƒ ë³€ê²½ í•¸ë“¤ëŸ¬
  - `maxSelection`: ìµœëŒ€ ì„ íƒ ê°œìˆ˜

### 3. Navbar ì»´í¬ë„ŒíŠ¸
- **ëª©ì **: ì „ì—­ ë„¤ë¹„ê²Œì´ì…˜ ì œê³µ
- **ê¸°ëŠ¥**: í˜ì´ì§€ ê°„ ì´ë™, í˜„ì¬ í˜ì´ì§€ í‘œì‹œ
- **ë°˜ì‘í˜•**: ëª¨ë°”ì¼ì—ì„œëŠ” ì•„ì´ì½˜ë§Œ í‘œì‹œ
- **ë¼ìš°íŒ…**: React Routerì™€ ì—°ë™

## ğŸ”§ ê°œë°œ ì‹œ ê³ ë ¤ì‚¬í•­

### ìœ ì§€ë³´ìˆ˜ì„±
- **ëª…í™•í•œ ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°**: ê° ì»´í¬ë„ŒíŠ¸ëŠ” ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì¤€ìˆ˜
- **íƒ€ì… ì•ˆì •ì„±**: PropTypes ë˜ëŠ” TypeScript ë„ì… ê³ ë ¤ (ì¶”í›„)
- **ì½”ë“œ ë¬¸ì„œí™”**: JSDoc ìŠ¤íƒ€ì¼ ì£¼ì„ ì ê·¹ í™œìš©
- **ì¼ê´€ëœ ë„¤ì´ë°**: ì§ê´€ì ì´ê³  ì„¤ëª…ì ì¸ ë³€ìˆ˜/í•¨ìˆ˜ëª… ì‚¬ìš©

### ë‚®ì€ ê²°í•©ë„ (Low Coupling)
- **Context ê¸°ë°˜ ìƒíƒœ ê´€ë¦¬**: props drilling ë°©ì§€
- **ì„œë¹„ìŠ¤ ë ˆì´ì–´ ë¶„ë¦¬**: API ë¡œì§ì„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¶„ë¦¬
- **ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ **: ì»´í¬ë„ŒíŠ¸ ê°„ ì§ì ‘ ì°¸ì¡° ìµœì†Œí™”
- **ì¸í„°í˜ì´ìŠ¤ ì •ì˜**: ëª…í™•í•œ props ì¸í„°í˜ì´ìŠ¤ ì •ì˜

### ë†’ì€ ì‘ì§‘ë„ (High Cohesion)
- **ê¸°ëŠ¥ë³„ ë””ë ‰í† ë¦¬ êµ¬ì¡°**: ê´€ë ¨ ê¸°ëŠ¥ì„ í•œ ê³³ì— ëª¨ìŒ
- **ë„ë©”ì¸ ì¤‘ì‹¬ ì„¤ê³„**: ìŒì•… ìƒì„±/ë³€í™˜/ë¼ì´ë¸ŒëŸ¬ë¦¬ ë„ë©”ì¸ ë¶„ë¦¬
- **ì»´í¬ë„ŒíŠ¸ ì±…ì„ ë¶„ë¦¬**: UI, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ë°ì´í„° ê´€ë¦¬ ë¶„ë¦¬

### í™•ì¥ì„±
- **ëª¨ë“ˆí™”ëœ êµ¬ì¡°**: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ì˜í–¥ ìµœì†Œí™”
- **ì„¤ì • ê¸°ë°˜ ê°œë°œ**: í•˜ë“œì½”ë”©ëœ ê°’ë“¤ì„ ì„¤ì •ìœ¼ë¡œ ë¶„ë¦¬
- **í”ŒëŸ¬ê·¸ì¸ ì•„í‚¤í…ì²˜**: ìƒˆë¡œìš´ ì¥ë¥´/ë¶„ìœ„ê¸° ì‰½ê²Œ ì¶”ê°€ ê°€ëŠ¥
- **í…Œë§ˆ ì‹œìŠ¤í…œ**: ë‹¤ì–‘í•œ ë””ìì¸ í…Œë§ˆ ì§€ì› ê°€ëŠ¥

### ì¬ì‚¬ìš©ì„±
- **ê³µí†µ ì»´í¬ë„ŒíŠ¸**: ë²„íŠ¼, ì…ë ¥ í•„ë“œ, ì¹´ë“œ ë“± ì¬ì‚¬ìš© ê°€ëŠ¥
- **í›… íŒ¨í„´**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ ë¶„ë¦¬
- **ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜**: ì‹œê°„ í¬ë§·íŒ…, ë°ì´í„° ë³€í™˜ ë“± ê³µí†µ í•¨ìˆ˜
- **ìŠ¤íƒ€ì¼ í† í°**: ì¼ê´€ëœ ë””ìì¸ì„ ìœ„í•œ í† í° ì‹œìŠ¤í…œ

## ğŸš€ ì¶”í›„ í™•ì¥ ê³„íš

### ë‹¨ê¸° ê°œë°œ ê³„íš
1. **ì•Œë¦¼ ì‹œìŠ¤í…œ**: Toast ë©”ì‹œì§€ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
2. **ë¡œë”© ìƒíƒœ**: ë” ì„¸ë°€í•œ ë¡œë”© ìƒíƒœ ê´€ë¦¬
3. **ì—ëŸ¬ ì²˜ë¦¬**: ì „ì—­ ì—ëŸ¬ ë°”ìš´ë”ë¦¬ êµ¬í˜„
4. **ì ‘ê·¼ì„± ê°œì„ **: í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜, ìŠ¤í¬ë¦° ë¦¬ë” ì§€ì›

### ì¤‘ê¸° ê°œë°œ ê³„íš
1. **ê³ ê¸‰ ì„¤ì •**: í…œí¬, ì•…ê¸°, ìŒì•… êµ¬ì¡° ì„¤ì •
2. **ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥**: ìƒì„± ì „ ìƒ˜í”Œ ì²­ì·¨
3. **í˜‘ì—… ê¸°ëŠ¥**: ìŒì•… ê³µìœ  ë° ëŒ“ê¸€
4. **ë¶„ì„ ê¸°ëŠ¥**: ì‚¬ìš©ì ì„ í˜¸ë„ ë¶„ì„

### ì¥ê¸° ê°œë°œ ê³„íš
1. **AI ëª¨ë¸ ì„ íƒ**: ë‹¤ì–‘í•œ AI ëª¨ë¸ ì¤‘ ì„ íƒ ê°€ëŠ¥
2. **ì‹¤ì‹œê°„ í˜‘ì—…**: ì—¬ëŸ¬ ì‚¬ìš©ìê°€ í•¨ê»˜ ìŒì•… ì œì‘
3. **ëª¨ë°”ì¼ ì•±**: React Nativeë¡œ ëª¨ë°”ì¼ ë²„ì „ ê°œë°œ
4. **í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ**: ì„œë“œíŒŒí‹° ê¸°ëŠ¥ ì¶”ê°€ ì§€ì›

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- **ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸**: React Testing Library ì‚¬ìš©
- **ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜**: Jest ê¸°ë°˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- **ìƒíƒœ ê´€ë¦¬**: Context ë° Reducer í…ŒìŠ¤íŠ¸

### í†µí•© í…ŒìŠ¤íŠ¸
- **í˜ì´ì§€ í”Œë¡œìš°**: ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ê¸°ë°˜ í…ŒìŠ¤íŠ¸
- **API ì—°ë™**: Mock Service Workerë¡œ API ëª¨í‚¹
- **ë¼ìš°íŒ…**: React Router í…ŒìŠ¤íŠ¸

### E2E í…ŒìŠ¤íŠ¸
- **ì „ì²´ í”Œë¡œìš°**: Cypress ë˜ëŠ” Playwright ì‚¬ìš©
- **í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì €**: ì£¼ìš” ë¸Œë¼ìš°ì € í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸
- **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**: Core Web Vitals ì¸¡ì •

## ğŸ“¦ ë°°í¬ ì „ëµ

### ê°œë°œ í™˜ê²½
- **ê°œë°œ ì„œë²„**: `npm start`ë¡œ ë¡œì»¬ ê°œë°œ
- **Hot Reload**: ì‹¤ì‹œê°„ ì½”ë“œ ë³€ê²½ ë°˜ì˜
- **ê°œë°œ ë„êµ¬**: React DevTools, Redux DevTools

### ìŠ¤í…Œì´ì§• í™˜ê²½
- **ë¹Œë“œ í…ŒìŠ¤íŠ¸**: `npm run build`ë¡œ í”„ë¡œë•ì…˜ ë¹Œë“œ í…ŒìŠ¤íŠ¸
- **ì„±ëŠ¥ ìµœì í™”**: Bundle Analyzerë¡œ ë²ˆë“¤ í¬ê¸° ìµœì í™”
- **ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸**: ë‹¤ì–‘í•œ ë¸Œë¼ìš°ì €/ê¸°ê¸°ì—ì„œ í…ŒìŠ¤íŠ¸

### í”„ë¡œë•ì…˜ í™˜ê²½
- **ì •ì  í˜¸ìŠ¤íŒ…**: Vercel, Netlify ë“± í™œìš©
- **CDN**: ì „ ì„¸ê³„ ë¹ ë¥¸ ë¡œë”© ì†ë„ ë³´ì¥
- **ëª¨ë‹ˆí„°ë§**: ì—ëŸ¬ ì¶”ì  ë° ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### í´ë¼ì´ì–¸íŠ¸ ë³´ì•ˆ
- **XSS ë°©ì§€**: Reactì˜ ê¸°ë³¸ XSS ë³´í˜¸ í™œìš©
- **ë°ì´í„° ê²€ì¦**: ì‚¬ìš©ì ì…ë ¥ ë°ì´í„° ê²€ì¦
- **ë¯¼ê° ì •ë³´**: API í‚¤ ë“± í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬

### API ë³´ì•ˆ
- **HTTPS**: ëª¨ë“  API í†µì‹  ì•”í˜¸í™”
- **í† í° ê´€ë¦¬**: JWT ë“± ì¸ì¦ í† í° ì•ˆì „ ì €ì¥
- **CORS**: ì ì ˆí•œ CORS ì •ì±… ì„¤ì •

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### ë Œë”ë§ ìµœì í™”
- **React.memo**: ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
- **useCallback/useMemo**: í•¨ìˆ˜ ë° ê°’ ë©”ëª¨ì´ì œì´ì…˜
- **ì½”ë“œ ë¶„í• **: React.lazyë¡œ ì»´í¬ë„ŒíŠ¸ ì§€ì—° ë¡œë”©

### ë„¤íŠ¸ì›Œí¬ ìµœì í™”
- **ì´ë¯¸ì§€ ìµœì í™”**: WebP í¬ë§·, ë ˆì´ì§€ ë¡œë”©
- **ë²ˆë“¤ ìµœì í™”**: Tree Shaking, ì½”ë“œ ì••ì¶•
- **ìºì‹±**: ì ì ˆí•œ HTTP ìºì‹± í—¤ë” ì„¤ì •

## ğŸ¤ ê¸°ì—¬ ê°€ì´ë“œë¼ì¸

### ì½”ë”© ì»¨ë²¤ì…˜
- **ESLint**: ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
- **Prettier**: ì½”ë“œ í¬ë§·íŒ… ì¼ê´€ì„±
- **Git Convention**: Conventional Commits ì‚¬ìš©

### Pull Request ê³¼ì •
1. ê¸°ëŠ¥ ë¸Œëœì¹˜ ìƒì„±
2. ì½”ë“œ ì‘ì„± ë° í…ŒìŠ¤íŠ¸
3. PR ìƒì„± ë° ì½”ë“œ ë¦¬ë·°
4. ë¨¸ì§€ ì „ CI/CD í†µê³¼ í™•ì¸

---

ì´ ë¬¸ì„œëŠ” í”„ë¡œì íŠ¸ì˜ ì§€ì†ì ì¸ ë°œì „ê³¼ í•¨ê»˜ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
</file>

<file path="public/index.html">
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>React App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
</file>

<file path="public/manifest.json">
{
  "short_name": "React App",
  "name": "Create React App Sample",
  "icons": [
    {
      "src": "favicon.ico",
      "sizes": "64x64 32x32 24x24 16x16",
      "type": "image/x-icon"
    },
    {
      "src": "logo192.png",
      "type": "image/png",
      "sizes": "192x192"
    },
    {
      "src": "logo512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#000000",
  "background_color": "#ffffff"
}
</file>

<file path="public/robots.txt">
# https://www.robotstxt.org/robotstxt.html
User-agent: *
Disallow:
</file>

<file path="README.md">
# AI Music Studio

Reactì™€ AIë¥¼ í™œìš©í•œ ì›¹ ê¸°ë°˜ ìŒì•… ìƒì„± ë° ë¹„íŠ¸ ë©”ì´í‚¹ ìŠ¤íŠœë””ì˜¤ì…ë‹ˆë‹¤.

AI Music StudioëŠ” ì‚¬ìš©ìê°€ í…ìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸ë‚˜ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ê¸°ë°˜ìœ¼ë¡œ
ìƒˆë¡œìš´ ìŒì•…ì„ ìƒì„±í•˜ê³ , ë‚´ì¥ëœ AI ë¹„íŠ¸ ë©”ì´ì»¤ë¥¼ í†µí•´ ë…ì°½ì ì¸ ë“œëŸ¼
íŒ¨í„´ì„ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.

![Project Screenshot](images/screenshot.png)

------------------------------------------------------------------------

## ì£¼ìš” ê¸°ëŠ¥

-   **AI ìŒì•… ìƒì„±**
    -   ì¥ë¥´, ë¶„ìœ„ê¸°, í…ìŠ¤íŠ¸ ì„¤ëª…ì„ ì¡°í•©í•˜ì—¬ ìƒˆë¡œìš´ ìŒì•…ì„ ìƒì„±í•©ë‹ˆë‹¤.\
    -   ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì²¨ë¶€í•˜ì—¬ ê¸°ì¡´ ë©œë¡œë””ë‚˜ ë¦¬ë“¬ì„ ê¸°ë°˜ìœ¼ë¡œ ìŒì•…ì„
        ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
-   **AI ë¹„íŠ¸ ë©”ì´ì»¤ (Beat Maker)**
    -   Google Magentaì˜ `MusicVAE` ëª¨ë¸ì„ í™œìš©í•œ 9íŠ¸ë™ ë“œëŸ¼ ì‹œí€€ì„œë¥¼
        ì œê³µí•©ë‹ˆë‹¤.\
    -   ë„¤ ê°œì˜ ì½”ë„ˆ í”„ë¦¬ì…‹ì„ AIë¡œ ì‹¤ì‹œê°„ ë¸”ë Œë”©í•˜ì—¬ ìƒˆë¡œìš´ ë¹„íŠ¸ë¥¼
        íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
    -   BPM ë° ë§ˆë”” ì¡°ì ˆ, WAV íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤.
-   **ìŒì•… ë¼ì´ë¸ŒëŸ¬ë¦¬**
    -   ìƒì„±ëœ ëª¨ë“  ìŒì•…ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬, ì¬ìƒ, ê²€ìƒ‰ ë° í•„í„°ë§í•  ìˆ˜
        ìˆìŠµë‹ˆë‹¤.

------------------------------------------------------------------------

## ê¸°ìˆ  ìŠ¤íƒ

-   **í”„ë¡ íŠ¸ì—”ë“œ**: React, React Router, Material-UI (MUI)\
-   **ìƒíƒœ ê´€ë¦¬**: React Context API\
-   **AI & ì˜¤ë””ì˜¤**
    -   Hugging Face / Replicate: í…ìŠ¤íŠ¸ ê¸°ë°˜ ìŒì•… ìƒì„±ì„ ìœ„í•œ ë°±ì—”ë“œ
        API\
    -   @magenta/music & @tensorflow/tfjs: AI ë¹„íŠ¸ ë©”ì´ì»¤ì˜ í•µì‹¬
        (MusicVAE)\
    -   Tone.js: ì›¹ ì˜¤ë””ì˜¤ ì¬ìƒ ë° ì‹œí€€ì‹±\
-   **ë°±ì—”ë“œ**: Python (Flask), aistudio-music-api\
-   **API**: Papago API (í…ìŠ¤íŠ¸ ë²ˆì—­)

------------------------------------------------------------------------

## ì‹œì‘í•˜ê¸°

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

-   Node.js (v16 ì´ìƒ ê¶Œì¥)\
-   npm ë˜ëŠ” yarn\
-   Python 3

### ì„¤ì¹˜ ë° ì‹¤í–‰

1.  **ì €ì¥ì†Œ í´ë¡ **

    ``` bash
    git clone https://github.com/your-username/your-repository.git
    cd your-repository
    ```

2.  **í”„ë¡ íŠ¸ì—”ë“œ ì„¤ì •** (ìƒˆ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰)

    ``` bash
    # ì˜ì¡´ì„± ì„¤ì¹˜
    npm install

    # ê°œë°œ ì„œë²„ ì‹¤í–‰ (http://localhost:3000)
    npm start
    ```

3.  **ë°±ì—”ë“œ ì„¤ì •** (ë‹¤ë¥¸ ìƒˆ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰)

    ``` bash
    cd ai-music-backend

    # ê°€ìƒ í™˜ê²½ ìƒì„± ë° í™œì„±í™” (ê¶Œì¥)
    python -m venv venv
    source venv/bin/activate  # macOS/Linux
    # venv\Scripts\activate    # Windows

    # ì˜ì¡´ì„± ì„¤ì¹˜
    pip install -r requirements.txt

    # .env íŒŒì¼ ìƒì„± ë° API í‚¤ ì„¤ì •
    # (PAPAGO_CLIENT_ID, PAPAGO_CLIENT_SECRET, REPLICATE_API_TOKEN ë“±)

    # ì„œë²„ ì‹¤í–‰ (http://localhost:5000)
    python server.py
    ```

ì´ì œ ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:3000`ìœ¼ë¡œ ì ‘ì†í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„
ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

------------------------------------------------------------------------

## í”„ë¡œì íŠ¸ êµ¬ì¡°

ì´ í”„ë¡œì íŠ¸ëŠ” React í”„ë¡ íŠ¸ì—”ë“œì™€ Python Flask ë°±ì—”ë“œê°€ ë¶„ë¦¬ëœ í˜•íƒœë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

    /
    â”œâ”€â”€ ai-music-backend/    # Python Flask ë°±ì—”ë“œ ì„œë²„
    â”‚   â”œâ”€â”€ server.py        # ë©”ì¸ API ì„œë²„ íŒŒì¼
    â”‚   â””â”€â”€ requirements.txt # ë°±ì—”ë“œ ì˜ì¡´ì„± ëª©ë¡
    â”‚
    â”œâ”€â”€ public/              # ì •ì  íŒŒì¼ (HTML, ì´ë¯¸ì§€ ë“±)
    â”‚
    â””â”€â”€ src/                 # React í”„ë¡ íŠ¸ì—”ë“œ ì†ŒìŠ¤ ì½”ë“œ
        â”œâ”€â”€ components/      # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ê³µìš© ì»´í¬ë„ŒíŠ¸
        â”‚   â”œâ”€â”€ beat/        # ë¹„íŠ¸ ë©”ì´ì»¤ ê´€ë ¨ UI (íŒ¨ë“œ, ê·¸ë¦¬ë“œ ë“±)
        â”‚   â””â”€â”€ common/      # ì¥ë¥´/ë¶„ìœ„ê¸° ì„ íƒ ë“± ë²”ìš© UI
        â”‚
        â”œâ”€â”€ context/         # ì „ì—­ ìƒíƒœ ê´€ë¦¬ (MusicContext)
        â”‚
        â”œâ”€â”€ lib/             # ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë˜í¼ (Magenta.js, Tone.js)
        â”‚   â””â”€â”€ drumsVAE.js  # MusicVAE í•µì‹¬ ë¡œì§
        â”‚
        â”œâ”€â”€ pages/           # í˜ì´ì§€ ë‹¨ìœ„ ì»´í¬ë„ŒíŠ¸
        â”‚   â”œâ”€â”€ MusicGeneration.js
        â”‚   â”œâ”€â”€ MusicConversion.js (BeatMaker)
        â”‚   â””â”€â”€ Library.js
        â”‚
        â”œâ”€â”€ services/        # API í†µì‹  ë¡œì§ (musicApi.js)
        â”‚
        â””â”€â”€ App.js           # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»´í¬ë„ŒíŠ¸
</file>

<file path="src/App.css">
.App {
  text-align: center;
}

.App-logo {
  height: 40vmin;
  pointer-events: none;
}

@media (prefers-reduced-motion: no-preference) {
  .App-logo {
    animation: App-logo-spin infinite 20s linear;
  }
}

.App-header {
  background-color: #282c34;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: calc(10px + 2vmin);
  color: white;
}

.App-link {
  color: #61dafb;
}

@keyframes App-logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
</file>

<file path="src/App.js">
import React from 'react';
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import { ThemeProvider, createTheme } from '@mui/material/styles';
import CssBaseline from '@mui/material/CssBaseline';
import Box from '@mui/material/Box';

// í˜ì´ì§€ ë° ì»´í¬ë„ŒíŠ¸
import Navbar from './components/layout/Navbar';
import MusicGeneration from './pages/MusicGeneration';
import MusicConversion from './pages/MusicConversion';
import ResultPage from './pages/ResultPage';
import Library from './pages/Library';
import AuthPage from './pages/Auth';
import ScoreToMusic from './pages/ScoreToMusic';
import RequireAuth from './components/common/RequireAuth';
import { MusicContextProvider } from './context/MusicContext';

// âœ… MUI í…Œë§ˆ ì„¤ì •
const theme = createTheme({
  palette: {
    mode: 'light',
    primary: { main: '#6366F1' },
    secondary: { main: '#8B5CF6' },
    success: { main: '#10B981' },
    warning: { main: '#F59E0B' },
    error: { main: '#EF4444' },
    background: {
      default: '#F8FAFC',
      paper: '#FFFFFF',
    },
    text: {
      primary: '#1E293B',
      secondary: '#64748B',
    },
  },
  typography: {
    fontFamily: '"Inter", "Roboto", "Helvetica", "Arial", sans-serif',
    h1: { fontSize: '2.5rem', fontWeight: 700 },
    h2: { fontSize: '2rem', fontWeight: 600 },
    h3: { fontSize: '1.5rem', fontWeight: 500 },
    body1: { fontSize: '1rem', fontWeight: 400 },
    caption: { fontSize: '0.875rem', fontWeight: 400 },
  },
  shape: { borderRadius: 8 },
  spacing: 8,
});

function App() {
  return (
    <ThemeProvider theme={theme}>
      <CssBaseline />
      <MusicContextProvider>
        <Router>
          <Box sx={{ display: 'flex', flexDirection: 'column', minHeight: '100vh' }}>
            {/* âœ… ëª¨ë“  í˜ì´ì§€ì—ì„œ ê³µí†µìœ¼ë¡œ ë³´ì—¬ì¤„ Navbar */}
            <Navbar />

            {/* âœ… ë¼ìš°í„°ë¡œ ê° í˜ì´ì§€ ì—°ê²° */}
            <Box component="main" sx={{ flexGrow: 1, bgcolor: 'background.default' }}>
              <Routes>
                {/* ê¸°ë³¸ í™ˆ (AI ìŒì•… ìƒì„±) */}
                <Route path="/" element={<MusicGeneration />} />
                <Route path="/generate" element={<MusicGeneration />} />

                {/* ìŒì•… ë³€í™˜ í˜ì´ì§€ */}
                <Route path="/convert" element={<MusicConversion />} />

                {/* ì•…ë³´ â†’ ìŒì•… ë³€í™˜ í˜ì´ì§€ */}
                <Route path="/score-to-midi" element={<ScoreToMusic />} />

                {/* ê²°ê³¼ í˜ì´ì§€ */}
                <Route path="/result" element={<ResultPage />} />

                {/* ë¼ì´ë¸ŒëŸ¬ë¦¬ (ë¡œê·¸ì¸ í•„ìš”) */}
                <Route
                  path="/library"
                  element={
                    <RequireAuth>
                      <Library />
                    </RequireAuth>
                  }
                />

                {/* ë¡œê·¸ì¸/íšŒì›ê°€ì… */}
                <Route path="/auth" element={<AuthPage />} />

                {/* âœ… ì˜ˆì™¸ ì²˜ë¦¬ (ì˜ëª»ëœ ì£¼ì†Œ â†’ í™ˆìœ¼ë¡œ) */}
                <Route path="*" element={<MusicGeneration />} />
              </Routes>
            </Box>
          </Box>
        </Router>
      </MusicContextProvider>
    </ThemeProvider>
  );
}

export default App;
</file>

<file path="src/App.test.js">
import { render, screen } from '@testing-library/react';
import App from './App';

test('renders learn react link', () => {
  render(<App />);
  const linkElement = screen.getByText(/learn react/i);
  expect(linkElement).toBeInTheDocument();
});
</file>

<file path="src/components/beat/BeatGrid.jsx">
// src/components/beat/BeatGrid.jsx

import React from 'react';
// ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” Typographyë¥¼ import ëª©ë¡ì—ì„œ ì œê±°í–ˆìŠµë‹ˆë‹¤.
import { Box } from '@mui/material';
import { TRACKS } from './presets';

function labelOf(key) {
  switch (key) {
    case 'kick': return 'Kick';
    case 'snare': return 'Snare';
    case 'hatClose': return 'Hat (C)';
    case 'hatOpen': return 'Hat (O)';
    case 'tomLow': return 'Tom (L)';
    case 'tomMid': return 'Tom (M)';
    case 'tomHigh': return 'Tom (H)';
    case 'crash': return 'Crash';
    case 'ride': return 'Ride';
    default: return key;
  }
}

export default function BeatGrid({ pattern, currentStep, onToggle }) {
  // ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” mainTracksì™€ subTracks ë³€ìˆ˜ë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤.

  return (
    // ì „ì²´ë¥¼ ê°ì‹¸ëŠ” Boxì—ì„œ flex ë ˆì´ì•„ì›ƒì„ ì œê±°í•˜ì—¬ ë‹¨ìˆœí™”í–ˆìŠµë‹ˆë‹¤.
    <Box>
      {/* 16ì¹¸ì§œë¦¬ ë©”ì¸ ì‹œí€€ì„œ */}
      <Box sx={{ display: 'grid', gridTemplateColumns: '80px repeat(16, 1fr)', gap: '4px' /* ì¹¸ ì‚¬ì´ ê°„ê²©ì„ ì‚´ì§ ì¤ë‹ˆë‹¤ */ }}>
        {/* í—¤ë” */}
        <Box />
        {Array.from({ length: 16 }).map((_, i) => (
          <Box key={`h${i}`} sx={{ textAlign: 'center', fontSize: 12, color: '#aaa' }}>{i + 1}</Box>
        ))}
        
        {/* 9ì¤„ì„ ëª¨ë‘ ë Œë”ë§í•˜ëŠ” ë¡œì§ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤. */}
        {TRACKS.map((trackName) => (
          <React.Fragment key={trackName}>
            <Box sx={{ color: '#ddd', fontWeight: 600, display: 'flex', alignItems: 'center', height: 28 }}>
              {labelOf(trackName)}
            </Box>
            {(pattern[trackName] || []).map((on, step) => {
              const isNow = step === currentStep;
              return (
                <Box
                  key={`${trackName}-${step}`}
                  onClick={() => onToggle(trackName, step)}
                  sx={{
                    cursor: 'pointer',
                    height: 28,
                    borderRadius: 1,
                    border: '1px solid #333',
                    bgcolor: on ? (isNow ? '#2DD4BF' : '#1e8f7e') : (isNow ? '#333' : '#111'),
                    boxShadow: on ? '0 0 8px rgba(45,212,191,0.35)' : 'none',
                    transition: 'background-color .12s, box-shadow .12s',
                  }}
                />
              );
            })}
          </React.Fragment>
        ))}
      </Box>
    </Box>
  );
}
</file>

<file path="src/components/beat/BlendPad.jsx">
// src/components/beat/BlendPad.jsx
import React, { useEffect, useMemo, useRef, useState } from 'react';
import { Box, Typography, FormControl, Select, MenuItem, Stack } from '@mui/material';
import { PRESETS, TRACKS } from './presets';
import { loadDrumsVAE, encodeCorners, decodeAtPosition } from '../../lib/drumsVAE';

const weights = (x, y) => ({
  A: (1 - x) * (1 - y),
  B: x * (1 - y),
  C: (1 - x) * y,
  D: x * y,
});

// ë‹¨ìˆœ ê°€ì¤‘í•© ë¸”ë Œë”©(ëª¨ë¸ ì‹¤íŒ¨ ì‹œ ëŒ€ë¹„)
function blendPatterns(corners, x, y, thresh = 0.5) {
  const w = weights(x, y);
  const out = {};
  TRACKS.forEach((track) => {
    out[track] = Array.from({ length: 16 }, (_, i) => {
      const v =
        (corners.A?.[track]?.[i] ? 1 : 0) * w.A +
        (corners.B?.[track]?.[i] ? 1 : 0) * w.B +
        (corners.C?.[track]?.[i] ? 1 : 0) * w.C +
        (corners.D?.[track]?.[i] ? 1 : 0) * w.D;
      return v >= thresh;
    });
  });
  return out;
}

export default function BlendPad({ colors, corners, onChangeCorners, onBlend }) {
  const padRef = useRef(null);
  const [pos, setPos] = useState({ x: 0.25, y: 0.25 });
  const [sel, setSel] = useState({
    A: 'Rock 1',
    B: 'Pop Punk',
    C: 'Reggaeton',
    D: 'Samba Full Time',
  });

  const presetNames = useMemo(() => Object.keys(PRESETS), []);

  const [modelReady, setModelReady] = useState(false);
  const encodedRef = useRef(null);
  const decBusyRef = useRef(false);

  // VAE ì¤€ë¹„
  useEffect(() => {
    (async () => {
      try {
        await loadDrumsVAE();
        setModelReady(true);
      } catch (e) {
        console.warn('[BlendPad] VAE ë¡œë”© ì‹¤íŒ¨ â†’ ë‹¨ìˆœ ë¸”ë Œë”©ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.', e);
        setModelReady(false);
      }
    })();
  }, []);

  // ì½”ë„ˆ í”„ë¦¬ì…‹ ì…€ë ‰í„° â†’ corners ë³€ê²½
  useEffect(() => {
    const next = {
      A: PRESETS[sel.A],
      B: PRESETS[sel.B],
      C: PRESETS[sel.C],
      D: PRESETS[sel.D],
    };
    onChangeCorners?.(next);
  }, [sel, onChangeCorners]);

  // corners ë°”ë€Œë©´ ì ë³µê³µê°„ ì¸ì½”ë”©
  useEffect(() => {
    let cancelled = false;
    (async () => {
      if (!modelReady || !corners) return;
      try {
        const enc = await encodeCorners(corners);
        if (!cancelled) encodedRef.current = enc;
      } catch (e) {
        console.warn('[BlendPad] encodeCorners ì‹¤íŒ¨', e);
        encodedRef.current = null;
      }
    })();
    return () => {
      cancelled = true;
    };
  }, [modelReady, corners]);

  // ë“œë˜ê·¸/í´ë¦­ í•¸ë“¤ëŸ¬
  const to01 = (e) => {
    const r = padRef.current.getBoundingClientRect();
    const px = e.clientX ?? (e.touches && e.touches[0]?.clientX);
    const py = e.clientY ?? (e.touches && e.touches[0]?.clientY);
    const x = Math.max(0, Math.min(1, (px - r.left) / r.width));
    const y = Math.max(0, Math.min(1, (py - r.top) / r.height));
    return { x, y };
  };

  const triggerDecode = async (xy) => {
    // ë™ì‹œ í˜¸ì¶œ ë°©ì§€
    if (decBusyRef.current) return;
    decBusyRef.current = true;

    try {
      let newPattern;
      if (modelReady && encodedRef.current) {
        newPattern = await decodeAtPosition(encodedRef.current, xy.x, xy.y, { temperature: 0.5 });
      } else {
        newPattern = blendPatterns(corners, xy.x, xy.y);
      }
      onBlend?.(newPattern);
    } catch (e) {
      console.warn('[BlendPad] decode ì‹¤íŒ¨ â†’ ë‹¨ìˆœ ë¸”ë Œë”©', e);
      onBlend?.(blendPatterns(corners, xy.x, xy.y));
    } finally {
      decBusyRef.current = false;
    }
  };

  const onPointer = (e) => {
    const xy = to01(e);
    setPos(xy);
    triggerDecode(xy);
  };

  return (
    <Box sx={{ p: 2 }}>
      <Typography variant="h6" sx={{ color: colors.text, mb: 1 }}>
        íŒ¨ë“œ ë¸”ë Œë”©
      </Typography>

      {/* ì½”ë„ˆ í”„ë¦¬ì…‹ ì„ íƒ */}
      <Stack direction="row" spacing={1} sx={{ mb: 1 }}>
        {(['A', 'B', 'C', 'D']).map((k) => (
          <FormControl key={k} size="small" sx={{ minWidth: 140 }}>
            <Select
              value={sel[k]}
              onChange={(e) => setSel((prev) => ({ ...prev, [k]: e.target.value }))}
              sx={{ color: colors.text, bgcolor: colors.cardBg, border: `1px solid ${colors.border}` }}
            >
              {presetNames.map((name) => (
                <MenuItem key={name} value={name}>{name}</MenuItem>
              ))}
            </Select>
          </FormControl>
        ))}
      </Stack>

      {/* íŒ¨ë“œ ì˜ì—­ */}
      <Box
        ref={padRef}
        onMouseDown={onPointer}
        onMouseMove={(e) => e.buttons === 1 && onPointer(e)}
        onTouchStart={onPointer}
        onTouchMove={onPointer}
        sx={{
          position: 'relative',
          width: '100%',
          aspectRatio: '1 / 1',
          borderRadius: 2,
          border: `1px solid ${colors.border}`,
          backgroundImage:
            'linear-gradient(to right, rgba(255,255,255,0.06) 1px, transparent 1px), linear-gradient(to bottom, rgba(255,255,255,0.06) 1px, transparent 1px)',
          backgroundSize: '10% 100%, 100% 10%',
          backgroundColor: colors.cardBg,
          cursor: 'crosshair',
          mb: 1.5,
        }}
      >
        {/* í¬ì¸í„° */}
        <Box
          sx={{
            position: 'absolute',
            left: `calc(${pos.x * 100}% - 8px)`,
            top: `calc(${pos.y * 100}% - 8px)`,
            width: 16,
            height: 16,
            borderRadius: 999,
            backgroundColor: colors.accent,
            boxShadow: `0 0 10px ${colors.shadow}`,
            pointerEvents: 'none',
          }}
        />
        {/* ì½”ë„ˆ ë¼ë²¨ */}
        <CornerLabel label={`A: ${sel.A}`} pos={{ left: 8, top: 8 }} />
        <CornerLabel label={`B: ${sel.B}`} pos={{ right: 8, top: 8 }} />
        <CornerLabel label={`C: ${sel.C}`} pos={{ left: 8, bottom: 8 }} />
        <CornerLabel label={`D: ${sel.D}`} pos={{ right: 8, bottom: 8 }} />
      </Box>
    </Box>
  );
}

function CornerLabel({ label, pos }) {
  return (
    <Box
      sx={{
        position: 'absolute',
        fontSize: 12,
        color: '#9aa7b3',
        opacity: 0.9,
        ...pos,
      }}
    >
      {label}
    </Box>
  );
}
</file>

<file path="src/components/beat/BlendPadGhostLayer.jsx">
import React, { useEffect, useRef } from "react";
import { useBeatPad } from "../../state/beatPadStore";
import { cellCache } from "../../lib/beatblender/cellCache";
import { drawMiniPattern } from "../../lib/beatblender/previewRender";
import { useCellGrid } from "../../hooks/useCellGrid";
import { encodeCorners, decodeAtPosition } from "../../lib/drumsVAE";

export default function BlendPadGhostLayer({ corners }) {
  const ref = useRef(null);
  const { state, dispatch } = useBeatPad();
  const { centerOf } = useCellGrid(state.grid.cols, state.grid.rows);

  // ìº”ë²„ìŠ¤ í•´ìƒë„ ë™ê¸°í™”
  useEffect(() => {
    const canvas = ref.current;
    if (!canvas) return;
    const ro = new ResizeObserver(() => {
      const { clientWidth, clientHeight } = canvas;
      if (canvas.width !== clientWidth || canvas.height !== clientHeight) {
        canvas.width = clientWidth || 1;
        canvas.height = clientHeight || 1;
        drawAll();
      }
    });
    ro.observe(canvas);
    return () => ro.disconnect();
    // eslint-disable-next-line
  }, []);

  const drawAll = () => {
    const canvas = ref.current; if (!canvas) return;
    const ctx = canvas.getContext("2d");
    const { width, height } = canvas;
    const { cols, rows } = state.grid;
    const cw = width / cols;
    const rh = height / rows;

    ctx.clearRect(0, 0, width, height);
    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        const idx = r * cols + c;
        const pattern = cellCache.get(state.cellCacheVersion, idx);
        if (!pattern) continue;
        drawMiniPattern(ctx, c * cw, r * rh, cw, rh, pattern, { alpha: 0.22, tracks: 9 });
      }
    }
  };

  // ì¸ì½”ë”© ë³´ì¥
  const ensureEncodings = async () => {
    if (state.cornerEncodings) return state.cornerEncodings;
    if (!corners) return null;
    const enc = await encodeCorners(corners);
    dispatch({ type: "SET_CORNERS", encodings: enc });
    return enc;
  };

  // ì…€ ìºì‹œ ì²œì²œíˆ ì±„ìš°ê¸°
  useEffect(() => {
    let cancelled = false;
    const { cols, rows } = state.grid;

    const work = async (i = 0) => {
      if (cancelled) return;
      const enc = await ensureEncodings();
      if (!enc) return;

      const total = cols * rows;
      const batch = 15;
      for (let k = 0; k < batch && i < total; k++, i++) {
        const r = Math.floor(i / cols);
        const c = i % cols;
        const idx = r * cols + c;
        if (!cellCache.get(state.cellCacheVersion, idx)) {
          const { x, y } = centerOf({ col: c, row: r });
          const pattern = await decodeAtPosition(enc, x, y, 1.1);
          if (pattern) cellCache.set(state.cellCacheVersion, idx, pattern);
        }
      }
      drawAll();
      if (i < total) requestAnimationFrame(() => work(i));
    };

    work();
    return () => { cancelled = true; };
    // eslint-disable-next-line
  }, [state.grid, state.cellCacheVersion, corners]);

  return <canvas ref={ref} className="blendpad-ghost" />;
}
</file>

<file path="src/components/beat/PadToolbar.jsx">
import React from "react";
import { Button, ButtonGroup, Stack, Typography } from "@mui/material";
import { useBeatPad } from "../../state/beatPadStore";
import { encodeCorners, decodeAtPosition } from "../../lib/drumsVAE";

export default function PadToolbar({ corners, onApplyPattern }) {
  const { state, dispatch } = useBeatPad();

  const setMode = (mode) => dispatch({ type: "SET_MODE", mode });

  // ëœë¤ ì¢Œí‘œ í•˜ë‚˜ ë””ì½”ë“œí•´ì„œ íŒ¨í„´ ì ìš©
  const randomPick = async () => {
    let enc = state.cornerEncodings;
    if (!enc && corners) {
      enc = await encodeCorners(corners);
      dispatch({ type: "SET_CORNERS", encodings: enc });
    }
    if (!enc) return;
    const x = Math.random(), y = Math.random();
    const pat = await decodeAtPosition(enc, x, y, 1.1);
    if (pat && onApplyPattern) onApplyPattern(pat);
  };

  // â¬‡ï¸ ì´¤ë¼ë½ ì „í™˜: í˜„ì¬ ê·¸ë ¤ë‘” pathë¥¼ ë”°ë¼ ì—°ì† ë””ì½”ë“œ
  const chwararak = async () => {
    if (!state.path?.length) return; // ê²½ë¡œê°€ ì—†ìœ¼ë©´ ë¬´ì‹œ
    let enc = state.cornerEncodings;
    if (!enc && corners) {
      enc = await encodeCorners(corners);
      dispatch({ type: "SET_CORNERS", encodings: enc });
    }
    if (!enc) return;

    // ê²½ë¡œë¥¼ 30~60ì  ì •ë„ë¡œ ê· ì¼ ì¬ìƒ˜í”Œë§
    const pts = resamplePath(state.path, 40);
    dispatch({ type: "START_INTERPOLATE" });

    for (let i = 0; i < pts.length; i++) {
      const { x, y } = pts[i];
      // ì˜¨ë„ ì‚´ì§ ë†’ì—¬ ë³€í™”ê°
      const pat = await decodeAtPosition(enc, x, y, 1.15);
      if (pat && onApplyPattern) onApplyPattern(pat);
      // ë„ˆë¬´ ë¹ ë¥´ì§€ ì•Šê²Œ í”„ë ˆì„ ê°„ ê°„ê²©
      await delay(70); // 70ms â†’ í•„ìš” ì‹œ 50~120 ì‚¬ì´ë¡œ ì¡°ì ˆ
    }
    dispatch({ type: "END_INTERPOLATE" });
  };

  // ìœ í‹¸ë“¤(ë¡œì»¬)
  const delay = (ms) => new Promise(r => setTimeout(r, ms));
  const resamplePath = (path, target = 40) => {
    if (path.length <= 2) return path;
    // ëˆ„ì  ê¸¸ì´ ê³„ì‚°
    const segLen = [];
    let total = 0;
    for (let i = 1; i < path.length; i++) {
      const dx = path[i].x - path[i-1].x;
      const dy = path[i].y - path[i-1].y;
      const d = Math.hypot(dx, dy);
      segLen.push(d);
      total += d;
    }
    const out = [];
    for (let k = 0; k < target; k++) {
      const t = (k / Math.max(1, target - 1)) * total;
      // tì— í•´ë‹¹í•˜ëŠ” êµ¬ê°„ ì°¾ê¸°
      let acc = 0, idx = 0;
      while (idx < segLen.length && acc + segLen[idx] < t) {
        acc += segLen[idx++];
      }
      if (idx >= segLen.length) { out.push(path[path.length - 1]); break; }
      const u = (t - acc) / Math.max(1e-6, segLen[idx]);
      const a = path[idx], b = path[idx + 1];
      out.push({ x: a.x + (b.x - a.x) * u, y: a.y + (b.y - a.y) * u });
    }
    return out;
  };

  return (
    <Stack direction="row" spacing={1} sx={{ mb: 1, alignItems: "center" }}>
      <ButtonGroup size="small" variant="outlined">
        <Button onClick={() => setMode("CELL")} disabled={state.mode === "CELL"}>ì…€ ëª¨ë“œ</Button>
        <Button onClick={() => setMode("DRAW")} disabled={state.mode === "DRAW"}>ê·¸ë¦¬ê¸° ëª¨ë“œ</Button>
      </ButtonGroup>

      <Button size="small" variant="outlined" onClick={randomPick}>ëœë¤</Button>
      <Button size="small" variant="outlined" onClick={chwararak} disabled={!state.path?.length}>
        ì´¤ë¼ë½ ì „í™˜
      </Button>

      <Typography variant="caption" sx={{ opacity: 0.7, ml: 1 }}>
        ëª¨ë“œ: {state.mode} / ê²½ë¡œì : {state.path?.length ?? 0}
      </Typography>
    </Stack>
  );
}
</file>

<file path="src/components/beat/presets.js">
// src/components/beat/presets.js

export const TRACKS = [
  'kick', 'snare', 'hatClose', 'hatOpen', 
  'tomLow', 'tomMid', 'tomHigh', 'crash', 'ride'
];

function fromBitmask(bitmaskArray) {
  const pattern = {};
  TRACKS.forEach(track => {
    pattern[track] = Array(16).fill(false); // 16ì¹¸ìœ¼ë¡œ ë³€ê²½
  });

  // 16ìŠ¤í…ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
  for (let i = 0; i < 16; i++) {
    const mask = bitmaskArray[i] || 0;
    if ((mask & 1) > 0) pattern.kick[i] = true;
    if ((mask & 2) > 0) pattern.snare[i] = true;
    if ((mask & 4) > 0) pattern.hatClose[i] = true;
    if ((mask & 8) > 0) pattern.hatOpen[i] = true;
    if ((mask & 16) > 0) pattern.tomLow[i] = true;
    if ((mask & 32) > 0) pattern.tomMid[i] = true;
    if ((mask & 64) > 0) pattern.tomHigh[i] = true;
    if ((mask & 128) > 0) pattern.crash[i] = true;
    if ((mask & 256) > 0) pattern.ride[i] = true;
  }
  return pattern;
}

const B = (arr) => (arr.length === 16 ? arr : Array(16).fill(false).map((_, i) => !!arr[i]));

export const PRESETS = {
  // 32ì¹¸ ë°ì´í„° ì¤‘ ì• 16ì¹¸ë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
  "Rock 1": fromBitmask([1, 0, 1, 0, 2, 0, 0, 0, 1, 0, 1, 0, 2, 0, 0, 0]),
  "Rock 2": fromBitmask([385, 0, 1, 0, 256, 0, 1, 1, 386, 0, 0, 1, 256, 0, 1, 0]),
  "Reggaeton": fromBitmask([257, 0, 0, 258, 1, 0, 258, 0, 1, 256, 256, 2, 1, 0, 258, 0]),
  "Breakbeat": fromBitmask([5, 0, 5, 0, 6, 0, 4, 2, 5, 2, 5, 0, 6, 0, 4, 0]),
  "Basic Backbeat": fromBitmask([5, 0, 4, 0, 7, 0, 4, 0, 5, 0, 4, 0, 7, 0, 4, 0]),
  "Boots & Cats": fromBitmask([1, 0, 4, 0, 2, 0, 4, 0, 1, 0, 4, 0, 2, 0, 4, 0]),
  "Pop Punk": fromBitmask([5, 4, 10, 5, 4, 5, 10, 4, 5, 4, 10, 5, 4, 5, 10, 4]),
  "Half Time": fromBitmask([5, 0, 4, 0, 4, 0, 5, 0, 6, 0, 4, 0, 4, 0, 5, 0]),
  "Bossa Half Time": fromBitmask([ 7, 0, 256, 0, 4, 0, 263, 0, 5, 0, 0, 0, 262, 0, 5, 0]),
  "Samba Full Time": fromBitmask([7, 256, 4, 263, 5, 0, 262, 5, 261, 0, 262, 5, 5, 258, 4, 261]),
  "Four on the floor": {
    kick: B([1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0]),
    snare: B([0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0]),
    hatClose: B([1,0,1,0, 1,0,1,0, 1,0,1,0, 1,0,1,0]),
    hatOpen: B([]), tomLow: B([]), tomMid: B([]), tomHigh: B([]), crash: B([]), ride: B([])
  },
  "Busy Hats": {
    kick: B([1,0,0,0, 0,0,1,0, 0,0,0,0, 1,0,0,0]),
    snare: B([0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0]),
    hatClose: B([1,1,0,1, 1,1,0,1, 1,1,0,1, 1,1,0,1]),
    hatOpen: B([0,0,1,0, 0,0,1,0, 0,0,1,0, 0,0,1,0]),
    tomLow: B([]), tomMid: B([]), tomHigh: B([]), crash: B([]), ride: B([])
  },
  "Minimal": {
    kick: B([1,0,0,0, 0,0,0,0, 1,0,0,0, 0,0,0,0]),
    snare: B([]),
    hatClose: B([1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0]),
    hatOpen: B([]), tomLow: B([]), tomMid: B([]), tomHigh: B([]), crash: B([]), ride: B([])
  },
};

export const clonePattern = (p) => {
  const newPattern = {};
  TRACKS.forEach(track => {
    newPattern[track] = p && p[track] ? [...p[track]] : B([]);
  });
  return newPattern;
};
</file>

<file path="src/components/beat/SampleKit.js">
// src/components/beat/SampleKit.js
import * as Tone from 'tone';

// CRA(react-scripts)ì—ì„œ public í´ë”ëŠ” ë£¨íŠ¸ë¡œ ì„œë¹„ìŠ¤ë¨
const BASE = (process.env.PUBLIC_URL || '') + '/samples/505/';

const SAMPLE_PATHS = {
  kick:  `${BASE}kick.mp3`,
  snare: `${BASE}snare.mp3`,
  hatC:  `${BASE}hat-close.mp3`, // ë„¤ íŒŒì¼ëª…ì— ë§ì¶¤
  hatO:  `${BASE}hat-open.mp3`,
  tomL:  `${BASE}tom-low.mp3`,
  tomM:  `${BASE}tom-mid.mp3`,
  tomH:  `${BASE}tom-high.mp3`,
  crash: `${BASE}crash.mp3`,
  ride:  `${BASE}ride.mp3`,
};

export async function createKit() {
  await Tone.start();
  const gain = new Tone.Gain(0.9).toDestination();

  return new Promise((resolve, reject) => {
    const players = new Tone.Players(SAMPLE_PATHS, {
      onload: () => resolve({ players, gain }),
      onerror: (name) => reject(new Error(`Sample load failed: ${name}`)),
    }).connect(gain);
  });
}
</file>

<file path="src/components/beat/TransportBar.jsx">
// src/components/beat/TransportBar.jsx
import React, { useEffect, useMemo, useState } from 'react';
import { Box, Button, IconButton, Stack, TextField, Tooltip, Typography } from '@mui/material';
import PlayArrowIcon from '@mui/icons-material/PlayArrow';
import StopIcon from '@mui/icons-material/Stop';
import DeleteSweepIcon from '@mui/icons-material/DeleteSweep';
import DownloadIcon from '@mui/icons-material/Download';
import SendIcon from '@mui/icons-material/Send';

export default function TransportBar(props) {
  const {
    value,
    bpm: bpmProp,
    bars: barsProp,
    onChangeBpm,
    onChangeBars,
    onPlay,
    onStop,
    onClear,
    onExport,
    onSendToGenerate,
    busy = false,
    busyMsg = '',
  } = props;
  
  const colors = {
    accent: '#2DD4BF',
    background: '#0A0A0A',
    cardBg: '#1A1A1A',
    border: '#333333',
    text: '#FFFFFF',
    textLight: '#CCCCCC',
    shadow: 'rgba(45, 212, 191, 0.3)',
    // ë³€ê²½ì  1: ì •ì§€ ë²„íŠ¼ì— ì‚¬ìš©í•  ë¹¨ê°„ìƒ‰ ì¶”ê°€
    danger: '#EF5350'
  };

  const initialBpm = useMemo(() => {
    if (typeof value?.bpm === 'number') return value.bpm;
    if (typeof bpmProp === 'number') return bpmProp;
    return 96;
  }, [value?.bpm, bpmProp]);

  const initialBars = useMemo(() => {
    if (typeof value?.bars === 'number') return value.bars;
    if (typeof barsProp === 'number') return barsProp;
    return 2;
  }, [value?.bars, barsProp]);

  const [bpmLocal, setBpmLocal] = useState(initialBpm);
  const [barsLocal, setBarsLocal] = useState(initialBars);

  useEffect(() => setBpmLocal(initialBpm), [initialBpm]);
  useEffect(() => setBarsLocal(initialBars), [initialBars]);

  const handleBpmChange = (e) => {
    const v = Math.max(40, Math.min(240, Number(e.target.value) || 0));
    setBpmLocal(v);
    onChangeBpm?.(v);
  };

  const handleBarsChange = (e) => {
    const raw = Number(e.target.value) || 1;
    const v = Math.max(1, Math.min(16, raw));
    setBarsLocal(v);
    onChangeBars?.(v);
  };

  return (
    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5, flexWrap: 'wrap' }}>
      <Stack direction="row" spacing={1} alignItems="center" sx={{ mr: 1 }}>
        <Tooltip title="ì¬ìƒ">
          <span>
            <IconButton 
              color="primary" 
              onClick={onPlay} 
              disabled={busy} 
              size="large"
              sx={{ color: colors.accent, '&:hover': { backgroundColor: 'rgba(45, 212, 191, 0.1)' } }}
            >
              <PlayArrowIcon fontSize="large" />
            </IconButton>
          </span>
        </Tooltip>
        <Tooltip title="ì •ì§€">
          <span>
            {/* ë³€ê²½ì  1: ì •ì§€ ë²„íŠ¼ ìƒ‰ìƒì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½ */}
            <IconButton 
              onClick={onStop} 
              disabled={busy} 
              size="large"
              sx={{ color: colors.danger, '&:hover': { backgroundColor: 'rgba(239, 83, 80, 0.1)' } }}
            >
              <StopIcon fontSize="large" />
            </IconButton>
          </span>
        </Tooltip>
        <Tooltip title="ì´ˆê¸°í™”">
          <span>
            <IconButton 
              onClick={onClear} 
              disabled={busy} 
              size="large"
              sx={{ color: colors.textLight, '&:hover': { backgroundColor: 'rgba(255, 255, 255, 0.1)' } }}
            >
              <DeleteSweepIcon fontSize="large" />
            </IconButton>
          </span>
        </Tooltip>
      </Stack>

      <Stack direction="row" spacing={1.5} alignItems="center">
        <TextField
          label="BPM"
          type="number"
          value={bpmLocal}
          onChange={handleBpmChange}
          inputProps={{ min: 40, max: 240 }}
          sx={{ 
            width: 120,
            '& .MuiInputBase-root': { bgcolor: '#111', color: colors.text, borderRadius: 2 },
            '& .MuiOutlinedInput-notchedOutline': { borderColor: colors.border },
            '& .MuiInputLabel-root': { color: colors.textLight },
            '&.Mui-focused .MuiInputLabel-root': { color: colors.accent },
          }}
          disabled={busy}
        />
        <TextField
          label="ë§ˆë””"
          type="number"
          value={barsLocal}
          onChange={handleBarsChange}
          inputProps={{ min: 1, max: 16 }}
          sx={{ 
            width: 120,
            '& .MuiInputBase-root': { bgcolor: '#111', color: colors.text, borderRadius: 2 },
            '& .MuiOutlinedInput-notchedOutline': { borderColor: colors.border },
            '& .MuiInputLabel-root': { color: colors.textLight },
            '&.Mui-focused .MuiInputLabel-root': { color: colors.accent },
          }}
          disabled={busy}
        />
      </Stack>

      <Stack direction="row" spacing={1.5} sx={{ ml: 'auto' }}>
        <Button
          variant="outlined"
          startIcon={<DownloadIcon />}
          onClick={onExport}
          disabled={busy}
          size="large"
          sx={{
            borderColor: colors.accent,
            color: colors.accent,
            '&:hover': {
              borderColor: colors.accent,
              backgroundColor: 'rgba(45, 212, 191, 0.1)'
            }
          }}
        >
          {/* ë³€ê²½ì  2: '(WAV)' í…ìŠ¤íŠ¸ ì œê±° */}
          ë‹¤ìš´ë¡œë“œ
        </Button>
        <Button
          variant="contained"
          startIcon={<SendIcon />}
          onClick={onSendToGenerate}
          disabled={busy}
          size="large"
          sx={{
            bgcolor: colors.accent,
            color: colors.background,
            '&:hover': {
              bgcolor: '#28bfa8'
            }
          }}
        >
          ìƒì„±í•˜ê¸°ë¡œ ë³´ë‚´ê¸°
        </Button>
      </Stack>

      {busy ? (
        <Typography variant="body2" sx={{ ml: 2, opacity: 0.8 }}>
          {busyMsg || 'ì²˜ë¦¬ ì¤‘...'}
        </Typography>
      ) : null}
    </Box>
  );
}
</file>

<file path="src/components/common/AudioWaveform.js">
import React, { useEffect, useState } from 'react';
import { Box } from '@mui/material';

const AudioWaveform = ({ 
  isPlaying = false, 
  progress = 0, 
  height = 80, 
  barCount = 50,
  color = '#8B5CF6'
}) => {
  const [bars, setBars] = useState([]);

  // ê²€ì€ìƒ‰ ë°°ê²½ì— ì—ë©”ë„ë“œ í…Œë§ˆ
  const colors = {
    primary: '#50E3C2',           // ì—ë©”ë„ë“œ (Emerald)
    secondary: '#40D9B8',         // ì—°í•œ ì—ë©”ë„ë“œ
    accent: '#2DD4BF',            // í„°ì½°ì´ì¦ˆ (Teal)
  };

  useEffect(() => {
    // ëœë¤í•œ ë†’ì´ì˜ ë°”ë“¤ì„ ìƒì„±
    const newBars = Array.from({ length: barCount }, () => Math.random() * 0.8 + 0.2);
    setBars(newBars);
  }, [barCount]);

  useEffect(() => {
    if (!isPlaying) return;

    const interval = setInterval(() => {
      setBars(prev => prev.map(() => Math.random() * 0.8 + 0.2));
    }, 150);

    return () => clearInterval(interval);
  }, [isPlaying]);

  const progressBarIndex = Math.floor((progress / 100) * bars.length);

  return (
    <Box
      sx={{
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        gap: '2px',
        height: height,
        padding: '10px',
        bgcolor: 'rgba(255, 255, 255, 0.05)',
        borderRadius: 2,
        overflow: 'hidden'
      }}
    >
      {bars.map((barHeight, index) => (
        <Box
          key={index}
                      sx={{
              width: '3px',
              bgcolor: isPlaying && index <= progressBarIndex ? colors.primary : colors.secondary,
              borderRadius: '2px',
              transition: 'all 0.1s ease',
              height: `${barHeight * height * 0.8}px`,
              opacity: isPlaying && index <= progressBarIndex ? 1 : 0.6
            }}
          onClick={() => {
            // í´ë¦­ ì‹œ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™í•˜ëŠ” ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
          }}
        />
      ))}
    </Box>
  );
};

export default AudioWaveform;
</file>

<file path="src/components/common/GenreCardSelector.js">
import React, { useState } from 'react';
import {
  Box,
  Typography,
  Card,
  CardContent,
  Grid
} from '@mui/material';

// ì¥ë¥´ ì˜µì…˜ë“¤ (ì‹¤ì œ ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ í¬í•¨)
export const GENRE_CARD_OPTIONS = [
  { 
    id: 'classic', 
    label: 'í´ë˜ì‹', 
    gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
    image: '/images/genres/classic.jpg', // ì‹¤ì œ ì´ë¯¸ì§€ ê²½ë¡œ
    fallbackIcon: 'ğŸ¼'
  },
  { 
    id: 'edm', 
    label: 'EDM', 
    gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
    image: '/images/genres/edm.jpg',
    fallbackIcon: 'ğŸ›ï¸'
  },
  { 
    id: 'citypop', 
    label: 'City pop', 
    gradient: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
    image: '/images/genres/citypop.jpg',
    fallbackIcon: 'ğŸŒƒ'
  },
  { 
    id: 'jazz', 
    label: 'ì¬ì¦ˆ', 
    gradient: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
    image: '/images/genres/jazz.jpg',
    fallbackIcon: 'ğŸ·'
  },
  { 
    id: 'lofi', 
    label: 'Lo-Fi', 
    gradient: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
    image: '/images/genres/lofi.jpg',
    fallbackIcon: 'ğŸ§'
  }
];
  
// ì´ë¯¸ì§€ ì»´í¬ë„ŒíŠ¸ (ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ fallback)
const GenreImage = ({ genre }) => {
  const [imageError, setImageError] = useState(false);
  
  if (imageError) {
    // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê·¸ë¼ë””ì–¸íŠ¸ì™€ ì•„ì´ì½˜ í‘œì‹œ
    return (
      <Box
        sx={{
          height: 140, // ë” í° ë†’ì´
          background: genre.gradient,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          position: 'relative',
          overflow: 'hidden'
        }}
      >
        <Typography
          sx={{
            fontSize: '3rem', // ë” í° ì•„ì´ì½˜
            filter: 'drop-shadow(0 2px 4px rgba(0,0,0,0.3))'
          }}
        >
          {genre.fallbackIcon}
        </Typography>
      </Box>
    );
  }
  
  return (
    <Box
      sx={{
        height: 140, // ë” í° ë†’ì´
        position: 'relative',
        overflow: 'hidden',
        background: genre.gradient
      }}
    >
      <img
        src={genre.image}
        alt={genre.label}
        onError={() => setImageError(true)}
        style={{
          width: '100%',
          height: '100%',
          objectFit: 'cover',
          position: 'absolute',
          top: 0,
          left: 0
        }}
      />
    </Box>
  );
};

const GenreCardSelector = ({  
selectedGenres = [], 
onGenreChange, 
maxSelection = 1
}) => {
  const colors = {
    cardBg: '#1A1A1A',
    text: '#FFFFFF',
    border: '#333333',
    accent: '#FFD700'
  };

  const handleGenreClick = (genreId) => {
    let newGenres;
    
    if (selectedGenres.includes(genreId)) {
      newGenres = selectedGenres.filter(id => id !== genreId);
    } else {
      if (maxSelection === 1) {
        newGenres = [genreId];
      } else {
        if (selectedGenres.length < maxSelection) {
          newGenres = [...selectedGenres, genreId];
        } else {
          return;
        }
      }
    }
    
    onGenreChange(newGenres);
  };

  return (
    <Grid container spacing={3}> {/* spacing ì¦ê°€ */}
      {GENRE_CARD_OPTIONS.map((genre) => (
        <Grid item xs={12} sm={6} md={6} key={genre.id}> {/* ë” ë„“ì€ ê·¸ë¦¬ë“œ í¬ê¸° */}
          <Card
            onClick={() => handleGenreClick(genre.id)}
            sx={{
              cursor: 'pointer',
              borderRadius: 4, // ë” ë‘¥ê·¼ ëª¨ì„œë¦¬
              overflow: 'hidden',
              border: selectedGenres.includes(genre.id) 
                ? `3px solid ${colors.accent}` 
                : 'none', // ì„ íƒ ì•ˆëœ ì¹´ë“œëŠ” í…Œë‘ë¦¬ ì—†ìŒ
              outline: 'none', // ì•„ì›ƒë¼ì¸ë„ ì œê±°
              boxShadow: selectedGenres.includes(genre.id) ? undefined : 'none', // ì„ íƒ ì•ˆëœ ì¹´ë“œëŠ” ê·¸ë¦¼ìë„ ì œê±°
              transition: 'all 0.3s ease-in-out',
              '&:hover': {
                transform: 'translateY(-6px)',
                boxShadow: `0 12px 35px rgba(255, 215, 0, 0.4)`
              },
              position: 'relative',
              height: '100%' // ì¹´ë“œ ì „ì²´ ë†’ì´ ì‚¬ìš©
            }}
          >
            {/* ë°°ê²½ ì´ë¯¸ì§€ */}
            <Box sx={{ position: 'relative' }}>
              <GenreImage genre={genre} />
              
              {/* ì„ íƒëœ ê²½ìš° ì˜¤ë²„ë ˆì´ */}
              {selectedGenres.includes(genre.id) && (
                <Box
                  sx={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    bgcolor: 'rgba(255, 215, 0, 0.2)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center'
                  }}
                >
                  <Box
                    sx={{
                      width: 32, // ë” í° ì²´í¬ë§ˆí¬
                      height: 32,
                      borderRadius: '50%',
                      bgcolor: colors.accent,
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      color: '#000000',
                      fontWeight: 'bold',
                      fontSize: '1.2rem'
                    }}
                  >
                    âœ“
                  </Box>
                </Box>
              )}
            </Box>
            
            {/* ì¥ë¥´ ì´ë¦„ */}
            <CardContent 
              sx={{ 
                p: 2.5, // ë” í° íŒ¨ë”©
                bgcolor: colors.cardBg,
                '&:last-child': { pb: 2.5 },
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                height: 80, // ë” í° í…ìŠ¤íŠ¸ ì˜ì—­
                border: 'none', // í…Œë‘ë¦¬ ì œê±°
                borderTop: 'none' // ìƒë‹¨ í…Œë‘ë¦¬ë„ ì œê±°
              }}
            >
              <Typography
                variant="h6" // ë” í° í…ìŠ¤íŠ¸
                sx={{
                  color: colors.text,
                  fontWeight: 600,
                  textAlign: 'center',
                  fontSize: '1.1rem'
                }}
              >
                {genre.label}
              </Typography>
            </CardContent>
          </Card>
        </Grid>
      ))}
    </Grid>
  );
};

export default GenreCardSelector;
</file>

<file path="src/components/common/GenreSelector.js">
import React from 'react';
import {
  Box,
  Typography,
  Chip,
  Alert
} from '@mui/material';

// ì¥ë¥´ ì˜µì…˜ë“¤
export const GENRE_OPTIONS = [
  { id: 'classic', label: 'í´ë˜ì‹' },
  { id: 'edm', label: 'EDM' },
  { id: 'citypop', label: 'City pop' },
  { id: 'jazz', label: 'ì¬ì¦ˆ' },
  { id: 'lofi', label: 'Lo-Fi' }
];

const GenreSelector = ({ 
  selectedGenres = [], 
  onGenreChange, 
  maxSelection = 1,  // í•˜ë‚˜ë§Œ ì„ íƒ ê°€ëŠ¥
  title = "ì¥ë¥´ ì„ íƒ" 
}) => {
  // ê²€ì€ìƒ‰ ë°°ê²½ì— ì—ë©”ë„ë“œ í…Œë§ˆ  
  const colors = {
    background: '#0A0A0A',         // ê²€ì€ìƒ‰ ë°°ê²½
    cardBg: '#1A1A1A',            // ì–´ë‘ìš´ ì¹´ë“œ ë°°ê²½
    primary: '#50E3C2',           // ì—ë©”ë„ë“œ (Emerald)
    secondary: '#40D9B8',         // ì—°í•œ ì—ë©”ë„ë“œ
    accent: '#2DD4BF',            // í„°ì½°ì´ì¦ˆ (Teal)
    text: '#FFFFFF',              // í°ìƒ‰ í…ìŠ¤íŠ¸
    textLight: '#CCCCCC',         // ì—°í•œ íšŒìƒ‰ í…ìŠ¤íŠ¸
    border: '#333333',            // ì–´ë‘ìš´ í…Œë‘ë¦¬
    shadow: 'rgba(80, 227, 194, 0.3)' // ì—ë©”ë„ë“œ ê·¸ë¦¼ì
  };

  const handleGenreClick = (genreId) => {
    // ì¥ë¥´ëŠ” í•˜ë‚˜ë§Œ ì„ íƒ ê°€ëŠ¥
    const newGenres = selectedGenres.includes(genreId) ? [] : [genreId];
    onGenreChange(newGenres);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1.5 }}>
        {GENRE_OPTIONS.map((genre) => (
          <Chip
            key={genre.id}
            label={genre.label}
            onClick={() => handleGenreClick(genre.id)}
            sx={{
              height: 42,
              fontSize: '0.9rem',
              fontWeight: 600,
              borderRadius: '12px',
              color: selectedGenres.includes(genre.id) ? colors.background : colors.text,
              bgcolor: selectedGenres.includes(genre.id) ? colors.primary : 'transparent',
              borderColor: selectedGenres.includes(genre.id) ? colors.primary : colors.border,
              '&:hover': {
                bgcolor: selectedGenres.includes(genre.id) ? colors.secondary : colors.cardBg,
                borderColor: colors.primary
              },
              transition: 'all 0.3s ease-in-out',
            }}
          />
        ))}
      </Box>
    </Box>
  );
};

export default GenreSelector;
</file>

<file path="src/components/common/MoodSelector.js">
import React from 'react';
import {
  Box,
  Typography,
  Chip,
  Alert
} from '@mui/material';

// ë¶„ìœ„ê¸° ì˜µì…˜ë“¤
export const MOOD_OPTIONS = [
  { id: 'happy', label: 'í–‰ë³µí•œ' },
  { id: 'sad', label: 'ìŠ¬í”ˆ' },
  { id: 'energetic', label: 'í™œê¸°ì°¬' },
  { id: 'calm', label: 'ì°¨ë¶„í•œ' },
  { id: 'romantic', label: 'ë¡œë§¨í‹±í•œ' },
  { id: 'peaceful', label: 'í‰í™”ë¡œìš´' },
  { id: 'dark', label: 'ì–´ë‘ìš´' },
  { id: 'uplifting', label: 'í¬ë§ì ì¸' },
  { id: 'melancholic', label: 'ìš°ìš¸í•œ' },
  { id: 'playful', label: 'ì¥ë‚œìŠ¤ëŸ¬ìš´' },
  { id: 'intense', label: 'ê°•ë ¬í•œ' },
  { id: 'dreamy', label: 'ëª½í™˜ì ì¸' }
];

const MoodSelector = ({ 
  selectedMoods = [], 
  onMoodChange, 
  maxSelection = 3,  // 3ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥
  title = "ë¶„ìœ„ê¸° ì„ íƒ" 
}) => {
  // ê²€ì€ìƒ‰ ë°°ê²½ì— ì—ë©”ë„ë“œ í…Œë§ˆ
  const colors = {
    background: '#0A0A0A',         // ê²€ì€ìƒ‰ ë°°ê²½
    cardBg: '#1A1A1A',            // ì–´ë‘ìš´ ì¹´ë“œ ë°°ê²½
    primary: '#50E3C2',           // ì—ë©”ë„ë“œ (Emerald)
    secondary: '#40D9B8',         // ì—°í•œ ì—ë©”ë„ë“œ
    accent: '#2DD4BF',            // í„°ì½°ì´ì¦ˆ (Teal)
    text: '#FFFFFF',              // í°ìƒ‰ í…ìŠ¤íŠ¸
    textLight: '#CCCCCC',         // ì—°í•œ íšŒìƒ‰ í…ìŠ¤íŠ¸
    border: '#333333',            // ì–´ë‘ìš´ í…Œë‘ë¦¬
    shadow: 'rgba(80, 227, 194, 0.3)' // ì—ë©”ë„ë“œ ê·¸ë¦¼ì
  };

  const handleMoodClick = (moodId) => {
    let newMoods;
    
    if (selectedMoods.includes(moodId)) {
      newMoods = selectedMoods.filter(id => id !== moodId);
    } else {
      if (selectedMoods.length < maxSelection) {
        newMoods = [...selectedMoods, moodId];
      } else {
        return;
      }
    }
    
    onMoodChange(newMoods);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1.5 }}>
        {MOOD_OPTIONS.map((mood) => (
          <Chip
            key={mood.id}
            label={mood.label}
            onClick={() => handleMoodClick(mood.id)}
            sx={{
              height: 42,
              fontSize: '0.9rem',
              fontWeight: 600,
              borderRadius: '20px',  
              bgcolor: selectedMoods.includes(mood.id) ? colors.primary : colors.cardBg,
              color: selectedMoods.includes(mood.id) ? '#FFFFFF' : colors.textLight,
              border: `2px solid ${selectedMoods.includes(mood.id) ? colors.primary : colors.border}`,
              '&:hover': {
                bgcolor: selectedMoods.includes(mood.id) ? colors.accent : colors.cardBg,
                color: '#FFFFFF',
                borderColor: selectedMoods.includes(mood.id) ? colors.accent : colors.border,
                transform: 'translateY(-2px)',
                boxShadow: `0 6px 16px ${colors.shadow}`
              },
              transition: 'all 0.3s ease-in-out',
            }}
          />
        ))}
      </Box>

      {selectedMoods.length === maxSelection && (
        <Alert 
          severity="info" 
          sx={{ 
            mt: 2,
            bgcolor: colors.primary,
            border: `1px solid ${colors.border}`,
            color: '#FFFFFF',
            '& .MuiAlert-icon': {
              color: '#FFFFFF'
            }
          }}
        >
          ìµœëŒ€ {maxSelection}ê°œì˜ ë¶„ìœ„ê¸°ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¶„ìœ„ê¸°ë¥¼ ì„ íƒí•˜ë ¤ë©´ ê¸°ì¡´ ì„ íƒì„ í•´ì œí•´ì£¼ì„¸ìš”.
        </Alert>
      )}
    </Box>
  );
};

export default MoodSelector;
</file>

<file path="src/components/common/RequireAuth.jsx">
import React from 'react';
import { Navigate, useLocation } from 'react-router-dom';
import { Box, CircularProgress, Typography } from '@mui/material';

import { useMusicContext } from '../../context/MusicContext';

export default function RequireAuth({ children }) {
  const {
    state: {
      auth: { user, status },
    },
  } = useMusicContext();
  const location = useLocation();

  if (status === 'loading' || status === 'idle') {
    return (
      <Box
        sx={{
          minHeight: '80vh',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          flexDirection: 'column',
          gap: 2,
          bgcolor: '#050505',
        }}
      >
        <CircularProgress size={36} sx={{ color: '#2DD4BF' }} />
        <Typography sx={{ color: '#8FA3B5', fontWeight: 500 }}>
          ì ‘ì† ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ìˆì–´ìš”...
        </Typography>
      </Box>
    );
  }

  if (!user) {
    return <Navigate to="/auth" replace state={{ from: location.pathname }} />;
  }

  return children;
}
</file>

<file path="src/components/layout/Navbar.js">
// src/components/layout/Navbar.js
import React from 'react';
import { 
  AppBar, 
  Toolbar, 
  Typography, 
  Button, 
  Box,
  Container,
  IconButton
} from '@mui/material';
import { Menu } from '@mui/icons-material';
import { useNavigate } from 'react-router-dom';
import { useMusicContext } from '../../context/MusicContext';

const colors = {
  background: '#0A0A0A',
  cardBg: '#1A1A1A',
  primary: '#50E3C2',
  secondary: '#40D9B8',
  accent: '#2DD4BF',
  text: '#FFFFFF',
  textLight: '#CCCCCC',
  border: '#333333',
  shadow: 'rgba(80, 227, 194, 0.3)'
};

const Navbar = () => {
  const navigate = useNavigate();
  const { state, actions } = useMusicContext();
  const auth = state.auth;
  const isAuthed = Boolean(auth.user);

  const handleNavigation = (path) => {
    navigate(path);
  };

  const handleSignOut = async () => {
    try {
      await actions.signOut();
    } catch (error) {
      console.error(error);
    }
  };

  return (
    <AppBar 
      position="sticky" 
      elevation={0}
      sx={{
        bgcolor: colors.cardBg,
        borderBottom: `1px solid ${colors.accent}`,
      }}
    >
      <Container maxWidth="xl">
        <Toolbar 
          disableGutters
          sx={{
            minHeight: { xs: '64px', md: '80px' },
            justifyContent: 'space-between'
          }}
        >
          {/* ë¡œê³  */}
          <Box 
            sx={{ display: 'flex', alignItems: 'center', cursor: 'pointer' }}
            onClick={() => handleNavigation('/')}
          >
            <Typography
              variant="h6"
              component="div"
              sx={{
                fontWeight: 600,
                color: colors.text,
                fontSize: { xs: '1.2rem', md: '1.5rem' }
              }}
            >
              AI Music Studio
            </Typography>
          </Box>

          {/* ë°ìŠ¤í¬íƒ‘ ë©”ë‰´ */}
          <Box sx={{ display: { xs: 'none', md: 'flex' }, gap: 1 }}>
            <Button
              onClick={() => handleNavigation('/generate')}
              sx={{
                color: colors.text,
                fontWeight: 500,
                textTransform: 'none',
                px: 3,
                py: 1,
                borderRadius: 2,
                '&:hover': { bgcolor: colors.background, color: colors.accent }
              }}
            >
              ìŒì•… ìƒì„±
            </Button>

            <Button
              onClick={() => handleNavigation('/convert')}
              sx={{
                color: colors.text,
                fontWeight: 500,
                textTransform: 'none',
                px: 3,
                py: 1,
                borderRadius: 2,
                '&:hover': { bgcolor: colors.background, color: colors.accent }
              }}
            >
              ë¹„íŠ¸ ë§Œë“¤ê¸°
            </Button>

            <Button
              onClick={() => handleNavigation('/score-to-midi')}
              sx={{
                color: colors.text,
                fontWeight: 500,
                textTransform: 'none',
                px: 3,
                py: 1,
                borderRadius: 2,
                '&:hover': { bgcolor: colors.background, color: colors.accent }
              }}
            >
              ì•…ë³´ ì—°ì£¼
            </Button>

            <Button
              onClick={() => handleNavigation('/library')}
              sx={{
                color: colors.text,
                fontWeight: 500,
                textTransform: 'none',
                px: 3,
                py: 1,
                borderRadius: 2,
                '&:hover': { bgcolor: colors.background, color: colors.accent }
              }}
            >
              ë¼ì´ë¸ŒëŸ¬ë¦¬
            </Button>
          </Box>

          {/* ì‚¬ìš©ì ì¸ì¦ ë²„íŠ¼ */}
          <Box sx={{ display: { xs: 'none', md: 'flex' }, alignItems: 'center', gap: 2 }}>
            {isAuthed ? (
              <>
                <Typography sx={{ color: colors.textLight, fontWeight: 500 }}>
                  {auth.user.displayName || auth.user.email}
                </Typography>
                <Button
                  onClick={handleSignOut}
                  sx={{
                    color: '#041311',
                    bgcolor: colors.accent,
                    px: 3,
                    py: 1,
                    borderRadius: 2,
                    textTransform: 'none',
                    fontWeight: 600,
                    '&:hover': { bgcolor: '#26b8a4' }
                  }}
                >
                  ë¡œê·¸ì•„ì›ƒ
                </Button>
              </>
            ) : (
              <Button
                onClick={() => handleNavigation('/auth')}
                sx={{
                  color: '#041311',
                  bgcolor: colors.accent,
                  px: 3,
                  py: 1,
                  borderRadius: 2,
                  textTransform: 'none',
                  fontWeight: 600,
                  '&:hover': { bgcolor: '#26b8a4' }
                }}
              >
                ë¡œê·¸ì¸
              </Button>
            )}
          </Box>

          {/* ëª¨ë°”ì¼ ë©”ë‰´ */}
          <Box sx={{ display: { xs: 'flex', md: 'none' }, alignItems: 'center', gap: 1 }}>
            <IconButton
              size="large"
              sx={{ color: colors.text, '&:hover': { bgcolor: colors.background, color: colors.accent } }}
              onClick={() => handleNavigation('/generate')} // ëª¨ë°”ì¼ ë©”ë‰´ í´ë¦­ ì‹œ ë‹¨ìˆœ ì´ë™
            >
              <Menu />
            </IconButton>

            {isAuthed ? (
              <Button
                onClick={handleSignOut}
                size="small"
                sx={{
                  color: '#041311',
                  bgcolor: colors.accent,
                  px: 2,
                  borderRadius: 2,
                  textTransform: 'none',
                  fontWeight: 600,
                  '&:hover': { bgcolor: '#26b8a4' }
                }}
              >
                ë¡œê·¸ì•„ì›ƒ
              </Button>
            ) : (
              <Button
                onClick={() => handleNavigation('/auth')}
                size="small"
                sx={{
                  color: '#041311',
                  bgcolor: colors.accent,
                  px: 2,
                  borderRadius: 2,
                  textTransform: 'none',
                  fontWeight: 600,
                  '&:hover': { bgcolor: '#26b8a4' }
                }}
              >
                ë¡œê·¸ì¸
              </Button>
            )}
          </Box>
        </Toolbar>
      </Container>
    </AppBar>
  );
};

export default Navbar;
</file>

<file path="src/hooks/useCellGrid.js">
export function useCellGrid(cols, rows) {
  const clamp01 = (v) => Math.max(0, Math.min(1, v));

  // í™”ë©´ ì¢Œí‘œ(0~1)ë¥¼ -> ì…€ ì¸ë±ìŠ¤ ì •ë³´ë¡œ ë°”ê¾¸ê¸°
  const toCell = (x01, y01) => {
    const c = Math.floor(clamp01(x01) * cols);
    const r = Math.floor(clamp01(y01) * rows);
    const col = Math.min(c, cols - 1);
    const row = Math.min(r, rows - 1);
    return { col, row, index: row * cols + col };
  };

  // ì…€ì˜ ê°€ìš´ë°ì ì„ ë‹¤ì‹œ 0~1 ì¢Œí‘œë¡œ
  const centerOf = ({ col, row }) => ({
    x: (col + 0.5) / cols,
    y: (row + 0.5) / rows,
  });

  return { toCell, centerOf };
}
</file>

<file path="src/hooks/useLerpTween.js">
import { useRef } from "react";

export default function useLerpTween() {
  const rafRef = useRef(null);

  const start = ({ duration = 600, onUpdate, onEnd }) => {
    stop();
    const t0 = performance.now();
    const step = (now) => {
      const t = Math.min(1, (now - t0) / duration);
      onUpdate?.(t);
      if (t < 1) rafRef.current = requestAnimationFrame(step);
      else onEnd?.();
    };
    rafRef.current = requestAnimationFrame(step);
  };

  const stop = () => {
    if (rafRef.current != null) cancelAnimationFrame(rafRef.current);
    rafRef.current = null;
  };

  return { start, stop };
}
</file>

<file path="src/hooks/usePathMode.js">
// ê°„ë‹¨í•œ ê²½ë¡œ ìœ í‹¸ì´ í•„ìš”í•œ ê²½ìš° í™•ì¥í•´ì„œ ì“°ê¸° ìœ„í•œ ìë¦¬(í˜„ì¬ëŠ” store ì•¡ì…˜ìœ¼ë¡œ ì²˜ë¦¬í•˜ë¯€ë¡œ ìµœì†Œí™”)
export function lerp(a, b, t) { return a + (b - a) * t; }

export function samplePath(path, t) {
  if (!path?.length) return { x: 0.5, y: 0.5 };
  if (t <= 0) return path[0];
  if (t >= 1) return path[path.length - 1];
  const n = path.length;
  const idx = t * (n - 1);
  const i = Math.floor(idx);
  const u = idx - i;
  const a = path[i], b = path[Math.min(i + 1, n - 1)];
  return { x: lerp(a.x, b.x, u), y: lerp(a.y, b.y, u) };
}
</file>

<file path="src/index.css">
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}
</file>

<file path="src/index.js">
import './polyfills'; 
import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './App';
import reportWebVitals from './reportWebVitals';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

// If you want to start measuring performance in your app, pass a function
// to log results (for example: reportWebVitals(console.log))
// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals
reportWebVitals();
</file>

<file path="src/lib/beatblender/cellCache.js">
const store = new Map(); // key: `${version}:${index}` -> pattern

export const cellCache = {
  get(version, index) {
    return store.get(`${version}:${index}`) || null;
  },
  set(version, index, pattern) {
    store.set(`${version}:${index}`, pattern);
  },
  clearByVersion(version) {
    // ì„ íƒì : ì§€ê¸ˆì€ êµ³ì´ ì•ˆ ì¨ë„ ë¨
    for (const k of store.keys()) {
      if (k.startsWith(version + ":")) {
        store.delete(k);
      }
    }
  },
};
</file>

<file path="src/lib/beatblender/color.js">
// Copyright 2018 Google LLC
// Licensed under the Apache License, Version 2.0

const clamp01 = (v) => Math.max(0, Math.min(1, v));
const lerp = (a, b, t) => a + (b - a) * t;
const lerpArray = (a, b, t) => {
  const n = Math.min(a.length, b.length);
  const out = new Array(n);
  for (let i = 0; i < n; i++) out[i] = lerp(a[i], b[i], t);
  return out;
};
const times = (n, fn) => Array.from({ length: n }, (_, i) => fn(i, n));

export const generate4PointGradient = (tl, tr, bl, br, columns, rows) => {
  return times(columns, (x, columns) => {
    const cp = columns === 1 ? 0 : x / (columns - 1);
    const topColor = lerpArray(tl, tr, cp);
    const bottomColor = lerpArray(bl, br, cp);
    return times(rows, (y, rows) => {
      const rp = rows === 1 ? 0 : y / (rows - 1);
      return lerpArray(topColor, bottomColor, rp);
    });
  });
};

export const generate4PointGradientAt = (
  tl, tr, bl, br, percentX, percentY, result = []
) => {
  const px = clamp01(percentX ?? 0);
  const py = clamp01(percentY ?? 0);
  const top = lerpArray(tl, tr, px);
  const bot = lerpArray(bl, br, px);
  const out = lerpArray(top, bot, py);
  result.length = 0;
  for (let i = 0; i < out.length; i++) result[i] = out[i];
  return result;
};

export const toCSSString = (arr) => {
  const [r = 0, g = 0, b = 0, a = 1] = arr;
  return `rgba(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)}, ${a})`;
};
</file>

<file path="src/lib/beatblender/coords.js">
export const clamp01 = (v) => Math.max(0, Math.min(1, v));

export const norm01 = (v, min = 0, max = 1) => {
  return clamp01((v - min) / (max - min));
};
</file>

<file path="src/lib/beatblender/previewRender.js">
// ì…€ ì•ˆì— íë¦¿í•œ ë¯¸ë‹ˆ ë“œëŸ¼ íŒ¨í„´ì„ ê·¸ë¦¬ëŠ” ë„í™”ì§€ ìœ í‹¸.
// ì§€ê¸ˆì€ ê·¸ëƒ¥ ì¡´ì¬ë§Œ í•˜ê²Œ ì‹¬í”Œ ë²„ì „.

export function drawMiniPattern(ctx, x, y, w, h, pattern, opts = {}) {
  if (!pattern) return;
  const steps = 16;
  const tracks = opts.tracks ?? 9;
  const alpha = opts.alpha ?? 0.25;

  const cw = w / steps;
  const ch = h / tracks;

  ctx.save();
  ctx.globalAlpha = alpha;

  // pattern[track][step]ì´ 1ì´ë©´ ë°•ìŠ¤ ì°ëŠ”ë‹¤ëŠ” ê°€ì •
  for (let tr = 0; tr < tracks; tr++) {
    for (let s = 0; s < steps; s++) {
      const on =
        pattern?.[tr]?.[s] === 1 ||
        pattern?.[tr]?.[s] === true;
      if (!on) continue;
      ctx.fillRect(
        x + s * cw + 1,
        y + tr * ch + 1,
        Math.max(1, cw - 2),
        Math.max(1, ch - 2)
      );
    }
  }

  ctx.restore();
}
</file>

<file path="src/lib/drumsVAE.js">
// src/lib/drumsVAE.js
import * as tf from '@tensorflow/tfjs';
import { loadMagenta } from './magentaCompat';
import { TRACKS } from '../components/beat/presets';

// Magenta ê³µê°œ ì²´í¬í¬ì¸íŠ¸ (ë“œëŸ¼ VAE)
const CHECKPOINT =
  'https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/drums_kit_hq';

let _mm = null;
let _model = null;

const DRUM_PITCH_MAP = {
  kick: 36,
  snare: 38,
  hatClose: 42,
  hatOpen: 46,
  tomLow: 45,
  tomMid: 47,
  tomHigh: 50,
  crash: 49,
  ride: 51,
};

// VAE ë¡œë“œ
export async function loadDrumsVAE() {
  if (_model) return _model;
  await loadMagenta();

  _mm = window.mm || (await import('@magenta/music'));
  _model = new _mm.MusicVAE(CHECKPOINT);
  await _model.initialize();
  return _model;
}

// ì•±ì˜ pattern ê°ì²´ -> Magenta NoteSequence
export function patternToNoteSequence(pattern) {
  const notes = [];
  TRACKS.forEach((name) => {
    const row = pattern[name] || [];
    row.forEach((on, step) => {
      if (on) {
        notes.push({
          pitch: DRUM_PITCH_MAP[name],
          quantizedStartStep: step,
          quantizedEndStep: step + 1,
        });
      }
    });
  });
  return {
    notes,
    quantizationInfo: { stepsPerQuarter: 4 },
    totalQuantizedSteps: 16,
  };
}

// NoteSequence -> ì•±ì˜ pattern ê°ì²´
export function noteSequenceToPattern(ns) {
  const out = {};
  TRACKS.forEach((n) => (out[n] = Array(16).fill(false)));
  (ns.notes || []).forEach((n) => {
    const step = Math.max(0, Math.min(15, n.quantizedStartStep || 0));
    const name = Object.keys(DRUM_PITCH_MAP).find(
      (k) => DRUM_PITCH_MAP[k] === n.pitch
    );
    if (name) out[name][step] = true;
  });
  return out;
}

// 4ê°œ ì½”ë„ˆ í”„ë¦¬ì…‹ì„ ì ë³µ ê³µê°„ìœ¼ë¡œ ì¸ì½”ë”©
export async function encodeCorners(corners) {
  const model = await loadDrumsVAE();
  const seqs = ['A', 'B', 'C', 'D'].map((k) =>
    patternToNoteSequence(corners[k])
  );
  const z = await model.encode(seqs);
  // TF Tensor -> number[] ë¡œ ë¹¼ë‘ë©´ decode ì‹œ ì¬ì‚¬ìš©ì´ ë¹ ë¦„
  const arr = z.arraySync();
  z.dispose && z.dispose();
  return arr;
}

// (x,y)âˆˆ[0,1]ì—ì„œ 4ì½”ë„ˆë¥¼ ì–‘ì„ í˜• ë³´ê°„í•´ ë””ì½”ë“œ
export async function decodeAtPosition(encodedCorners, x, y, opts = {}) {
  const { temperature = 0.5 } = opts;
  const model = await loadDrumsVAE();
  const [A, B, C, D] = encodedCorners;
  const wA = (1 - x) * (1 - y);
  const wB = x * (1 - y);
  const wC = (1 - x) * y;
  const wD = x * y;

  // z = A*wA + B*wB + C*wC + D*wD
  const dim = A.length;
  const zArr = new Array(dim);
  for (let i = 0; i < dim; i++) {
    zArr[i] = A[i] * wA + B[i] * wB + C[i] * wC + D[i] * wD;
  }

  const z = tf.tensor2d([zArr]);
  const [seq] = await model.decode(z, temperature);
  z.dispose && z.dispose();

  return noteSequenceToPattern(seq);
}
</file>

<file path="src/lib/firebase.js">
import { initializeApp, getApps } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';
import { getStorage } from 'firebase/storage';

const firebaseConfig = {
  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,
  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,
  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.REACT_APP_FIREBASE_APP_ID,
  measurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID,
};

// Guard against missing configuration in development to avoid silent failures.
const missingKeys = Object.entries(firebaseConfig)
  .filter(([, value]) => !value)
  .map(([key]) => key);

if (missingKeys.length) {
  console.warn(
    '[firebase] Missing environment variables:',
    missingKeys.join(', ')
  );
}

const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);

export const auth = getAuth(app);
export const db = getFirestore(app);
export const storage = getStorage(app);
export default app;
</file>

<file path="src/lib/toneCompat.js">
// src/lib/toneCompat.js
let toneModulePromise;

/** Tone.jsë¥¼ ë™ì ìœ¼ë¡œ ë¡œë“œ (v14ëŠ” default export ì—†ìŒ) */
export async function getTone() {
  if (!toneModulePromise) {
    toneModulePromise = import('tone'); // <- í•­ìƒ ëª¨ë“ˆ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê°ì²´ë¥¼ ë°›ìŒ
  }
  return toneModulePromise;
}

/** ìœ ì € ì œìŠ¤ì²˜ í›„ ì˜¤ë””ì˜¤ ì‹œì‘(í•„ìš”í•  ë•Œë§Œ í˜¸ì¶œ) */
export async function ensureAudioStart(toneModule) {
  const Tone = toneModule || (await getTone());
  try {
    await Tone.start(); // í¬ë¡¬/ì‚¬íŒŒë¦¬ì—ì„œ ì‚¬ìš©ì ì œìŠ¤ì²˜ í•„ìš”
  } catch (_) {}
  return Tone.context.state === 'running';
}
</file>

<file path="src/logo.svg">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 841.9 595.3"><g fill="#61DAFB"><path d="M666.3 296.5c0-32.5-40.7-63.3-103.1-82.4 14.4-63.6 8-114.2-20.2-130.4-6.5-3.8-14.1-5.6-22.4-5.6v22.3c4.6 0 8.3.9 11.4 2.6 13.6 7.8 19.5 37.5 14.9 75.7-1.1 9.4-2.9 19.3-5.1 29.4-19.6-4.8-41-8.5-63.5-10.9-13.5-18.5-27.5-35.3-41.6-50 32.6-30.3 63.2-46.9 84-46.9V78c-27.5 0-63.5 19.6-99.9 53.6-36.4-33.8-72.4-53.2-99.9-53.2v22.3c20.7 0 51.4 16.5 84 46.6-14 14.7-28 31.4-41.3 49.9-22.6 2.4-44 6.1-63.6 11-2.3-10-4-19.7-5.2-29-4.7-38.2 1.1-67.9 14.6-75.8 3-1.8 6.9-2.6 11.5-2.6V78.5c-8.4 0-16 1.8-22.6 5.6-28.1 16.2-34.4 66.7-19.9 130.1-62.2 19.2-102.7 49.9-102.7 82.3 0 32.5 40.7 63.3 103.1 82.4-14.4 63.6-8 114.2 20.2 130.4 6.5 3.8 14.1 5.6 22.5 5.6 27.5 0 63.5-19.6 99.9-53.6 36.4 33.8 72.4 53.2 99.9 53.2 8.4 0 16-1.8 22.6-5.6 28.1-16.2 34.4-66.7 19.9-130.1 62-19.1 102.5-49.9 102.5-82.3zm-130.2-66.7c-3.7 12.9-8.3 26.2-13.5 39.5-4.1-8-8.4-16-13.1-24-4.6-8-9.5-15.8-14.4-23.4 14.2 2.1 27.9 4.7 41 7.9zm-45.8 106.5c-7.8 13.5-15.8 26.3-24.1 38.2-14.9 1.3-30 2-45.2 2-15.1 0-30.2-.7-45-1.9-8.3-11.9-16.4-24.6-24.2-38-7.6-13.1-14.5-26.4-20.8-39.8 6.2-13.4 13.2-26.8 20.7-39.9 7.8-13.5 15.8-26.3 24.1-38.2 14.9-1.3 30-2 45.2-2 15.1 0 30.2.7 45 1.9 8.3 11.9 16.4 24.6 24.2 38 7.6 13.1 14.5 26.4 20.8 39.8-6.3 13.4-13.2 26.8-20.7 39.9zm32.3-13c5.4 13.4 10 26.8 13.8 39.8-13.1 3.2-26.9 5.9-41.2 8 4.9-7.7 9.8-15.6 14.4-23.7 4.6-8 8.9-16.1 13-24.1zM421.2 430c-9.3-9.6-18.6-20.3-27.8-32 9 .4 18.2.7 27.5.7 9.4 0 18.7-.2 27.8-.7-9 11.7-18.3 22.4-27.5 32zm-74.4-58.9c-14.2-2.1-27.9-4.7-41-7.9 3.7-12.9 8.3-26.2 13.5-39.5 4.1 8 8.4 16 13.1 24 4.7 8 9.5 15.8 14.4 23.4zM420.7 163c9.3 9.6 18.6 20.3 27.8 32-9-.4-18.2-.7-27.5-.7-9.4 0-18.7.2-27.8.7 9-11.7 18.3-22.4 27.5-32zm-74 58.9c-4.9 7.7-9.8 15.6-14.4 23.7-4.6 8-8.9 16-13 24-5.4-13.4-10-26.8-13.8-39.8 13.1-3.1 26.9-5.8 41.2-7.9zm-90.5 125.2c-35.4-15.1-58.3-34.9-58.3-50.6 0-15.7 22.9-35.6 58.3-50.6 8.6-3.7 18-7 27.7-10.1 5.7 19.6 13.2 40 22.5 60.9-9.2 20.8-16.6 41.1-22.2 60.6-9.9-3.1-19.3-6.5-28-10.2zM310 490c-13.6-7.8-19.5-37.5-14.9-75.7 1.1-9.4 2.9-19.3 5.1-29.4 19.6 4.8 41 8.5 63.5 10.9 13.5 18.5 27.5 35.3 41.6 50-32.6 30.3-63.2 46.9-84 46.9-4.5-.1-8.3-1-11.3-2.7zm237.2-76.2c4.7 38.2-1.1 67.9-14.6 75.8-3 1.8-6.9 2.6-11.5 2.6-20.7 0-51.4-16.5-84-46.6 14-14.7 28-31.4 41.3-49.9 22.6-2.4 44-6.1 63.6-11 2.3 10.1 4.1 19.8 5.2 29.1zm38.5-66.7c-8.6 3.7-18 7-27.7 10.1-5.7-19.6-13.2-40-22.5-60.9 9.2-20.8 16.6-41.1 22.2-60.6 9.9 3.1 19.3 6.5 28.1 10.2 35.4 15.1 58.3 34.9 58.3 50.6-.1 15.7-23 35.6-58.4 50.6zM320.8 78.4z"/><circle cx="420.9" cy="296.5" r="45.7"/><path d="M520.5 78.1z"/></g></svg>
</file>

<file path="src/pages/Library.js">
import React from 'react';
import {
  Container,
  Box,
  Typography,
  Paper,
  Button,
  Grid,
  Card,
  CardContent,
  CardActions,
  IconButton,
  Chip,
  TextField,
  InputAdornment,
  Select,
  MenuItem,
  FormControl,
  InputLabel,
  CircularProgress,
} from '@mui/material';
import { 
  Search,
  PlayArrow,
  Download,
  Delete,
  Favorite,
  MusicNote
} from '@mui/icons-material';

import { useMusicContext } from '../context/MusicContext';
import { GENRE_OPTIONS } from '../components/common/GenreSelector';

const Library = () => {
  const { state, actions } = useMusicContext();
  const [searchQuery, setSearchQuery] = React.useState('');
  const [sortBy, setSortBy] = React.useState('date');
  const [filterBy, setFilterBy] = React.useState('all');

  const { musicList, loading, error } = state.library;

  // ì¥ë¥´ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
  const getGenreInfo = (genreId) => {
    return GENRE_OPTIONS.find(g => g.id === genreId) || { label: genreId, color: '#6366F1' };
  };

  // ì‹œê°„ í¬ë§·íŒ…
  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  // í•„í„°ë§ ë° ì •ë ¬ëœ ìŒì•… ë¦¬ìŠ¤íŠ¸
  const getCreatedAt = (item) => {
    if (!item?.createdAt) return 0;
    if (typeof item.createdAt === 'string') {
      return new Date(item.createdAt).getTime() || 0;
    }
    if (item.createdAt?.toMillis) {
      return item.createdAt.toMillis();
    }
    return Number(item.createdAt) || 0;
  };

  const filteredAndSortedMusic = musicList
    .filter((music) => {
      // ê²€ìƒ‰ í•„í„°
      if (searchQuery && !music.title.toLowerCase().includes(searchQuery.toLowerCase())) {
        return false;
      }
      
      // íƒ€ì… í•„í„°
      if (filterBy !== 'all' && music.type !== filterBy) {
        return false;
      }
      
      return true;
    })
    .sort((a, b) => {
      switch (sortBy) {
        case 'date':
          return getCreatedAt(b) - getCreatedAt(a);
        case 'title':
          return a.title.localeCompare(b.title);
        case 'duration':
          return b.duration - a.duration;
        case 'favorites':
          return b.isFavorite - a.isFavorite;
        default:
          return 0;
      }
    });

  // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤
  const handlePlay = (music) => {
    actions.addNotification({
      type: 'info',
      message: `"${music.title}" ì¬ìƒì„ ì‹œì‘í•©ë‹ˆë‹¤.`
    });
  };

  const handleDownload = (music) => {
    actions.addNotification({
      type: 'success',
      message: `"${music.title}" ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.`
    });
  };

  const handleDelete = (musicId) => {
    actions.addNotification({
      type: 'success',
      message: 'ìŒì•…ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.'
    });
  };

  const handleToggleFavorite = (musicId) => {
    actions.addNotification({
      type: 'info',
      message: 'ì¦ê²¨ì°¾ê¸° ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.'
    });
  };

  // ê²€ì€ìƒ‰ ë°°ê²½ì— ì—ë©”ë„ë“œ í…Œë§ˆ
  const colors = {
    background: '#0A0A0A',         // ê²€ì€ìƒ‰ ë°°ê²½
    cardBg: '#1A1A1A',            // ì–´ë‘ìš´ ì¹´ë“œ ë°°ê²½
    primary: '#50E3C2',           // ì—ë©”ë„ë“œ (Emerald)
    secondary: '#40D9B8',         // ì—°í•œ ì—ë©”ë„ë“œ
    accent: '#2DD4BF',            // í„°ì½°ì´ì¦ˆ (Teal)
    text: '#FFFFFF',              // í°ìƒ‰ í…ìŠ¤íŠ¸
    textLight: '#CCCCCC',         // ì—°í•œ íšŒìƒ‰ í…ìŠ¤íŠ¸
    border: '#333333',            // ì–´ë‘ìš´ í…Œë‘ë¦¬
    shadow: 'rgba(80, 227, 194, 0.3)' // ì—ë©”ë„ë“œ ê·¸ë¦¼ì
  };

  return (
    <Box sx={{ 
      minHeight: '100vh', 
      bgcolor: colors.background,
      backgroundImage: 'linear-gradient(135deg, #0A0A0A 0%, #1A1A1A 100%)'
    }}>
      <Container maxWidth="xl" sx={{ py: 6 }}>
        {/* í˜ì´ì§€ í—¤ë” */}
        <Box sx={{ mb: 6, textAlign: 'center' }}>
          
          <Typography 
            variant="h2" 
            component="h1"
            sx={{ 
              fontWeight: 700,
              color: colors.text,
              mb: 2
            }}
          >
            ë¼ì´ë¸ŒëŸ¬ë¦¬
          </Typography>
          
          <Typography 
            variant="h6" 
            sx={{ 
              color: colors.textLight,
              maxWidth: 600,
              mx: 'auto',
              lineHeight: 1.6
            }}
          >
            ìƒì„±í•˜ê³  ë³€í™˜í•œ ìŒì•…ë“¤ì„ ê´€ë¦¬í•˜ì„¸ìš”
          </Typography>
        </Box>

        {/* ê²€ìƒ‰ ë° í•„í„° */}
        <Paper 
          elevation={0}
          sx={{ 
            p: 4, 
            mb: 4,
            bgcolor: colors.cardBg,
            border: `1px solid ${colors.border}`,
            borderRadius: 3,
            boxShadow: `0 4px 20px ${colors.shadow}`
          }}
        >
          <Grid container spacing={3} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                placeholder="ìŒì•… ì œëª©ìœ¼ë¡œ ê²€ìƒ‰..."
                InputProps={{
                  startAdornment: (
                    <InputAdornment position="start">
                      <Search sx={{ color: colors.textLight }} />
                    </InputAdornment>
                  ),
                }}
                sx={{
                  '& .MuiOutlinedInput-root': {
                    borderRadius: 2,
                    color: colors.text,
                    '& fieldset': {
                      borderColor: colors.border,
                    },
                    '&:hover fieldset': {
                      borderColor: colors.primary,
                    },
                    '&.Mui-focused fieldset': {
                      borderColor: colors.primary,
                    },
                  },
                  '& .MuiInputBase-input::placeholder': {
                    color: colors.textLight,
                    opacity: 1,
                  },
                }}
              />
            </Grid>
            
            <Grid item xs={12} md={4}>
              <FormControl fullWidth>
                <InputLabel sx={{ color: colors.textLight, '&.Mui-focused': { color: colors.primary } }}>ì •ë ¬ ê¸°ì¤€</InputLabel>
                <Select
                  value={sortBy}
                  onChange={(e) => setSortBy(e.target.value)}
                  MenuProps={{
                    PaperProps: {
                      sx: {
                        bgcolor: colors.cardBg,
                        border: `1px solid ${colors.border}`,
                        '& .MuiMenuItem-root': {
                          color: colors.text,
                          '&:hover': {
                            bgcolor: colors.border,
                          },
                          '&.Mui-selected': {
                            bgcolor: colors.primary,
                            color: '#000000',
                            '&:hover': {
                              bgcolor: colors.primary,
                            },
                          },
                        },
                      },
                    },
                  }}
                  sx={{
                    borderRadius: 2,
                    color: colors.text,
                    '& .MuiOutlinedInput-notchedOutline': {
                      borderColor: colors.border,
                    },
                    '&:hover .MuiOutlinedInput-notchedOutline': {
                      borderColor: colors.primary,
                    },
                    '&.Mui-focused .MuiOutlinedInput-notchedOutline': {
                      borderColor: colors.primary,
                    },
                  }}
                >
                  <MenuItem value="date">ìµœì‹ ìˆœ</MenuItem>
                  <MenuItem value="title">ì œëª©ìˆœ</MenuItem>
                  <MenuItem value="duration">ì¬ìƒì‹œê°„</MenuItem>
                  <MenuItem value="favorites">ì¦ê²¨ì°¾ê¸°</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            
            <Grid item xs={12} md={4}>
              <FormControl fullWidth>
                <InputLabel sx={{ color: colors.textLight, '&.Mui-focused': { color: colors.primary } }}>í•„í„°</InputLabel>
                <Select
                  value={filterBy}
                  onChange={(e) => setFilterBy(e.target.value)}
                  MenuProps={{
                    PaperProps: {
                      sx: {
                        bgcolor: colors.cardBg,
                        border: `1px solid ${colors.border}`,
                        '& .MuiMenuItem-root': {
                          color: colors.text,
                          '&:hover': {
                            bgcolor: colors.border,
                          },
                          '&.Mui-selected': {
                            bgcolor: colors.primary,
                            color: '#000000',
                            '&:hover': {
                              bgcolor: colors.primary,
                            },
                          },
                        },
                      },
                    },
                  }}
                  sx={{
                    borderRadius: 2,
                    color: colors.text,
                    '& .MuiOutlinedInput-notchedOutline': {
                      borderColor: colors.border,
                    },
                    '&:hover .MuiOutlinedInput-notchedOutline': {
                      borderColor: colors.primary,
                    },
                    '&.Mui-focused .MuiOutlinedInput-notchedOutline': {
                      borderColor: colors.primary,
                    },
                  }}
                >
                  <MenuItem value="all">ì „ì²´</MenuItem>
                  <MenuItem value="generated">ìƒì„±ëœ ìŒì•…</MenuItem>
                  <MenuItem value="converted">ë³€í™˜ëœ ìŒì•…</MenuItem>
                </Select>
              </FormControl>
            </Grid>
          </Grid>
        </Paper>

        {/* ìŒì•… ë¦¬ìŠ¤íŠ¸ */}
        {loading ? (
          <Box sx={{ textAlign: 'center', py: 8 }}>
            <CircularProgress sx={{ color: colors.accent }} />
            <Typography variant="body1" color={colors.textLight} sx={{ mt: 2 }}>
              ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì´ì—ìš”...
            </Typography>
          </Box>
        ) : error ? (
          <Box sx={{ textAlign: 'center', py: 8 }}>
            <Typography variant="h5" color="#FCA5A5" sx={{ mb: 1 }}>
              ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”
            </Typography>
            <Typography variant="body1" color={colors.textLight}>
              ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
            </Typography>
          </Box>
        ) : filteredAndSortedMusic.length === 0 ? (
          <Box sx={{ textAlign: 'center', py: 8 }}>
            <MusicNote sx={{ fontSize: '4rem', color: colors.textLight, mb: 2 }} />
            <Typography variant="h5" color={colors.textLight} sx={{ mb: 1 }}>
              ì €ì¥ëœ ê³¡ì´ ì•„ì§ ì—†ì–´ìš”
            </Typography>
            <Typography variant="body1" color={colors.textLight}>
              ìŒì•…ì„ ìƒì„±í•˜ê±°ë‚˜ ë¹„íŠ¸ë¥¼ ë§Œë“¤ì–´ ì €ì¥í•´ë³´ì„¸ìš”!
            </Typography>
          </Box>
        ) : (
          <Grid container spacing={3}>
            {filteredAndSortedMusic.map((music) => (
              <Grid item xs={12} sm={6} md={4} lg={3} key={music.id}>
                <Card 
                  elevation={0}
                  sx={{ 
                    height: '100%',
                    display: 'flex',
                    flexDirection: 'column',
                    bgcolor: colors.cardBg,
                    border: `1px solid ${colors.border}`,
                    borderRadius: 3,
                    boxShadow: `0 4px 20px ${colors.shadow}`,
                    transition: 'all 0.3s ease-in-out',
                    '&:hover': {
                      transform: 'translateY(-4px)',
                      boxShadow: `0 8px 30px ${colors.shadow}`
                    }
                  }}
                >
                  <CardContent sx={{ flexGrow: 1, p: 3 }}>
                    {/* íƒ€ì… í‘œì‹œ */}
                    <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 2 }}>
                      <Chip 
                        label={music.type === 'generated' ? 'ìƒì„±ë¨' : 'ë³€í™˜ë¨'}
                        size="small"
                        sx={{
                          bgcolor: music.type === 'generated' ? '#1A1A1A' : '#1A1A1A',
                          color: music.type === 'generated' ? '#FFD700' : '#DAA520',
                          fontWeight: 700,
                          fontSize: '0.75rem',
                          border: `2px solid ${music.type === 'generated' ? '#FFD700' : '#DAA520'}`
                        }}
                      />
                      <IconButton
                        size="small"
                        onClick={() => handleToggleFavorite(music.id)}
                        sx={{ 
                          color: music.isFavorite ? colors.warning : colors.textLight,
                          '&:hover': {
                            bgcolor: music.isFavorite ? '#FFF8E1' : colors.border
                          }
                        }}
                      >
                        <Favorite />
                      </IconButton>
                    </Box>

                    {/* ì œëª© */}
                    <Typography 
                      variant="h6" 
                      component="h3"
                      sx={{ 
                        fontWeight: 600,
                        color: colors.text,
                        mb: 2,
                        overflow: 'hidden',
                        textOverflow: 'ellipsis',
                        whiteSpace: 'nowrap'
                      }}
                    >
                      {music.title}
                    </Typography>

                    {/* ì¥ë¥´/ë¶„ìœ„ê¸° íƒœê·¸ */}
                    <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5, mb: 2 }}>
                      {music.genres && music.genres.map((genre) => {
                        const genreInfo = getGenreInfo(genre);
                        return (
                          <Chip
                            key={genre}
                            label={genreInfo.label}
                            size="small"
                            sx={{
                              bgcolor: colors.border,
                              color: colors.text,
                              fontSize: '0.75rem'
                            }}
                          />
                        );
                      })}
                      {music.targetGenre && (
                        <Chip
                          label={getGenreInfo(music.targetGenre).label}
                          size="small"
                          sx={{
                            bgcolor: colors.border,
                            color: colors.text,
                            fontSize: '0.75rem'
                          }}
                        />
                      )}
                    </Box>

                    {/* ì¬ìƒì‹œê°„ */}
                    <Typography variant="body2" color={colors.textLight}>
                      {formatTime(music.duration)}
                    </Typography>
                  </CardContent>

                  <CardActions sx={{ p: 2, pt: 0 }}>
                    <Button
                      startIcon={<PlayArrow />}
                      onClick={() => handlePlay(music)}
                      sx={{
                        color: colors.primary,
                        '&:hover': {
                          bgcolor: '#F3F4FF'
                        }
                      }}
                    >
                      ì¬ìƒ
                    </Button>
                    <Button
                      startIcon={<Download />}
                      onClick={() => handleDownload(music)}
                      sx={{
                        color: colors.accent,
                        '&:hover': {
                          bgcolor: '#F0FDFC'
                        }
                      }}
                    >
                      ë‹¤ìš´ë¡œë“œ
                    </Button>
                    <IconButton
                      onClick={() => handleDelete(music.id)}
                      sx={{
                        color: colors.textLight,
                        ml: 'auto',
                        '&:hover': {
                          bgcolor: '#FFEBEE',
                          color: '#F44336'
                        }
                      }}
                    >
                      <Delete />
                    </IconButton>
                  </CardActions>
                </Card>
              </Grid>
            ))}
          </Grid>
        )}
      </Container>
    </Box>
  );
};

export default Library;
</file>

<file path="src/pages/MusicGeneration.js">
// src/pages/MusicGeneration.js
import React, { useState, useMemo, useEffect } from 'react';
import {
  Container, Box, Typography, Paper, TextField, Button, Grid, LinearProgress
} from '@mui/material';
import { MusicNote, PlayArrow, AutoAwesome, Refresh, UploadFile, Delete } from '@mui/icons-material';
import { useNavigate } from 'react-router-dom';

import GenreCardSelector from '../components/common/GenreCardSelector';
import MoodSelector from '../components/common/MoodSelector';
import { useMusicContext } from '../context/MusicContext';

import { generateAndWait } from '../services/musicApi';
import { saveGeneratedTrack } from '../services/libraryWriter';

const MusicGeneration = () => {
  const navigate = useNavigate();
  const { state, actions } = useMusicContext();

  const colors = {
    background: '#0A0A0A',
    cardBg: '#1A1A1A',
    primary: '#50E3C2',
    secondary: '#40D9B8',
    accent: '#2DD4BF',
    text: '#FFFFFF',
    textLight: '#CCCCCC',
    border: '#333333',
    shadow: 'rgba(80, 227, 194, 0.3)'
  };

  const {
    selectedGenres,
    selectedMoods,
    description,
    duration,
    isGenerating
  } = state.generation;

  const isFormValid = selectedGenres.length > 0 || selectedMoods.length > 0;

  const handleGenreChange = (genres) => actions.setSelectedGenres(genres);
  const handleMoodChange = (moods) => actions.setSelectedMoods(moods);
  const handleDescriptionChange = (e) => actions.setDescription(e.target.value);

  // â¬‡ï¸ ì˜¤ë””ì˜¤ ì²¨ë¶€ ìƒíƒœ
  const [file, setFile] = useState(null);
  const [audioPreview, setAudioPreview] = useState('');
  const fileInfo = useMemo(
    () => (file ? `${file.name} (${Math.round(file.size / 1024)} KB)` : 'ì²¨ë¶€ ì—†ìŒ'),
    [file]
  );

  const handleFilePick = (e) => {
    const f = e.target.files?.[0];
    if (!f) return;
    if (!f.type.startsWith('audio/')) {
      alert('ì˜¤ë””ì˜¤ íŒŒì¼ë§Œ ì²¨ë¶€í•˜ì„¸ìš” (wav, mp3 ë“±)');
      e.target.value = '';
      return;
    }
    setFile(f);
    const url = URL.createObjectURL(f);
    setAudioPreview(url);
  };

  const removeFile = () => {
    if (audioPreview) URL.revokeObjectURL(audioPreview);
    setFile(null);
    setAudioPreview('');
  };

  // âœ… Beat Makerì—ì„œ 'Generateë¡œ ë³´ë‚´ê¸°'ë¥¼ ëˆŒë €ì„ ë•Œ ìë™ ì²¨ë¶€
  useEffect(() => {
    const dataUrl = sessionStorage.getItem('inlineReferenceAudio');
    if (!dataUrl) return;

    (async () => {
      const res = await fetch(dataUrl);
      const blob = await res.blob();
      const fileFromBeat = new File([blob], 'beat.wav', { type: 'audio/wav' });

      setFile(fileFromBeat);
      const url = URL.createObjectURL(fileFromBeat);
      setAudioPreview(url);

      sessionStorage.removeItem('inlineReferenceAudio'); // 1íšŒì„±
    })();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  // í”„ë¡¬í”„íŠ¸ ì¡°í•©
  const buildPrompt = () => {
    const g = selectedGenres.join(', ');
    const m = selectedMoods.join(', ');
    return [description, g && `genres: ${g}`, m && `mood: ${m}`]
      .filter(Boolean)
      .join(', ');
  };

  // ìƒì„±
  const handleGenerateMusic = async () => {
    if (!isFormValid) {
      actions.addNotification({ type: 'error', message: 'ì¥ë¥´ ë˜ëŠ” ë¶„ìœ„ê¸°ë¥¼ ìµœì†Œ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.' });
      return;
    }
    try {
      actions.startGeneration();
      const prompt = buildPrompt();
      const dur = Number(duration || 30);

      const final = await generateAndWait(
        { description: prompt, genres: selectedGenres, moods: selectedMoods, duration: dur },
        (s) => actions.updateGenerationProgress(s.status && s.status !== 'succeeded' ? 50 : 0),
        file // âœ… ì²¨ë¶€ íŒŒì¼ ì „ë‹¬
      );

      const generatedMusic = {
        id: Date.now(),
        title: `AI_Generated_${Date.now()}`,
        genres: selectedGenres,
        moods: selectedMoods,
        description: prompt,
        duration: dur,
        audioUrl: final.result.audioUrl,
        createdAt: new Date().toISOString()
      };

      actions.completeGeneration(generatedMusic);

      const currentUser = state.auth.user;
      if (currentUser) {
        try {
          await saveGeneratedTrack({
            ownerId: currentUser.uid,
            title: generatedMusic.title,
            genres: selectedGenres,
            moods: selectedMoods,
            description: prompt,
            durationSec: dur,
            prompt,
            sourceUrl: final.result.audioUrl,
          });
          actions.addNotification({ type: 'success', message: 'ìŒì•…ì´ ìƒì„±ë˜ì–´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!' });
        } catch (writeError) {
          console.warn(writeError);
          actions.addNotification({ type: 'warning', message: 'ìƒì„±ì€ ì™„ë£Œí–ˆì§€ë§Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì €ì¥í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.' });
        }
      } else {
        actions.addNotification({ type: 'success', message: 'ìŒì•…ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸í•˜ë©´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì €ì¥ë¼ìš”.' });
      }
      navigate('/result');
    } catch (error) {
      console.error(error);
      actions.setError(error.message || 'ìŒì•… ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      actions.addNotification({ type: 'error', message: 'ìŒì•… ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.' });
    } finally {
      actions.updateGenerationProgress?.(0);
      actions.setGenerating?.(false);
    }
  };

  return (
    <Box sx={{ minHeight: '100vh', bgcolor: colors.background, py: 6 }}>
      <Container maxWidth="lg">
        {/* ë³€ê²½ì  1: '(Generate)' í…ìŠ¤íŠ¸ ì œê±° */}
        <Typography variant="h4" sx={{ color: colors.text, fontWeight: 700, mb: 3, display: 'flex', alignItems: 'center' }}>
          <MusicNote sx={{ mr: 1, color: colors.primary }} />
          ìƒì„±í•˜ê¸°
        </Typography>

        <Grid container spacing={4}>
          {/* ë©”ì¸ ì¹´ë“œ */}
          <Grid item xs={12} md={8}>
            <Paper elevation={0} sx={{ bgcolor: colors.cardBg, p: 4, borderRadius: 3, border: `1px solid ${colors.border}` }}>
              {/* í”„ë¡¬í”„íŠ¸ */}
              <Box sx={{ mb: 4 }}>
                <Typography variant="h6" sx={{ display: 'flex', alignItems: 'center', mb: 2, color: colors.text, fontWeight: 600 }}>
                  <AutoAwesome sx={{ mr: 1, color: colors.primary }} />
                  í”„ë¡¬í”„íŠ¸
                </Typography>
                <TextField
                  fullWidth multiline minRows={2}
                  placeholder="ì˜ˆ: dreamy lofi hiphop with warm piano"
                  value={description} onChange={handleDescriptionChange}
                  sx={{
                    '& .MuiInputBase-root': { bgcolor: '#111', color: colors.text, borderRadius: 2 },
                    '& .MuiOutlinedInput-notchedOutline': { borderColor: colors.border }
                  }}
                />
              </Box>

              {/* ì˜¤ë””ì˜¤ ì²¨ë¶€ */}
              <Box sx={{ mb: 4 }}>
                <Typography variant="h6" sx={{ display: 'flex', alignItems: 'center', mb: 2, color: colors.text, fontWeight: 600 }}>
                  <UploadFile sx={{ mr: 1, color: colors.primary }} />
                  ì˜¤ë””ì˜¤ ì²¨ë¶€ (ì„ íƒ)
                </Typography>

                <Box sx={{
                  display: 'flex', alignItems: 'center', gap: 2, mb: 2,
                  p: 2, borderRadius: 2, border: `1px dashed ${colors.border}`, bgcolor: '#111'
                }}>
                  <Button variant="outlined" component="label" sx={{ color: colors.text, borderColor: colors.border }}>
                    íŒŒì¼ ì„ íƒ
                    <input type="file" hidden accept="audio/*" onChange={handleFilePick} />
                  </Button>
                  <Typography sx={{ color: colors.textLight, flex: 1 }}>{fileInfo}</Typography>
                  {file && (
                    <Button onClick={removeFile} size="small" startIcon={<Delete />} sx={{ color: colors.text }}>
                      ì œê±°
                    </Button>
                  )}
                </Box>

                {audioPreview && (
                  <audio controls src={audioPreview} style={{ width: '100%' }} />
                )}
              </Box>

              {/* ì¥ë¥´ / ë¶„ìœ„ê¸° */}
              <Box sx={{ mb: 4 }}>
                <Typography variant="h6" sx={{ color: colors.text, fontWeight: 600, mb: 2 }}>ì¥ë¥´ ì„ íƒ</Typography>
                <GenreCardSelector selectedGenres={selectedGenres} onGenreChange={handleGenreChange} maxSelection={1} />
              </Box>

              <Box sx={{ mb: 4 }}>
                <Typography variant="h6" sx={{ color: colors.text, fontWeight: 600, mb: 2 }}>ë¶„ìœ„ê¸° ì„ íƒ</Typography>
                <MoodSelector selectedMoods={selectedMoods} onMoodChange={handleMoodChange} maxSelection={3} />
              </Box>

              {/* ê¸¸ì´ ì…ë ¥ */}
              <Box sx={{ mb: 4 }}>
                {/* ë³€ê²½ì  2: ë ˆì´ë¸” ë° ì…ë ¥ ë²”ìœ„ ìˆ˜ì • */}
                <Typography variant="h6" sx={{ color: colors.text, fontWeight: 600, mb: 2 }}>ê¸¸ì´ (10ì´ˆ ~ 30ì´ˆ)</Typography>
                <TextField
                  type="number" value={duration} onChange={(e)=>actions.setDuration(Number(e.target.value || 0))}
                  sx={{ width: 160, '& .MuiInputBase-root': { bgcolor: '#111', color: colors.text, borderRadius: 2 } }}
                  inputProps={{ min: 10, max: 30 }}
                />
              </Box>

              {/* ìƒì„± ë²„íŠ¼ */}
              <Button
                fullWidth variant="contained" size="large"
                onClick={handleGenerateMusic} disabled={!isFormValid || isGenerating}
                sx={{
                  py: 2, borderRadius: 2, fontWeight: 600, fontSize: '1.1rem',
                  bgcolor: colors.accent, color: '#000', boxShadow: `0 4px 14px ${colors.shadow}`,
                  '&:hover': { bgcolor: colors.accent, boxShadow: `0 6px 20px ${colors.shadow}` },
                  '&:disabled': { bgcolor: colors.border, color: colors.textLight, boxShadow: 'none' }
                }}
              >
                {isGenerating ? (<><Refresh sx={{ mr: 1, animation: 'spin 1s linear infinite', color: '#000' }} />ìƒì„± ì¤‘...</>) :
                 (<><PlayArrow sx={{ mr: 1, color: '#000' }} />ìƒì„±í•˜ê¸°</>)}
              </Button>

              {/* ë³€ê²½ì  3: ë¡œë”© ë°” ìƒ‰ìƒ ë³€ê²½ */}
              {isGenerating && (
                <Box sx={{ mt: 2 }}>
                  <LinearProgress sx={{
                    backgroundColor: colors.border,
                    '& .MuiLinearProgress-bar': {
                      backgroundColor: colors.accent
                    }
                  }} />
                </Box>
              )}
            </Paper>
          </Grid>
        </Grid>
      </Container>
    </Box>
  );
};

export default MusicGeneration;
</file>

<file path="src/polyfills.js">
// src/polyfills.js
import { Buffer } from 'buffer';
if (!window.Buffer) window.Buffer = Buffer;
if (!window.global) window.global = window;
</file>

<file path="src/reportWebVitals.js">
const reportWebVitals = onPerfEntry => {
  if (onPerfEntry && onPerfEntry instanceof Function) {
    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {
      getCLS(onPerfEntry);
      getFID(onPerfEntry);
      getFCP(onPerfEntry);
      getLCP(onPerfEntry);
      getTTFB(onPerfEntry);
    });
  }
};

export default reportWebVitals;
</file>

<file path="src/services/libraryApi.js">
import {
  collection,
  doc,
  onSnapshot,
  orderBy,
  query,
  where,
  limit,
} from 'firebase/firestore';

import { db } from '../lib/firebase';

const COLLECTION_TRACKS = 'tracks';
const COLLECTION_BEATS = 'beats';

function normalizeDoc(snapshot, type) {
  if (!snapshot.exists()) return null;
  const data = snapshot.data();
  return {
    id: snapshot.id,
    type,
    ...data,
  };
}

export function subscribeToUserLibrary(userId, { onUpdate, onError } = {}) {
  if (!userId) return () => {};

  const tracksQuery = query(
    collection(db, COLLECTION_TRACKS),
    where('ownerId', '==', userId),
    orderBy('createdAt', 'desc'),
    limit(200)
  );

  const beatsQuery = query(
    collection(db, COLLECTION_BEATS),
    where('ownerId', '==', userId),
    orderBy('createdAt', 'desc'),
    limit(200)
  );

  let currentTracks = [];
  let currentBeats = [];

  const emit = () => {
    const combined = [...currentTracks, ...currentBeats].sort((a, b) => {
      const aDate = a.createdAt?.toMillis ? a.createdAt.toMillis() : new Date(a.createdAt || 0).getTime();
      const bDate = b.createdAt?.toMillis ? b.createdAt.toMillis() : new Date(b.createdAt || 0).getTime();
      return bDate - aDate;
    });
    onUpdate?.(combined);
  };

  const unsubTracks = onSnapshot(
    tracksQuery,
    (snap) => {
      currentTracks = snap.docs
        .map((docSnap) => normalizeDoc(docSnap, 'track'))
        .filter(Boolean);
      emit();
    },
    (error) => {
      console.warn('[libraryApi] tracks subscription error', error);
      onError?.(error);
    }
  );

  const unsubBeats = onSnapshot(
    beatsQuery,
    (snap) => {
      currentBeats = snap.docs
        .map((docSnap) => normalizeDoc(docSnap, 'beat'))
        .filter(Boolean);
      emit();
    },
    (error) => {
      console.warn('[libraryApi] beats subscription error', error);
      onError?.(error);
    }
  );

  return () => {
    unsubTracks?.();
    unsubBeats?.();
  };
}

export function getTrackDocRef(trackId) {
  return doc(db, COLLECTION_TRACKS, trackId);
}

export function getBeatDocRef(beatId) {
  return doc(db, COLLECTION_BEATS, beatId);
}

export default {
  subscribeToUserLibrary,
  getTrackDocRef,
  getBeatDocRef,
};
</file>

<file path="src/services/libraryWriter.js">
import {
  addDoc,
  collection,
  serverTimestamp,
  updateDoc,
} from 'firebase/firestore';
import {
  ref as storageRef,
  uploadBytes,
  getDownloadURL,
} from 'firebase/storage';

import { db, storage } from '../lib/firebase';

async function uploadAudioBlob({ ownerId, docId, blob, folder }) {
  if (!blob) return null;
  const ref = storageRef(storage, `audio/${folder}/${ownerId}/${docId}.wav`);
  await uploadBytes(ref, blob, { contentType: 'audio/wav' });
  return getDownloadURL(ref);
}

async function loadBlobFromUrl(url) {
  if (!url) return null;
  const response = await fetch(url);
  if (!response.ok) throw new Error('ì˜¤ë””ì˜¤ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
  return response.blob();
}

export async function saveGeneratedTrack({
  ownerId,
  title,
  genres,
  moods,
  description,
  durationSec,
  prompt,
  sourceUrl,
}) {
  const payload = {
    ownerId,
    title,
    genres,
    moods,
    description,
    duration: durationSec,
    prompt,
    source: 'musicgen',
    createdAt: serverTimestamp(),
  };

  const tracksCol = collection(db, 'tracks');
  const docRef = await addDoc(tracksCol, payload);

  try {
    const blob = await loadBlobFromUrl(sourceUrl);
    const url = await uploadAudioBlob({ ownerId, docId: docRef.id, blob, folder: 'tracks' });
    await updateDoc(docRef, { audioUrl: url, sourceUrl });
  } catch (error) {
    // ì—…ë¡œë“œ ì‹¤íŒ¨ ì‹œì—ë„ ë¬¸ì„œ ê¸°ë³¸ ì •ë³´ëŠ” ìœ ì§€ë˜ë„ë¡ ë¡œê·¸ë§Œ ë‚¨ê¹€
    console.warn('[libraryWriter] track audio upload failed', error);
  }

  return docRef.id;
}

export async function saveBeatItem({
  ownerId,
  title,
  bpm,
  bars,
  pattern,
  audioBlob,
  presetMeta,
}) {
  const payload = {
    ownerId,
    title,
    bpm,
    bars,
    pattern,
    presetMeta,
    source: 'beatmaker',
    createdAt: serverTimestamp(),
  };

  const beatsCol = collection(db, 'beats');
  const docRef = await addDoc(beatsCol, payload);

  try {
    const url = await uploadAudioBlob({ ownerId, docId: docRef.id, blob: audioBlob, folder: 'beats' });
    await updateDoc(docRef, { audioUrl: url });
  } catch (error) {
    console.warn('[libraryWriter] beat audio upload failed', error);
  }

  return docRef.id;
}

export default {
  saveGeneratedTrack,
  saveBeatItem,
};
</file>

<file path="src/services/musicApi.js">
// src/services/musicApi.js

const IN_PROGRESS = new Set(['queued', 'running', 'processing', 'starting', 'pending']);
const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

// ê¸°ë³¸ê°’ì€ 5000í¬íŠ¸. .envì— REACT_APP_API_BASE_URL ìˆìœ¼ë©´ ê·¸ê±¸ ì‚¬ìš©í•©ë‹ˆë‹¤. :contentReference[oaicite:5]{index=5}
const API_BASE = (process.env.REACT_APP_API_BASE_URL || 'http://127.0.0.1:5000/api').replace(/\/$/, '');

function pickStatus(j) {
  const candidates = [ j?.status, j?.state, j?.task_status, j?.taskStatus, j?.prediction?.status, j?.data?.status ];
  const raw = candidates.find((v) => v != null) ?? '';
  return String(raw).toLowerCase();
}

function pickAudioUrl(j) {
  const candidates = [
    j?.audioUrl, j?.audio_url, j?.url,
    j?.result?.audioUrl, j?.result?.audio_url, j?.result?.url, j?.result?.audio,
    j?.data?.audioUrl, j?.data?.audio_url, j?.data?.url, j?.data?.audio,
    j?.prediction?.output,
    j?.output,
    j?.files
  ];
  let out = candidates.find((v) => v != null);
  if (Array.isArray(out)) out = out[0];
  if (out && typeof out === 'object') {
    if (typeof out.url === 'string') out = out.url;
    else if (typeof out.audio === 'string') out = out.audio;
    else if (Array.isArray(out.output)) out = out.output[0];
  }
  if (typeof out === 'string') return out;
  return undefined;
}

/**
 * íŒŒì¼ì´ ìˆìœ¼ë©´ multipart/form-data, ì—†ìœ¼ë©´ JSONìœ¼ë¡œ í˜¸ì¶œ
 * payload: { description, genres, moods, duration }
 * file: File | null
 */
export async function generateAndWait(payload, onStatus, file = null) {
  let genRes;
  if (file) {
    const fd = new FormData();
    fd.append('description', payload.description || '');
    fd.append('genres', JSON.stringify(payload.genres || []));
    fd.append('moods', JSON.stringify(payload.moods || []));
    fd.append('duration', String(payload.duration || 10));
    fd.append('file', file);
    genRes = await fetch(`${API_BASE}/music/generate`, { method: 'POST', body: fd });
  } else {
    genRes = await fetch(`${API_BASE}/music/generate`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    });
  }
  if (!genRes.ok) throw new Error(`Generate failed: ${genRes.status} ${await genRes.text()}`);
  const genJson = await genRes.json();

  const taskId = genJson.task_id || genJson.taskId || genJson.id;
  if (!taskId) throw new Error('No task id from server');

  // ìƒíƒœ í´ë§ (ê¸°ì¡´ êµ¬í˜„ê³¼ ë™ì¼ â€” /api/music/task/status?task_id=...) :contentReference[oaicite:6]{index=6}
  while (true) {
    await sleep(1500);
    const stRes = await fetch(`${API_BASE}/music/task/status?task_id=${encodeURIComponent(taskId)}`);
    const stJson = await stRes.json();
    onStatus?.(stJson);

    const st = pickStatus(stJson);
    if (!st || IN_PROGRESS.has(st)) continue;

    if (!['succeeded', 'completed', 'success'].includes(st)) {
      const errMsg = stJson?.error || stJson?.message || stJson?.result?.error || stJson?.prediction?.error || `Generation failed (${st || 'unknown'})`;
      throw new Error(errMsg);
    }

    const audioUrl = pickAudioUrl(stJson);
    if (!audioUrl) throw new Error('Replicate returned no audio URL.');
    return { status: 'succeeded', result: { audioUrl } };
  }
}
</file>

<file path="src/setupTests.js">
// jest-dom adds custom jest matchers for asserting on DOM nodes.
// allows you to do things like:
// expect(element).toHaveTextContent(/react/i)
// learn more: https://github.com/testing-library/jest-dom
import '@testing-library/jest-dom';
</file>

<file path="src/state/beatPadStore.js">
import React, { createContext, useContext, useReducer, useMemo } from "react";

const BeatPadContext = createContext(null);

const initial = {
  grid: { cols: 11, rows: 11 },
  mode: "CELL",
  selectedCell: null,
  path: [],
  pathLerp: 0,
  interpolating: false,
  lerpT: 0,
  fromPattern: null,
  toPattern: null,
  cornerEncodings: null,
  cellCacheVersion: 0,
};

function reducer(state, action) {
  switch (action.type) {
    case "RESET_PATH":
      return { ...state, path: [] };
    case "APPEND_PATH_POINT":
      return { ...state, path: [...(state.path || []), action.point] };
    case "SET_GRID":
      return { ...state, grid: action.grid };
    case "SET_MODE":
      return { ...state, mode: action.mode };
    case "SELECT_CELL":
      return { ...state, selectedCell: action.cell };
    case "SET_CORNERS":
      return {
        ...state,
        cornerEncodings: action.encodings,
        cellCacheVersion: state.cellCacheVersion + 1,
      };
    case "SET_PATH":
      return { ...state, path: action.path };
    case "SET_PATH_LERP":
      return { ...state, pathLerp: action.value };
    case "START_INTERPOLATE":
      return { ...state, interpolating: true, lerpT: 0, fromPattern: action.from, toPattern: action.to };
    case "SET_LERP_T":
      return { ...state, lerpT: action.t };
    case "END_INTERPOLATE":
      return { ...state, interpolating: false, lerpT: 1 };
    default:
      return state;
  }
}

export function BeatPadProvider({ children }) {
  const [state, dispatch] = useReducer(reducer, initial);
  const value = useMemo(() => ({ state, dispatch }), [state]);
  return <BeatPadContext.Provider value={value}>{children}</BeatPadContext.Provider>;
}

export const useBeatPad = () => useContext(BeatPadContext);
</file>

<file path="src/utils/audioExport.js">
// src/utils/audioExport.js
export async function bufferToWavBlob(audioBuffer) {
  const numCh = audioBuffer.numberOfChannels;
  const sampleRate = audioBuffer.sampleRate;
  const frames = audioBuffer.length;
  const bytesPerSample = 2;
  const blockAlign = numCh * bytesPerSample;
  const dataSize = frames * blockAlign;
  const buffer = new ArrayBuffer(44 + dataSize);
  const view = new DataView(buffer);

  writeString(view, 0, 'RIFF');
  view.setUint32(4, 36 + dataSize, true);
  writeString(view, 8, 'WAVE');
  writeString(view, 12, 'fmt ');
  view.setUint32(16, 16, true);
  view.setUint16(20, 1, true);
  view.setUint16(22, numCh, true);
  view.setUint32(24, sampleRate, true);
  view.setUint32(28, sampleRate * blockAlign, true);
  view.setUint16(32, blockAlign, true);
  view.setUint16(34, 16, true);
  writeString(view, 36, 'data');
  view.setUint32(40, dataSize, true);

  let offset = 44;
  const interleaved = interleave(audioBuffer);
  for (let i = 0; i < interleaved.length; i++, offset += 2) {
    const s = Math.max(-1, Math.min(1, interleaved[i]));
    view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);
  }
  return new Blob([view], { type: 'audio/wav' });
}

function writeString(view, offset, string) {
  for (let i = 0; i < string.length; i++) {
    view.setUint8(offset + i, string.charCodeAt(i));
  }
}

function interleave(audioBuffer) {
  const channels = [];
  for (let i = 0; i < audioBuffer.numberOfChannels; i++) {
    channels.push(audioBuffer.getChannelData(i));
  }
  const length = audioBuffer.length * audioBuffer.numberOfChannels;
  const result = new Float32Array(length);
  let index = 0;
  const inputIndex = new Array(channels.length).fill(0);

  while (index < length) {
    for (let i = 0; i < channels.length; i++) {
      result[index++] = channels[i][inputIndex[i]++];
    }
  }
  return result;
}

export function downloadBlob(blob, filename) {
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  a.click();
  setTimeout(() => URL.revokeObjectURL(url), 1000);
}
</file>

<file path="UI_UX_DESIGN.md">
# AI ê¸°ë°˜ ë°°ê²½ìŒì•… ìƒì„± ë° ë³€í™˜ ì‹œìŠ¤í…œ - UI/UX ì„¤ê³„ ë¬¸ì„œ

## 1. í”„ë¡œì íŠ¸ ê°œìš”
AIë¥¼ í™œìš©í•˜ì—¬ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ë¶„ìœ„ê¸°ì™€ ì¥ë¥´ì˜ ë°°ê²½ìŒì•…ì„ ìƒì„±í•˜ê³ , ê¸°ì¡´ ìŒì•…ì„ ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ë¡œ ë³€í™˜í•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜

## 2. ì‚¬ìš©ì í˜ë¥´ì†Œë‚˜
- **ì£¼ìš” ì‚¬ìš©ì**: ì½˜í…ì¸  í¬ë¦¬ì—ì´í„°, ì˜ìƒ í¸ì§‘ì, ê²Œì„ ê°œë°œì, ì¼ë°˜ ìŒì•… ì• í˜¸ê°€
- **ë‹ˆì¦ˆ**: ì €ì‘ê¶Œ ê±±ì • ì—†ëŠ” ë°°ê²½ìŒì•…, ë¹ ë¥¸ ìŒì•… ìƒì„±, ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼ ë³€í™˜

## 3. í˜ì´ì§€ êµ¬ì„± ë° ì™€ì´ì–´í”„ë ˆì„

### 3.1 ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜
```
[ë¡œê³ ] AI Music Studio    [ìŒì•… ìƒì„±] [ìŒì•… ë³€í™˜] [ë¼ì´ë¸ŒëŸ¬ë¦¬] [ì„¤ì •]
```

### 3.2 ìŒì•… ìƒì„± í˜ì´ì§€ (ë©”ì¸ í˜ì´ì§€)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸµ AI Music Studio                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ¹ ìƒˆë¡œìš´ ìŒì•… ìƒì„±                                          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ ì¥ë¥´ ì„ íƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [EDM] [Lo-Fi] [City Pop] [ì–´ì¿ ìŠ¤í‹±] [í´ë˜ì‹] [ì¬ì¦ˆ]      â”‚ â”‚
â”‚  â”‚ [í™í•©] [ë¡] [íŒ] [ì•°ë¹„ì–¸íŠ¸] [ê¸°íƒ€...]                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ ë¶„ìœ„ê¸° í‚¤ì›Œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ #ì‹ ë‚˜ëŠ” #ì°¨ë¶„í•œ #ëª½í™˜ì ì¸ #ì—ë„ˆì§€í‹± #ë¡œë§¨í‹± #ì§‘ì¤‘       â”‚ â”‚
â”‚  â”‚ #ìŠ¬í”ˆ #í¬ë§ì ì¸ #ê¸´ì¥ê° #í¸ì•ˆí•œ                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ ìƒì„¸ ì„¤ëª… (ì„ íƒì‚¬í•­) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚ ì˜ˆ: "ì¹´í˜ì—ì„œ ê³µë¶€í•  ë•Œ ë“£ê¸° ì¢‹ì€ ì°¨ë¶„í•œ í”¼ì•„ë…¸ ìŒì•…" â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                                                     â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                                                     â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ ìŒì•… ê¸¸ì´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â—‹ 30ì´ˆ  â—‹ 1ë¶„  â— 2ë¶„  â—‹ 5ë¶„  â—‹ ì‚¬ìš©ì ì •ì˜ [___]ë¶„   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚         [ğŸµ ìŒì•… ìƒì„±í•˜ê¸°] [âš™ï¸ ê³ ê¸‰ ì„¤ì •]                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ìŒì•… ë³€í™˜ í˜ì´ì§€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ğŸ”„ ìŒì•… ìŠ¤íƒ€ì¼ ë³€í™˜                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€ ì›ë³¸ ìŒì•… ì—…ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     ğŸ“ íŒŒì¼ ì„ íƒ ë˜ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­                     â”‚ â”‚
â”‚  â”‚     ì§€ì› í˜•ì‹: MP3, WAV, M4A (ìµœëŒ€ 10MB)                 â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  [ì„ íƒëœ íŒŒì¼: song.mp3] [ğŸ—‘ï¸ ì œê±°]                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ ì›ë³¸ ë¯¸ë¦¬ë“£ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â–¶ï¸ [â– â– â– â– â– â– â– â– â– â–¡] 2:30 / 3:45                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ ë³€í™˜í•  ìŠ¤íƒ€ì¼ ì„ íƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [EDM] [Lo-Fi] [City Pop] [ì–´ì¿ ìŠ¤í‹±] [í´ë˜ì‹] [ì¬ì¦ˆ]      â”‚ â”‚
â”‚  â”‚ [í™í•©] [ë¡] [íŒ] [ì•°ë¹„ì–¸íŠ¸]                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ ë³€í™˜ ê°•ë„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ì•½ê°„ [â—â—â—â—‹â—‹] ê°•í•˜ê²Œ                                     â”‚ â”‚
â”‚  â”‚ (ì›ê³¡ì˜ íŠ¹ì„±ì„ ì–¼ë§ˆë‚˜ ìœ ì§€í• ì§€ ì¡°ì •)                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚              [ğŸ”„ ë³€í™˜ ì‹œì‘í•˜ê¸°]                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 ê²°ê³¼ í˜ì´ì§€ (ìƒì„±/ë³€í™˜ ì™„ë£Œ)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    âœ… ìƒì„± ì™„ë£Œ!                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€ ìƒì„±ëœ ìŒì•… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸµ AI_Generated_Music_001.mp3                          â”‚ â”‚
â”‚  â”‚  ì¥ë¥´: Lo-Fi | ë¶„ìœ„ê¸°: ì°¨ë¶„í•œ, ì§‘ì¤‘                      â”‚ â”‚
â”‚  â”‚  ê¸¸ì´: 2:00                                             â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  â–¶ï¸ [â– â– â– â– â– â– â– â– â– â–¡] 1:30 / 2:00                          â”‚ â”‚
â”‚  â”‚  ğŸ”Š [â”€â”€â”€â”€â—â”€â”€â”€â”€] ë³¼ë¥¨                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ ì•¡ì…˜ ë²„íŠ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [ğŸ’¾ ë‹¤ìš´ë¡œë“œ] [ğŸ’– ì¦ê²¨ì°¾ê¸°] [ğŸ”„ ë‹¤ì‹œ ìƒì„±] [ğŸ“¤ ê³µìœ ]    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€ ìƒì„± ì •ë³´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ ìƒì„± ì‹œê°„: 2024-01-15 14:30                          â”‚ â”‚
â”‚  â”‚  â€¢ ì‚¬ìš©ëœ í”„ë¡¬í”„íŠ¸: "ì¹´í˜ì—ì„œ ê³µë¶€í•  ë•Œ..."             â”‚ â”‚
â”‚  â”‚  â€¢ AI ëª¨ë¸: MusicGen v2.1                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚            [ğŸ  í™ˆìœ¼ë¡œ] [ğŸ“š ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ë³´ê¸°]               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜ì´ì§€ (ì„ íƒì‚¬í•­)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ğŸ“š ë‚´ ìŒì•… ë¼ì´ë¸ŒëŸ¬ë¦¬                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [ğŸ” ê²€ìƒ‰] [ğŸ“… ë‚ ì§œìˆœ] [â­ ì¦ê²¨ì°¾ê¸°] [ğŸµ ì¥ë¥´ë³„]              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ğŸµ 001  â”‚ğŸµ 002  â”‚ğŸµ 003  â”‚ğŸµ 004  â”‚ğŸµ 005  â”‚ğŸµ 006  â”‚     â”‚
â”‚  â”‚Lo-Fi   â”‚EDM     â”‚Acousticâ”‚City Popâ”‚Jazz    â”‚Rock    â”‚     â”‚
â”‚  â”‚2:00    â”‚3:15    â”‚4:30    â”‚2:45    â”‚5:20    â”‚3:00    â”‚     â”‚
â”‚  â”‚â–¶ï¸ ğŸ’¾ ğŸ—‘ï¸â”‚â–¶ï¸ ğŸ’¾ ğŸ—‘ï¸â”‚â–¶ï¸ ğŸ’¾ ğŸ—‘ï¸â”‚â–¶ï¸ ğŸ’¾ ğŸ—‘ï¸â”‚â–¶ï¸ ğŸ’¾ ğŸ—‘ï¸â”‚â–¶ï¸ ğŸ’¾ ğŸ—‘ï¸â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. ì‚¬ìš©ì íë¦„ (User Flow)

### 4.1 ìŒì•… ìƒì„± í”Œë¡œìš°
```
ì‹œì‘ â†’ ë©”ì¸ í˜ì´ì§€ â†’ ì¥ë¥´ ì„ íƒ â†’ ë¶„ìœ„ê¸° í‚¤ì›Œë“œ ì„ íƒ â†’ (ì„ íƒ)ìƒì„¸ ì„¤ëª… ì…ë ¥ 
â†’ ìŒì•… ê¸¸ì´ ì„¤ì • â†’ ìƒì„± ë²„íŠ¼ í´ë¦­ â†’ ë¡œë”© í™”ë©´ â†’ ê²°ê³¼ í˜ì´ì§€ â†’ ë¯¸ë¦¬ë“£ê¸° 
â†’ ë‹¤ìš´ë¡œë“œ/ì €ì¥ â†’ (ì„ íƒ)ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ë™ ë˜ëŠ” ìƒˆ ìƒì„±
```

### 4.2 ìŒì•… ë³€í™˜ í”Œë¡œìš°
```
ì‹œì‘ â†’ ìŒì•… ë³€í™˜ í˜ì´ì§€ â†’ íŒŒì¼ ì—…ë¡œë“œ â†’ ì›ë³¸ ë¯¸ë¦¬ë“£ê¸° â†’ ë³€í™˜ ìŠ¤íƒ€ì¼ ì„ íƒ 
â†’ ë³€í™˜ ê°•ë„ ì¡°ì • â†’ ë³€í™˜ ë²„íŠ¼ í´ë¦­ â†’ ë¡œë”© í™”ë©´ â†’ ê²°ê³¼ í˜ì´ì§€ â†’ ë¹„êµ ë“£ê¸° 
â†’ ë‹¤ìš´ë¡œë“œ/ì €ì¥ â†’ (ì„ íƒ)ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ë™ ë˜ëŠ” ìƒˆ ë³€í™˜
```

## 5. ë””ìì¸ ì‹œìŠ¤í…œ

### 5.1 ì»¬ëŸ¬ íŒ”ë ˆíŠ¸
- **Primary**: #6366F1 (ì¸ë””ê³ ) - ë©”ì¸ ì•¡ì…˜ ë²„íŠ¼, ë§í¬
- **Secondary**: #8B5CF6 (ë³´ë¼) - ë³´ì¡° ì•¡ì…˜, ê°•ì¡°
- **Accent**: #06B6D4 (ì²­ë¡) - ì„±ê³µ, ì™„ë£Œ ìƒíƒœ
- **Background**: #F8FAFC (ì—°í•œ íšŒìƒ‰) - í˜ì´ì§€ ë°°ê²½
- **Surface**: #FFFFFF (í°ìƒ‰) - ì¹´ë“œ, íŒ¨ë„ ë°°ê²½
- **Text Primary**: #1E293B (ì§„í•œ íšŒìƒ‰) - ì£¼ìš” í…ìŠ¤íŠ¸
- **Text Secondary**: #64748B (ì¤‘ê°„ íšŒìƒ‰) - ë³´ì¡° í…ìŠ¤íŠ¸
- **Success**: #10B981 (ì´ˆë¡) - ì„±ê³µ ë©”ì‹œì§€
- **Warning**: #F59E0B (ì£¼í™©) - ê²½ê³  ë©”ì‹œì§€
- **Error**: #EF4444 (ë¹¨ê°•) - ì˜¤ë¥˜ ë©”ì‹œì§€

### 5.2 íƒ€ì´í¬ê·¸ë˜í”¼
- **Heading 1**: 2.5rem, Bold - í˜ì´ì§€ ì œëª©
- **Heading 2**: 2rem, Semi-bold - ì„¹ì…˜ ì œëª©
- **Heading 3**: 1.5rem, Medium - ì¹´ë“œ ì œëª©
- **Body**: 1rem, Regular - ë³¸ë¬¸ í…ìŠ¤íŠ¸
- **Caption**: 0.875rem, Regular - ì„¤ëª… í…ìŠ¤íŠ¸
- **Button**: 1rem, Medium - ë²„íŠ¼ í…ìŠ¤íŠ¸

### 5.3 ê°„ê²© ì²´ê³„
- **XS**: 4px
- **SM**: 8px
- **MD**: 16px
- **LG**: 24px
- **XL**: 32px
- **2XL**: 48px

### 5.4 ì»´í¬ë„ŒíŠ¸ ê°€ì´ë“œë¼ì¸

#### ë²„íŠ¼
- **Primary Button**: ë‘¥ê·¼ ëª¨ì„œë¦¬ (8px), ê·¸ë¦¼ì íš¨ê³¼, hover ì‹œ ìƒ‰ìƒ ë³€ê²½
- **Secondary Button**: í…Œë‘ë¦¬ë§Œ ìˆëŠ” ìŠ¤íƒ€ì¼, Primary ì»¬ëŸ¬ í…Œë‘ë¦¬
- **Icon Button**: ì•„ì´ì½˜ë§Œ ìˆëŠ” ì›í˜• ë˜ëŠ” ì‚¬ê°í˜• ë²„íŠ¼

#### ì…ë ¥ í•„ë“œ
- **Text Input**: ë‘¥ê·¼ ëª¨ì„œë¦¬ (6px), ì—°í•œ í…Œë‘ë¦¬, focus ì‹œ Primary ì»¬ëŸ¬ í…Œë‘ë¦¬
- **File Upload**: ì ì„  í…Œë‘ë¦¬, ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ í‘œì‹œ

#### ì¹´ë“œ
- **ê¸°ë³¸ ì¹´ë“œ**: í°ìƒ‰ ë°°ê²½, ì—°í•œ ê·¸ë¦¼ì, ë‘¥ê·¼ ëª¨ì„œë¦¬ (12px)
- **ìŒì•… ì¹´ë“œ**: ì¸ë„¤ì¼, ì œëª©, ì •ë³´, ì•¡ì…˜ ë²„íŠ¼ í¬í•¨

#### íƒœê·¸/í‚¤ì›Œë“œ
- **ì¥ë¥´ íƒœê·¸**: ë‘¥ê·¼ ëª¨ì„œë¦¬, í´ë¦­ ê°€ëŠ¥, ì„ íƒ ì‹œ ìƒ‰ìƒ ë³€ê²½
- **ë¶„ìœ„ê¸° í‚¤ì›Œë“œ**: # ì ‘ë‘ì‚¬, ì‘ì€ í¬ê¸°, ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥

## 6. ë°˜ì‘í˜• ë””ìì¸ ê³ ë ¤ì‚¬í•­

### 6.1 ë¸Œë ˆì´í¬í¬ì¸íŠ¸
- **Mobile**: < 768px
- **Tablet**: 768px - 1024px  
- **Desktop**: > 1024px

### 6.2 ëª¨ë°”ì¼ ìµœì í™”
- í„°ì¹˜ ì¹œí™”ì ì¸ ë²„íŠ¼ í¬ê¸° (ìµœì†Œ 44px)
- ì„¸ë¡œ ìŠ¤í¬ë¡¤ ì¤‘ì‹¬ ë ˆì´ì•„ì›ƒ
- ê°„ì†Œí™”ëœ ë„¤ë¹„ê²Œì´ì…˜ (í–„ë²„ê±° ë©”ë‰´)
- í•œ í™”ë©´ì— í•˜ë‚˜ì˜ ì£¼ìš” ì•¡ì…˜ì— ì§‘ì¤‘

## 7. ì ‘ê·¼ì„± ê³ ë ¤ì‚¬í•­
- í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì§€ì›
- ì¶©ë¶„í•œ ìƒ‰ìƒ ëŒ€ë¹„ (WCAG 2.1 AA ê¸°ì¤€)
- ìŠ¤í¬ë¦° ë¦¬ë” ì§€ì›ì„ ìœ„í•œ ì ì ˆí•œ ARIA ë ˆì´ë¸”
- í¬ì»¤ìŠ¤ ì¸ë””ì¼€ì´í„° ì œê³µ

## 8. ë¡œë”© ë° í”¼ë“œë°±
- ìŒì•… ìƒì„± ì¤‘: ì§„í–‰ë¥  í‘œì‹œ, ì˜ˆìƒ ì†Œìš” ì‹œê°„ ì•ˆë‚´
- íŒŒì¼ ì—…ë¡œë“œ: ì§„í–‰ë¥  ë°”, ì—…ë¡œë“œ ìƒíƒœ í‘œì‹œ
- ì—ëŸ¬ ì²˜ë¦¬: ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€, í•´ê²° ë°©ë²• ì œì‹œ
- ì„±ê³µ í”¼ë“œë°±: í† ìŠ¤íŠ¸ ë©”ì‹œì§€, ì‹œê°ì  í™•ì¸
</file>

<file path="ai-music-backend/server.py">
import os
import uuid
import time
import threading
import subprocess
from io import BytesIO
from pathlib import Path
from typing import Any, Dict, Optional, List

from flask import Flask, request, jsonify, send_file
from flask_cors import CORS
from dotenv import load_dotenv
from werkzeug.utils import secure_filename
import replicate
from music21 import converter
from midi2audio import FluidSynth

# â”€â”€â”€â”€â”€ env â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
load_dotenv(dotenv_path=Path(__file__).parent / ".env", override=True)

REPLICATE_TOKEN = os.getenv("REPLICATE_API_TOKEN")
MODEL_SLUG = os.getenv("REPLICATE_MODEL", "meta/musicgen")
client = replicate.Client(api_token=REPLICATE_TOKEN) if REPLICATE_TOKEN else None

PAPAGO_CLIENT_ID = os.getenv("PAPAGO_CLIENT_ID")
PAPAGO_CLIENT_SECRET = os.getenv("PAPAGO_CLIENT_SECRET")

# â”€â”€â”€â”€â”€ Flask app â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
app = Flask(__name__)
CORS(app)

UPLOAD_FOLDER = os.path.join(os.path.dirname(os.path.abspath(__file__)), "uploads")
OUTPUT_FOLDER = os.path.join(os.path.dirname(os.path.abspath(__file__)), "outputs")
os.makedirs(UPLOAD_FOLDER, exist_ok=True)
os.makedirs(OUTPUT_FOLDER, exist_ok=True)

STATIC_FOLDER = os.path.join(os.path.dirname(os.path.abspath(__file__)), 'static')
os.makedirs(STATIC_FOLDER, exist_ok=True)

fluidsynth_executable_path = r'C:\Program Files\FluidSynth\bin'
if fluidsynth_executable_path not in os.environ['PATH']:
    os.environ['PATH'] += os.pathsep + fluidsynth_executable_path

# â”€â”€â”€â”€â”€ in-memory task ê´€ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TASKS: Dict[str, Dict[str, Any]] = {}

def _set_task_status(task_id: str, status: str, **kwargs):
    TASKS[task_id] = {"status": status, **kwargs}

# â”€â”€â”€â”€â”€ Papago ë²ˆì—­ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def translate_to_english(text: str) -> str:
    """Papago APIë¥¼ ì‚¬ìš©í•˜ì—¬ í•œêµ­ì–´ í…ìŠ¤íŠ¸ë¥¼ ì˜ì–´ë¡œ ë²ˆì—­í•˜ëŠ” í•¨ìˆ˜"""
    # --- [ë””ë²„ê¹… ë¡œê·¸] ---
    print("\n--- Papago ë²ˆì—­ ì‹œì‘ ---")
    print(f"[Papago] ì›ë³¸ í…ìŠ¤íŠ¸: '{text}'")
    
    if not all([PAPAGO_CLIENT_ID, PAPAGO_CLIENT_SECRET]):
        print("[Papago] Papago API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•„ ë²ˆì—­ì„ ê±´ë„ˆëœë‹ˆë‹¤.")
        print("--- Papago ë²ˆì—­ ì¢…ë£Œ ---\n")
        return text
    if not text or not text.strip():
        print("[Papago] ì…ë ¥ í…ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆì–´ ë²ˆì—­ì„ ê±´ë„ˆëœë‹ˆë‹¤.")
        print("--- Papago ë²ˆì—­ ì¢…ë£Œ ---\n")
        return text

    try:
        url = "https://papago.apigw.ntruss.com/nmt/v1/translation"
        headers = {
            "X-NCP-APIGW-API-KEY-ID": PAPAGO_CLIENT_ID,
            "X-NCP-APIGW-API-KEY": PAPAGO_CLIENT_SECRET,
        }
        data = {"source": "ko", "target": "en", "text": text}
        
        # --- [ë””ë²„ê¹… ë¡œê·¸] ---
        print("[Papago] API ì„œë²„ë¡œ ë²ˆì—­ì„ ìš”ì²­í•©ë‹ˆë‹¤...")
        response = requests.post(url, headers=headers, data=data, timeout=5)
        
        if response.status_code != 200:
            # --- [ë””ë²„ê¹… ë¡œê·¸] ---
            print(f"[Papago Error] APIê°€ ì˜¤ë¥˜ë¥¼ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤. ìƒíƒœ ì½”ë“œ: {response.status_code}")
            print(f"[Papago Error] ì‘ë‹µ ë‚´ìš©: {response.text}")
            print("--- Papago ë²ˆì—­ ì¢…ë£Œ ---\n")
            return text # ì˜¤ë¥˜ ì‹œ ì›ë³¸ í…ìŠ¤íŠ¸ ë°˜í™˜

        result = response.json()
        translated_text = result.get("message", {}).get("result", {}).get("translatedText")
        
        if translated_text:
            # --- [ë””ë²„ê¹… ë¡œê·¸] ---
            print(f"[Papago] âœ¨ ë²ˆì—­ ì„±ê³µ! âœ¨ -> '{translated_text}'")
            print("--- Papago ë²ˆì—­ ì¢…ë£Œ ---\n")
            return translated_text
        
        # --- [ë””ë²„ê¹… ë¡œê·¸] ---
        print("[Papago] ë²ˆì—­ëœ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ ì›ë³¸ì„ ë°˜í™˜í•©ë‹ˆë‹¤.")
        print("--- Papago ë²ˆì—­ ì¢…ë£Œ ---\n")
        return text

    except requests.exceptions.RequestException as e:
        print(f"[Papago Error] API ìš”ì²­ ì‹¤íŒ¨: {e}")
        print("--- Papago ë²ˆì—­ ì¢…ë£Œ ---\n")
        return text
    except Exception as e:
        print(f"[Papago Error] ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜: {e}")
        print("--- Papago ë²ˆì—­ ì¢…ë£Œ ---\n")
        return text

# â”€â”€â”€â”€â”€ Replicate AI ìŒì•… ìƒì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def mk_result(audio_url: str, title="AI_Track",
              genres: Optional[List[str]] = None,
              moods: Optional[List[str]] = None,
              duration: int = 10, kind: str = "generated"):
    return {
        "id": str(uuid.uuid4()),
        "title": title,
        "genres": genres or [],
        "moods": moods or [],
        "duration": duration,
        "audioUrl": audio_url,
        "createdAt": time.strftime("%Y-%m-%dT%H:%M:%SZ"),
        "type": kind,
    }

def _extract_audio_url(output: Any) -> Optional[str]:
    def as_url(v: Any) -> Optional[str]:
        if isinstance(v, str) and v.startswith("http"): return v
        try:
            u = getattr(v, "url", None)
            if isinstance(u, str) and u.startswith("http"): return u
        except Exception:
            pass
        return None

    u = as_url(output)
    if u: return u
    if isinstance(output, (list, tuple)):
        for item in output:
            u = as_url(item)
            if u: return u
    if isinstance(output, dict):
        for key in ("audioUrl", "audio_url", "url", "audio", "output"):
            if key in output:
                u = as_url(output[key])
                if u: return u
        files = output.get("files")
        if isinstance(files, list):
            for f in files:
                if isinstance(f, dict):
                    u = as_url(f.get("url"))
                    if u: return u
                else:
                    u = as_url(f)
                    if u: return u
        for parent in ("result", "data", "prediction"):
            if parent in output:
                u = _extract_audio_url(output[parent])
                if u: return u
    return None

def _run_replicate(input_dict: Dict[str, Any]) -> str:
    if not client:
        raise RuntimeError("No Replicate token loaded from .env")
    out = client.run(MODEL_SLUG, input=input_dict)
    url = _extract_audio_url(out)
    if not url:
        raise RuntimeError(f"Replicate returned no audio URL. raw={out}")
    return url

def worker_generate(task_id: str, prompt: str, genres, moods, duration: int,
                    tmp_path: Optional[str]):
    try:
        _set_task_status(task_id, "running")
        inputs: Dict[str, Any] = {
            "prompt": prompt or "instrumental background music",
            "duration": duration,
            "output_format": "mp3",
            "normalization_strategy": "peak",
        }
        if tmp_path:
            with open(tmp_path, "rb") as f:
                data = f.read()
            bio = BytesIO(data)
            setattr(bio, "name", os.path.basename(tmp_path))
            bio.seek(0)
            inputs["input_audio"] = bio
            inputs["continuation"] = False

        audio_url = _run_replicate(inputs)
        res = mk_result(audio_url, "AI_Generated_Track", genres, moods, duration, "generated")
        _set_task_status(task_id, "succeeded", result=res, audioUrl=res["audioUrl"])
    except Exception as e:
        print("[worker_generate] ERROR:", repr(e))
        _set_task_status(task_id, "failed", error=str(e))
    finally:
        if tmp_path:
            try: os.remove(tmp_path)
            except: pass

# â”€â”€â”€â”€â”€ PDF â†’ MusicXML â†’ MIDI/WAV/MP3 ë³€í™˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@app.route('/api/process-score', methods=['POST'])
def process_score():
    if 'score' not in request.files:
        return jsonify({'message': 'ì•…ë³´ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.'}), 400
    
    uploaded_file = request.files['score']

    if uploaded_file.filename == '':
        return jsonify({'message': 'íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'}), 400

    if uploaded_file and uploaded_file.filename.endswith('.pdf'):
        # --- 1. ê²½ë¡œ ì„¤ì • ---
        backend_dir = os.path.dirname(os.path.abspath(__file__))
        upload_folder = os.path.join(backend_dir, 'temp_scores')
        midi_folder = os.path.join(backend_dir, 'generated_midi')
        os.makedirs(upload_folder, exist_ok=True)
        os.makedirs(midi_folder, exist_ok=True)
        
        unique_filename = str(uuid.uuid4())
        pdf_path = os.path.join(upload_folder, f"{unique_filename}.pdf")
        uploaded_file.save(pdf_path)

        # --- 2. Audiveris ì‹¤í–‰ ê²½ë¡œ ì„¤ì • ---
        audiveris_jar_path = r"C:\Program Files\Audiveris\app"
        java_executable = r"C:\Program Files\Audiveris\runtime\bin\java"

        try:
            # --- 3. Audiveris ì‹¤í–‰ (PDF -> MusicXML) ---
            print(f"Audiveris ì‹¤í–‰ ì‹œì‘: {pdf_path}")
            print(f"Audiveris jar ê²½ë¡œ: {audiveris_jar_path}")
            
            jar_files = []
            for file_name in os.listdir(audiveris_jar_path):
                if file_name.endswith('.jar'):
                    jar_files.append(os.path.join(audiveris_jar_path, file_name))
            
            classpath = ';'.join(jar_files)
            print(f"í´ë˜ìŠ¤íŒ¨ìŠ¤ì— {len(jar_files)}ê°œ JAR íŒŒì¼ ì¶”ê°€")
            
            result = subprocess.run(
                [
                    java_executable,
                    '-cp', classpath,
                    '-Djava.awt.headless=true',
                    '-Xmx2g',
                    '-Duser.language=en',
                    '-Duser.country=US',
                    'org.audiveris.omr.Main',
                    '-batch',
                    '-export',
                    '-output', upload_folder,
                    pdf_path
                ],
                capture_output=True,
                text=True,
                encoding='utf-8',
                timeout=1800
            )

            print("Audiveris ì‹¤í–‰ ì™„ë£Œ")

            if result.returncode != 0:
                print("----- Audiveris Stderr -----")
                print(result.stderr)
                print("----- Audiveris Stdout -----")
                print(result.stdout)
                
                if "UnsupportedClassVersionError" in result.stderr or "Preview features" in result.stderr:
                    raise subprocess.CalledProcessError(result.returncode, result.args, result.stdout, result.stderr)
                elif "No installed OCR languages" in result.stdout:
                    print("OCR ì–¸ì–´ íŒ¨í‚¤ì§€ê°€ ì—†ì§€ë§Œ ì•…ë³´ ì¸ì‹ì€ ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤.")
                else:
                    raise subprocess.CalledProcessError(result.returncode, result.args, result.stdout, result.stderr)

            # --- 4. ë³€í™˜ëœ MusicXML íŒŒì¼ ì°¾ê¸° ---
            print(f"ì¶œë ¥ í´ë” ë‚´ìš© í™•ì¸: {os.listdir(upload_folder)}")
            
            base_pdf_name = os.path.splitext(os.path.basename(pdf_path))[0]
            possible_extensions = ['.mxl', '.xml', '.musicxml']
            music_file_path = None
            
            for ext in possible_extensions:
                potential_path = os.path.join(upload_folder, f"{base_pdf_name}{ext}")
                if os.path.exists(potential_path):
                    music_file_path = potential_path
                    print(f"ë³€í™˜ëœ íŒŒì¼ ë°œê²¬: {music_file_path}")
                    break
            
            if not music_file_path:
                for file_item in os.listdir(upload_folder):
                    if any(file_item.endswith(ext) for ext in possible_extensions):
                        music_file_path = os.path.join(upload_folder, file_item)
                        print(f"í´ë” ê²€ìƒ‰ìœ¼ë¡œ ë°œê²¬ëœ íŒŒì¼: {music_file_path}")
                        break
            
            if not music_file_path or not os.path.exists(music_file_path):
                raise FileNotFoundError("MusicXML íŒŒì¼ì´ ë³€í™˜ í›„ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")

        except subprocess.TimeoutExpired:
            print("!!! Audiveris ì‹¤í–‰ ì‹œê°„ ì´ˆê³¼ !!!")
            return jsonify({'message': 'ì•…ë³´ ë³€í™˜ ì‘ì—…ì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë ¤ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.'}), 500
        except subprocess.CalledProcessError as e:
            return jsonify({'message': 'PDFë¥¼ MusicXMLë¡œ ë³€í™˜í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}), 500
        except FileNotFoundError as e:
            print(f"íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {e}")
            return jsonify({'message': 'ë³€í™˜ëœ MusicXML íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}), 500

        # --- 5. MusicXML -> WAV ë³€í™˜ (ë°˜ë³µ ê¸°í˜¸ ì˜¤ë¥˜ ì²˜ë¦¬) ---
        try:
            print(f"Music21ë¡œ íŒŒì¼ íŒŒì‹± ì‹œì‘: {music_file_path}")
            score = converter.parse(music_file_path)
            
            # MIDI íŒŒì¼ ìƒì„±
            midi_filename = f"{unique_filename}.mid"
            midi_path = os.path.join(midi_folder, midi_filename)
            
            print(f"MIDI íŒŒì¼ ìƒì„± ì¤‘: {midi_path}")
            
            # ë°˜ë³µ ê¸°í˜¸ ì²˜ë¦¬ ì‹œë„
            try:
                # 1ì°¨ ì‹œë„: ë°˜ë³µ ê¸°í˜¸ í™•ì¥
                expanded_score = score.expandRepeats()
                expanded_score.write('midi', fp=midi_path)
                print(f"MIDI íŒŒì¼ ìƒì„± ì™„ë£Œ (ë°˜ë³µ í™•ì¥): {midi_path}")
            except Exception as repeat_error:
                print(f"ë°˜ë³µ í™•ì¥ ì‹¤íŒ¨: {repeat_error}")
                try:
                    # 2ì°¨ ì‹œë„: ë°˜ë³µ ê¸°í˜¸ ë¬´ì‹œí•˜ê³  ìƒì„±
                    print("ë°˜ë³µ ê¸°í˜¸ë¥¼ ì œê±°í•˜ê³  ë‹¤ì‹œ ì‹œë„í•©ë‹ˆë‹¤...")
                    
                    # ëª¨ë“  ë°˜ë³µ ê¸°í˜¸ ì œê±°
                    for part in score.parts:
                        for measure in part.getElementsByClass('Measure'):
                            # ë°˜ë³µ ê¸°í˜¸ ì œê±°
                            for repeat in measure.getElementsByClass('Repeat'):
                                measure.remove(repeat)
                            for barline in measure.getElementsByClass('Barline'):
                                if barline.type in ['regular', 'final']:
                                    continue
                                measure.remove(barline)
                    
                    score.write('midi', fp=midi_path)
                    print(f"MIDI íŒŒì¼ ìƒì„± ì™„ë£Œ (ë°˜ë³µ ì œê±°): {midi_path}")
                except Exception as fallback_error:
                    print(f"ë°˜ë³µ ì œê±° í›„ì—ë„ ì‹¤íŒ¨: {fallback_error}")
                    # 3ì°¨ ì‹œë„: flattenìœ¼ë¡œ ë‹¨ìˆœí™”
                    try:
                        print("ì•…ë³´ë¥¼ ë‹¨ìˆœí™”í•˜ì—¬ ë‹¤ì‹œ ì‹œë„í•©ë‹ˆë‹¤...")
                        flat_score = score.flatten()
                        flat_score.write('midi', fp=midi_path)
                        print(f"MIDI íŒŒì¼ ìƒì„± ì™„ë£Œ (ë‹¨ìˆœí™”): {midi_path}")
                    except Exception as final_error:
                        print(f"ëª¨ë“  ë³€í™˜ ì‹œë„ ì‹¤íŒ¨: {final_error}")
                        raise Exception(f"MIDI ë³€í™˜ ì‹¤íŒ¨: {final_error}")
            
            # WAV íŒŒì¼ë¡œ ë³€í™˜
            wav_filename = f"{unique_filename}.wav"
            wav_path = os.path.join(midi_folder, wav_filename)
            
            try:
                print(f"WAV íŒŒì¼ ë³€í™˜ ì¤‘: {wav_path}")
                fs = FluidSynth(sound_font=r'C:\soundfonts\FluidR3_GM.sf2')
                fs.midi_to_audio(midi_path, wav_path)
                print(f"WAV íŒŒì¼ ìƒì„± ì™„ë£Œ: {wav_path}")
                
                audio_url = f"http://127.0.0.1:5000/api/audio/{wav_filename}"
                audio_path = wav_path
            except Exception as e:
                print(f"FluidSynth ë³€í™˜ ì‹¤íŒ¨: {e}")
                import traceback
                traceback.print_exc()
                print("MIDI íŒŒì¼ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤")
                audio_url = f"http://127.0.0.1:5000/api/audio/{midi_filename}"
                audio_path = midi_path
            
            # ê³¡ ê¸¸ì´ ê³„ì‚°
            try:
                if score.metronomeMarkBoundaries():
                    tempo = score.metronomeMarkBoundaries()[0][-1].number
                    duration = int(score.duration.quarterLength / tempo * 60)
                else:
                    duration = 180
            except:
                duration = 180

            # ê²°ê³¼ ë°ì´í„° ìƒì„±
            result_data = {
                "id": unique_filename,
                "title": f"ì•…ë³´ ì—°ì£¼ - {uploaded_file.filename}",
                "audioUrl": audio_url,
                "audioPath": audio_path,
                "genres": ["Classical"],
                "moods": [],
                "duration": duration,
                "createdAt": time.strftime("%Y-%m-%dT%H:%M:%SZ"),
                "type": "score-audio"
            }

            print(f"ì˜¤ë””ì˜¤ íŒŒì¼ ì¤€ë¹„ ì™„ë£Œ: {result_data}")
            
            # Task ID ìƒì„± ë° ì €ì¥
            task_id = uuid.uuid4().hex
            _set_task_status(task_id, "succeeded", result=result_data, audioUrl=audio_url)
            print(f"Task ID ìƒì„±: {task_id}")

        except Exception as e:
            print(f"ì˜¤ë””ì˜¤ ë³€í™˜ ì˜¤ë¥˜: {e}")
            import traceback
            traceback.print_exc()
            return jsonify({'message': f'ì˜¤ë””ì˜¤ ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}'}), 500

        finally:
            # ì„ì‹œ íŒŒì¼ ì •ë¦¬
            try:
                os.remove(pdf_path)
                if music_file_path and os.path.exists(music_file_path):
                    os.remove(music_file_path)
                for file_item in os.listdir(upload_folder):
                    if file_item.endswith(('.log', '.omr')):
                        try:
                            os.remove(os.path.join(upload_folder, file_item))
                        except:
                            pass
            except Exception as cleanup_error:
                print(f"íŒŒì¼ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜: {cleanup_error}")
        
        # taskId ë°˜í™˜ (ë‹¤ë¥¸ APIì™€ ë™ì¼í•œ í˜•ì‹)
        return jsonify({
            'taskId': task_id
        })

    return jsonify({'message': 'ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.'}), 400

# â”€â”€â”€â”€â”€ ì˜¤ë””ì˜¤ ì„œë¹™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@app.route('/api/audio/<filename>', methods=['GET'])
def serve_audio(filename):
    # ì—¬ëŸ¬ í´ë”ì—ì„œ íŒŒì¼ ì°¾ê¸°
    backend_dir = os.path.dirname(os.path.abspath(__file__))
    
    possible_paths = [
        os.path.join(backend_dir, 'generated_midi', filename),  # ì•…ë³´ ë³€í™˜ íŒŒì¼
        os.path.join(OUTPUT_FOLDER, filename),                   # AI ìƒì„± íŒŒì¼
        os.path.join(STATIC_FOLDER, filename)                    # ê¸°íƒ€ íŒŒì¼
    ]
    
    for audio_path in possible_paths:
        if os.path.exists(audio_path):
            print(f"íŒŒì¼ ì œê³µ: {audio_path}")
            return send_file(audio_path)
    
    print(f"íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: {filename}")
    print(f"ê²€ìƒ‰í•œ ê²½ë¡œë“¤:")
    for path in possible_paths:
        print(f"  - {path} (ì¡´ì¬: {os.path.exists(path)})")
    
    return jsonify({'error': 'íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'}), 404

# â”€â”€â”€â”€â”€ AI ìŒì•… ìƒì„± ì—”ë“œí¬ì¸íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@app.route("/api/music/generate", methods=["POST"])
def generate_music():
    ct = (request.content_type or "")
    is_multipart = ct.startswith("multipart/form-data")

    if is_multipart:
        data = request.form
        up = request.files.get("file")
    else:   
        data = request.get_json(force=True, silent=True) or {}
        up = None

    import json
    def as_list(v):
        if v is None: return []
        if isinstance(v, list): return v
        if isinstance(v, str):
            try: return json.loads(v)
            except: return [v] if v else []
        return []

    prompt = data.get("description") or "instrumental background music"
    genres = as_list(data.get("genres"))
    moods = as_list(data.get("moods"))
    try: duration = int(data.get("duration") or 10)
    except: duration = 10

    tmp_path = None
    if up:
        os.makedirs("tmp", exist_ok=True)
        safe = secure_filename(up.filename or f"audio_{uuid.uuid4().hex}.wav")
        tmp_path = os.path.join("tmp", f"{uuid.uuid4().hex}_{safe}")
        up.save(tmp_path)

    task_id = uuid.uuid4().hex
    _set_task_status(task_id, "queued")
    threading.Thread(target=worker_generate,
                     args=(task_id, prompt, genres, moods, duration, tmp_path),
                     daemon=True).start()
    return jsonify({"taskId": task_id})

@app.route("/api/music/task/status", methods=["GET"])
def task_status():
    task_id = request.args.get("task_id") or request.args.get("taskId")
    task = TASKS.get(task_id)
    if not task:
        return jsonify({"status": "failed", "error": "Unknown task"}), 404
    return jsonify({
        "taskId": task_id,
        "status": task.get("status"),
        "audioUrl": task.get("audioUrl"),
        "result": task.get("result"),
        "error": task.get("error"),
    })

# â”€â”€â”€â”€â”€ ì„œë²„ ì‹¤í–‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if __name__ == "__main__":
    app.run(host="127.0.0.1", port=5000, debug=True)
</file>

<file path="package.json">
{
  "name": "ai-music-frontend",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.0",
    "@magenta/music": "1.23.1",
    "@mui/icons-material": "^7.1.1",
    "@mui/material": "^7.1.1",
    "@testing-library/dom": "^10.4.0",
    "@testing-library/jest-dom": "^6.6.3",
    "@testing-library/react": "^16.3.0",
    "@tensorflow/tfjs": "1.7.4",
    "buffer": "^6.0.3",
    "firebase": "^11.10.0",
    "react": "^19.1.0",
    "react-dom": "^19.1.0",
    "react-dropzone": "^14.3.8",
    "react-error-boundary": "^6.0.0",
    "react-router-dom": "^7.6.1",
    "react-scripts": "5.0.1",
    "tone": "14.7.58",
    "web-vitals": "^2.1.4"
  },
  "overrides": {
    "@tensorflow/tfjs": "1.7.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": { "extends": ["react-app","react-app/jest"] },
  "browserslist": {
    "production": [">0.2%","not dead","not op_mini all"],
    "development": ["last 1 chrome version","last 1 firefox version","last 1 safari version"]
  }
}
</file>

<file path="src/components/beat/BlendPadCanvas.jsx">
// src/components/beat/BlendPadCanvas.jsx
import React, { useEffect, useRef, useState } from "react";
import { useBeatPad } from "../../state/beatPadStore";
import { useCellGrid } from "../../hooks/useCellGrid";
import { cellCache } from "../../lib/beatblender/cellCache";
import { encodeCorners, decodeAtPosition } from "../../lib/drumsVAE";

export default function BlendPadCanvas({ corners, onDecodedPattern }) {
  const ref = useRef(null);
  const { state, dispatch } = useBeatPad();
  const { toCell, centerOf } = useCellGrid(state.grid.cols, state.grid.rows);

  const [dragging, setDragging] = useState(false);
  const lastIndexRef = useRef(-1);
  const lastPathPointRef = useRef({ x: -1, y: -1 });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ì¢Œí‘œ ë³´ì •: 0~1 ì •ê·œí™” ì¢Œí‘œë¡œ ë³€í™˜
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const getXY01 = (e) => {
    const el = ref.current;
    if (!el) return { x: 0.5, y: 0.5 };
    const r = el.getBoundingClientRect();
    const px = e.clientX ?? (e.touches && e.touches[0]?.clientX) ?? 0;
    const py = e.clientY ?? (e.touches && e.touches[0]?.clientY) ?? 0;
    const x = (px - r.left) / r.width;
    const y = (py - r.top) / r.height;
    return { x: Math.max(0, Math.min(1, x)), y: Math.max(0, Math.min(1, y)) };
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // VAE ì¸ì½”ë”©/ë””ì½”ë”© ë³´ì¡°
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ensureEncodings = async () => {
    if (state.cornerEncodings) return state.cornerEncodings;
    if (!corners) return null;
    const enc = await encodeCorners(corners);
    dispatch({ type: "SET_CORNERS", encodings: enc });
    return enc;
  };

  const ensureDecoded = async (cell) => {
    const idx = cell.index;
    let pattern = cellCache.get(state.cellCacheVersion, idx);
    if (pattern) return pattern;

    const enc = await ensureEncodings();
    if (!enc) return null;

    const { x, y } = centerOf(cell);
    pattern = await decodeAtPosition(enc, x, y, 1.1);
    if (pattern) cellCache.set(state.cellCacheVersion, idx, pattern);
    return pattern;
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // CELL ëª¨ë“œ: ì…€ ìŠ¤ëƒ… í›„ ì¦‰ì‹œ ë””ì½”ë“œ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const applyAtEventCellMode = async (e) => {
    const { x, y } = getXY01(e);
    const cell = toCell(x, y);
    dispatch({ type: "SELECT_CELL", cell });

    // ê°™ì€ ì…€ ë°˜ë³µ ë””ì½”ë“œ ë°©ì§€
    if (cell.index === lastIndexRef.current) return;
    lastIndexRef.current = cell.index;

    const pattern = await ensureDecoded(cell);
    if (pattern && onDecodedPattern) onDecodedPattern(pattern);
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // DRAW ëª¨ë“œ: ê²½ë¡œ ì  ëˆ„ì (ë„ˆë¬´ ì´˜ì´˜í•˜ë©´ ìŠ¤í‚µ)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const pushPathPoint = (x, y) => {
    const prev = lastPathPointRef.current;
    const dx = x - prev.x, dy = y - prev.y;
    // 1% ì´ìƒ ì´ë™í–ˆì„ ë•Œë§Œ ìƒ˜í”Œë§
    if (prev.x < 0 || Math.hypot(dx, dy) > 0.01) {
      dispatch({ type: "APPEND_PATH_POINT", point: { x, y } });
      lastPathPointRef.current = { x, y };
    }
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Pointer ì´ë²¤íŠ¸: ë§ˆìš°ìŠ¤/í„°ì¹˜ í†µí•©
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  useEffect(() => {
    const el = ref.current;
    if (!el) return;

    const onPointerDown = (e) => {
      // ìš°í´ë¦­ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ë°©ì§€
      if (e.button === 2) return;
      setDragging(true);
      lastIndexRef.current = -1;
      lastPathPointRef.current = { x: -1, y: -1 };
      el.setPointerCapture?.(e.pointerId);

      if (state.mode === "CELL") {
        applyAtEventCellMode(e);
      } else {
        const { x, y } = getXY01(e);
        dispatch({ type: "RESET_PATH" });
        dispatch({ type: "APPEND_PATH_POINT", point: { x, y } });
        lastPathPointRef.current = { x, y };
      }

      e.preventDefault();
    };

    const onPointerMove = (e) => {
      if (!dragging) return;
      if (state.mode === "CELL") {
        // ì™¼ìª½ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ìˆëŠ” ë™ì•ˆë§Œ
        if ((e.buttons & 1) === 0 && e.pointerType !== "touch") return;
        applyAtEventCellMode(e);
      } else {
        const { x, y } = getXY01(e);
        pushPathPoint(x, y);
      }
    };

    const endDrag = (e) => {
      setDragging(false);
      el.releasePointerCapture?.(e.pointerId);
    };

    el.addEventListener("pointerdown", onPointerDown, { passive: false });
    window.addEventListener("pointermove", onPointerMove, { passive: true });
    window.addEventListener("pointerup", endDrag);
    window.addEventListener("pointercancel", endDrag);
    window.addEventListener("pointerleave", endDrag);

    return () => {
      el.removeEventListener("pointerdown", onPointerDown);
      window.removeEventListener("pointermove", onPointerMove);
      window.removeEventListener("pointerup", endDrag);
      window.removeEventListener("pointercancel", endDrag);
      window.removeEventListener("pointerleave", endDrag);
    };
    // state.modeë§Œ ì˜ì¡´ (corners/encodingsì€ ë‚´ë¶€ ensure í•¨ìˆ˜ì—ì„œ ì²˜ë¦¬)
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [state.mode, dragging]);

  return (
    <canvas
      ref={ref}
      className="blendpad-canvas"
      onContextMenu={(e) => e.preventDefault()}
      role="application"
      tabIndex={0}
      aria-label="Beat blend pad"
    />
  );
}
</file>

<file path="src/components/beat/PathOverlay.jsx">
import React, { useEffect, useRef } from 'react';
import { useBeatPad } from '../../state/beatPadStore';

export default function PathOverlay() {
  const { state } = useBeatPad();
  const cvsRef = useRef(null);
  const rafRef = useRef(null);

  useEffect(() => {
    const cvs = cvsRef.current;
    if (!cvs) return;
    const ctx = cvs.getContext('2d');

    // ë§ˆì§€ë§‰ìœ¼ë¡œ ë°˜ì˜í•œ ì‚¬ì´ì¦ˆ/ìŠ¤ì¼€ì¼ ê¸°ì–µ
    let lastW = 0, lastH = 0, lastDpr = 0;

    const ensureSize = () => {
      const rect = cvs.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      const needResize =
        rect.width !== lastW || rect.height !== lastH || dpr !== lastDpr;

      if (needResize) {
        lastW = rect.width;
        lastH = rect.height;
        lastDpr = dpr;

        // â˜… rAF ë£¨í”„ì—ì„œë§Œ ìº”ë²„ìŠ¤ ì‹¤ì œ í”½ì…€ ì‚¬ì´ì¦ˆ ê°±ì‹  (ResizeObserver ì‚¬ìš© ì•ˆ í•¨)
        const w = Math.max(1, Math.round(rect.width * dpr));
        const h = Math.max(1, Math.round(rect.height * dpr));
        if (cvs.width !== w || cvs.height !== h) {
          cvs.width = w;
          cvs.height = h;
          ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }
      }
    };

    const draw = () => {
      ensureSize();

      const rect = cvs.getBoundingClientRect();
      const w = rect.width;
      const h = rect.height;

      ctx.clearRect(0, 0, w, h);

      // DRAW ëª¨ë“œì—ì„œë§Œ ê²½ë¡œ ê·¸ë¦¼
      const pts = state.mode === 'DRAW' ? state.path : null;
      if (pts && pts.length) {
        ctx.save();
        ctx.lineWidth = 2.5;
        ctx.strokeStyle = '#2DD4BF';
        ctx.globalAlpha = 0.9;
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';

        ctx.beginPath();
        ctx.moveTo(pts[0].x * w, pts[0].y * h);
        for (let i = 1; i < pts.length; i++) {
          ctx.lineTo(pts[i].x * w, pts[i].y * h);
        }
        ctx.stroke();

        // ë§ˆì§€ë§‰ ì  ê°•ì¡°
        const last = pts[pts.length - 1];
        ctx.fillStyle = '#2DD4BF';
        ctx.beginPath();
        ctx.arc(last.x * w, last.y * h, 4, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      }

      rafRef.current = requestAnimationFrame(draw);
    };

    rafRef.current = requestAnimationFrame(draw);
    return () => {
      if (rafRef.current) cancelAnimationFrame(rafRef.current);
    };
  }, [state.mode, state.path]);

  return <canvas ref={cvsRef} className="path-overlay" />;
}
</file>

<file path="src/context/MusicContext.js">
import React, { createContext, useContext, useReducer, useCallback, useEffect } from 'react';
import {
  onAuthStateChanged,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut as firebaseSignOut,
  updateProfile,
} from 'firebase/auth';
import { subscribeToUserLibrary } from '../services/libraryApi';

import { auth as firebaseAuth } from '../lib/firebase';

// ì´ˆê¸° ìƒíƒœ ì •ì˜
const initialState = {
  // ìŒì•… ìƒì„± ê´€ë ¨ ìƒíƒœ
  generation: {
    selectedGenres: [],
    selectedMoods: [],
    description: '',
    duration: 30, // ì´ˆ ë‹¨ìœ„ (ê¸°ë³¸ 2ë¶„)
    isGenerating: false,
    generationProgress: 0,
  },
  
  // ìŒì•… ë³€í™˜ ê´€ë ¨ ìƒíƒœ
  conversion: {
    uploadedFile: null,
    targetGenre: '',
    conversionIntensity: 3, // 1-5 ìŠ¤ì¼€ì¼
    isConverting: false,
    conversionProgress: 0,
  },
  
  // ê²°ê³¼ ê´€ë ¨ ìƒíƒœ
  result: {
    generatedMusic: null,
    convertedMusic: null,
    isPlaying: false,
    currentTime: 0,
    duration: 0,
  },
  
  // ì¸ì¦ ìƒíƒœ
  auth: {
    user: null,
    status: 'idle', // idle | loading | authenticated | unauthenticated | error
    error: null,
  },
  
  // ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë ¨ ìƒíƒœ
  library: {
    musicList: [],
    selectedMusic: null,
    sortBy: 'date', // 'date', 'genre', 'favorites'
    filterBy: 'all', // 'all', 'generated', 'converted'
    loading: false,
    error: null,
  },
  
  // UI ìƒíƒœ
  ui: {
    currentPage: 'generate',
    notifications: [],
    loading: false,
    error: null,
  }
};

// ì•¡ì…˜ íƒ€ì… ì •ì˜
const actionTypes = {
  // ìŒì•… ìƒì„± ì•¡ì…˜
  SET_SELECTED_GENRES: 'SET_SELECTED_GENRES',
  SET_SELECTED_MOODS: 'SET_SELECTED_MOODS',
  SET_DESCRIPTION: 'SET_DESCRIPTION',
  SET_DURATION: 'SET_DURATION',
  START_GENERATION: 'START_GENERATION',
  UPDATE_GENERATION_PROGRESS: 'UPDATE_GENERATION_PROGRESS',
  COMPLETE_GENERATION: 'COMPLETE_GENERATION',
  
  // ìŒì•… ë³€í™˜ ì•¡ì…˜
  SET_UPLOADED_FILE: 'SET_UPLOADED_FILE',
  SET_TARGET_GENRE: 'SET_TARGET_GENRE',
  SET_CONVERSION_INTENSITY: 'SET_CONVERSION_INTENSITY',
  START_CONVERSION: 'START_CONVERSION',
  UPDATE_CONVERSION_PROGRESS: 'UPDATE_CONVERSION_PROGRESS',
  COMPLETE_CONVERSION: 'COMPLETE_CONVERSION',
  
  // ì¬ìƒ ê´€ë ¨ ì•¡ì…˜
  SET_PLAYING: 'SET_PLAYING',
  UPDATE_CURRENT_TIME: 'UPDATE_CURRENT_TIME',
  SET_RESULT_MUSIC: 'SET_RESULT_MUSIC',
  SET_RESULT: 'SET_RESULT',
  
  // ë¼ì´ë¸ŒëŸ¬ë¦¬ ì•¡ì…˜
  ADD_TO_LIBRARY: 'ADD_TO_LIBRARY',
  REMOVE_FROM_LIBRARY: 'REMOVE_FROM_LIBRARY',
  SET_LIBRARY_ITEMS: 'SET_LIBRARY_ITEMS',
  SET_LIBRARY_LOADING: 'SET_LIBRARY_LOADING',
  SET_LIBRARY_ERROR: 'SET_LIBRARY_ERROR',
  CLEAR_LIBRARY: 'CLEAR_LIBRARY',
  UPDATE_LIBRARY_SORT: 'UPDATE_LIBRARY_SORT',
  UPDATE_LIBRARY_FILTER: 'UPDATE_LIBRARY_FILTER',
  
  // UI ì•¡ì…˜
  SET_CURRENT_PAGE: 'SET_CURRENT_PAGE',
  ADD_NOTIFICATION: 'ADD_NOTIFICATION',
  REMOVE_NOTIFICATION: 'REMOVE_NOTIFICATION',
  SET_LOADING: 'SET_LOADING',
  SET_ERROR: 'SET_ERROR',
  CLEAR_ERROR: 'CLEAR_ERROR',

  // ì¸ì¦ ì•¡ì…˜
  AUTH_SET_STATUS: 'AUTH_SET_STATUS',
  AUTH_STATE_CHANGE: 'AUTH_STATE_CHANGE',
  AUTH_SET_ERROR: 'AUTH_SET_ERROR',
};

// ë¦¬ë“€ì„œ í•¨ìˆ˜
function musicReducer(state, action) {
  switch (action.type) {
    // ìŒì•… ìƒì„± ê´€ë ¨
    case actionTypes.SET_SELECTED_GENRES:
      return {
        ...state,
        generation: {
          ...state.generation,
          selectedGenres: action.payload
        }
      };
    
    case actionTypes.SET_SELECTED_MOODS:
      return {
        ...state,
        generation: {
          ...state.generation,
          selectedMoods: action.payload
        }
      };
    
    case actionTypes.SET_DESCRIPTION:
      return {
        ...state,
        generation: {
          ...state.generation,
          description: action.payload
        }
      };
    
    case actionTypes.SET_DURATION:
      return {
        ...state,
        generation: {
          ...state.generation,
          duration: action.payload
        }
      };
    
    case actionTypes.START_GENERATION:
      return {
        ...state,
        generation: {
          ...state.generation,
          isGenerating: true,
          generationProgress: 0
        },
        ui: {
          ...state.ui,
          loading: true,
          error: null
        }
      };
    
    case actionTypes.UPDATE_GENERATION_PROGRESS:
      return {
        ...state,
        generation: {
          ...state.generation,
          generationProgress: action.payload
        }
      };
    
    case actionTypes.COMPLETE_GENERATION:
      return {
        ...state,
        generation: {
          ...state.generation,
          isGenerating: false,
          generationProgress: 100
        },
        result: {
          ...state.result,
          generatedMusic: action.payload
        },
        ui: {
          ...state.ui,
          loading: false,
          currentPage: 'result'
        }
      };
    
    // ìŒì•… ë³€í™˜ ê´€ë ¨
    case actionTypes.SET_UPLOADED_FILE:
      return {
        ...state,
        conversion: {
          ...state.conversion,
          uploadedFile: action.payload
        }
      };
    
    case actionTypes.SET_TARGET_GENRE:
      return {
        ...state,
        conversion: {
          ...state.conversion,
          targetGenre: action.payload
        }
      };
    
    case actionTypes.SET_CONVERSION_INTENSITY:
      return {
        ...state,
        conversion: {
          ...state.conversion,
          conversionIntensity: action.payload
        }
      };
    
    case actionTypes.START_CONVERSION:
      return {
        ...state,
        conversion: {
          ...state.conversion,
          isConverting: true,
          conversionProgress: 0
        },
        ui: {
          ...state.ui,
          loading: true,
          error: null
        }
      };
    
    case actionTypes.COMPLETE_CONVERSION:
      return {
        ...state,
        conversion: {
          ...state.conversion,
          isConverting: false,
          conversionProgress: 100
        },
        result: {
          ...state.result,
          convertedMusic: action.payload
        },
        ui: {
          ...state.ui,
          loading: false,
          currentPage: 'result'
        }
      };
    
    // ì¬ìƒ ê´€ë ¨
    case actionTypes.SET_PLAYING:
      return {
        ...state,
        result: {
          ...state.result,
          isPlaying: action.payload
        }
      };
    
    case actionTypes.UPDATE_CURRENT_TIME:
      return {
        ...state,
        result: {
          ...state.result,
          currentTime: action.payload
        }
      };

      case actionTypes.SET_RESULT:
      return {
        ...state,
        result: {
          ...state.result,
          ...action.payload
        }
      };
    
    // ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë ¨
    case actionTypes.ADD_TO_LIBRARY:
      return {
        ...state,
        library: {
          ...state.library,
          musicList: [...state.library.musicList, action.payload]
        }
      };

    case actionTypes.SET_LIBRARY_ITEMS:
      return {
        ...state,
        library: {
          ...state.library,
          musicList: action.payload,
          loading: false,
          error: null,
        },
      };

    case actionTypes.SET_LIBRARY_LOADING:
      return {
        ...state,
        library: {
          ...state.library,
          loading: action.payload,
        },
      };

    case actionTypes.SET_LIBRARY_ERROR:
      return {
        ...state,
        library: {
          ...state.library,
          error: action.payload,
          loading: false,
        },
      };

    case actionTypes.CLEAR_LIBRARY:
      return {
        ...state,
        library: {
          ...state.library,
          musicList: [],
          loading: false,
          error: null,
        },
      };

    // UI ê´€ë ¨
    case actionTypes.SET_CURRENT_PAGE:
      return {
        ...state,
        ui: {
          ...state.ui,
          currentPage: action.payload
        }
      };
    
    case actionTypes.ADD_NOTIFICATION:
      return {
        ...state,
        ui: {
          ...state.ui,
          notifications: [...state.ui.notifications, action.payload]
        }
      };
    
    case actionTypes.REMOVE_NOTIFICATION:
      return {
        ...state,
        ui: {
          ...state.ui,
          notifications: state.ui.notifications.filter(
            notification => notification.id !== action.payload
          )
        }
      };
    
    case actionTypes.SET_ERROR:
      return {
        ...state,
        ui: {
          ...state.ui,
          error: action.payload,
          loading: false
        }
      };
    
    case actionTypes.CLEAR_ERROR:
      return {
        ...state,
        ui: {
          ...state.ui,
          error: null
        }
      };

    // ì¸ì¦ ê´€ë ¨
    case actionTypes.AUTH_SET_STATUS:
      return {
        ...state,
        auth: {
          ...state.auth,
          status: action.payload,
        },
      };

    case actionTypes.AUTH_STATE_CHANGE:
      return {
        ...state,
        auth: {
          ...state.auth,
          user: action.payload,
          status: action.payload ? 'authenticated' : 'unauthenticated',
          error: null,
        },
      };

    case actionTypes.AUTH_SET_ERROR:
      return {
        ...state,
        auth: {
          ...state.auth,
          error: action.payload,
        },
      };

    default:
      return state;
  }
}

// Context ìƒì„±
const MusicContext = createContext();

// Context Provider ì»´í¬ë„ŒíŠ¸
export function MusicContextProvider({ children }) {
  const [state, dispatch] = useReducer(musicReducer, initialState);
  const pushNotification = useCallback((notification) => {
    const notificationWithId = {
      ...notification,
      id: Date.now() + Math.random(),
    };
    dispatch({ type: actionTypes.ADD_NOTIFICATION, payload: notificationWithId });
  }, [dispatch]);
  
  // ì•¡ì…˜ í¬ë¦¬ì—ì´í„°ë“¤ì„ useCallbackìœ¼ë¡œ ë©”ëª¨ì´ì œì´ì…˜
  const actions = {
    // ìŒì•… ìƒì„± ê´€ë ¨ ì•¡ì…˜ë“¤
    setSelectedGenres: useCallback((genres) => {
      dispatch({ type: actionTypes.SET_SELECTED_GENRES, payload: genres });
    }, []),
    
    setSelectedMoods: useCallback((moods) => {
      dispatch({ type: actionTypes.SET_SELECTED_MOODS, payload: moods });
    }, []),
    
    setDescription: useCallback((description) => {
      dispatch({ type: actionTypes.SET_DESCRIPTION, payload: description });
    }, []),
    
    setDuration: useCallback((duration) => {
      dispatch({ type: actionTypes.SET_DURATION, payload: duration });
    }, []),
    
    startGeneration: useCallback(() => {
      dispatch({ type: actionTypes.START_GENERATION });
    }, []),
    
    updateGenerationProgress: useCallback((progress) => {
      dispatch({ type: actionTypes.UPDATE_GENERATION_PROGRESS, payload: progress });
    }, []),
    
    completeGeneration: useCallback((musicData) => {
      dispatch({ type: actionTypes.COMPLETE_GENERATION, payload: musicData });
    }, []),
    
    // ìŒì•… ë³€í™˜ ê´€ë ¨ ì•¡ì…˜ë“¤
    setUploadedFile: useCallback((file) => {
      dispatch({ type: actionTypes.SET_UPLOADED_FILE, payload: file });
    }, []),
    
    setTargetGenre: useCallback((genre) => {
      dispatch({ type: actionTypes.SET_TARGET_GENRE, payload: genre });
    }, []),
    
    setConversionIntensity: useCallback((intensity) => {
      dispatch({ type: actionTypes.SET_CONVERSION_INTENSITY, payload: intensity });
    }, []),
    
    startConversion: useCallback(() => {
      dispatch({ type: actionTypes.START_CONVERSION });
    }, []),
    
    completeConversion: useCallback((musicData) => {
      dispatch({ type: actionTypes.COMPLETE_CONVERSION, payload: musicData });
    }, []),
    
    // ì¬ìƒ ê´€ë ¨ ì•¡ì…˜ë“¤
    setPlaying: useCallback((isPlaying) => {
      dispatch({ type: actionTypes.SET_PLAYING, payload: isPlaying });
    }, []),
    
    updateCurrentTime: useCallback((time) => {
      dispatch({ type: actionTypes.UPDATE_CURRENT_TIME, payload: time });
    }, []),
    
    setResult: useCallback((resultData) => {
      console.log('MusicContext setResult í˜¸ì¶œë¨:', resultData);
      dispatch({ type: actionTypes.SET_RESULT, payload: resultData });
    }, []),

    // ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë ¨ ì•¡ì…˜ë“¤
    addToLibrary: useCallback((musicData) => {
      dispatch({ type: actionTypes.ADD_TO_LIBRARY, payload: musicData });
    }, []),

    setLibraryItems: useCallback((items) => {
      dispatch({ type: actionTypes.SET_LIBRARY_ITEMS, payload: items });
    }, [dispatch]),

    setLibraryLoading: useCallback((flag) => {
      dispatch({ type: actionTypes.SET_LIBRARY_LOADING, payload: flag });
    }, [dispatch]),

    setLibraryError: useCallback((error) => {
      dispatch({ type: actionTypes.SET_LIBRARY_ERROR, payload: error });
    }, [dispatch]),

    // ì¸ì¦ ê´€ë ¨ ì•¡ì…˜ë“¤
    setAuthStatus: useCallback((status) => {
      dispatch({ type: actionTypes.AUTH_SET_STATUS, payload: status });
    }, []),

    setAuthError: useCallback((error) => {
      dispatch({ type: actionTypes.AUTH_SET_ERROR, payload: error });
    }, []),

    signUpWithEmail: useCallback(async ({ email, password, displayName }) => {
      dispatch({ type: actionTypes.AUTH_SET_STATUS, payload: 'loading' });
      try {
        const cred = await createUserWithEmailAndPassword(firebaseAuth, email, password);
        if (displayName) {
          await updateProfile(cred.user, { displayName });
        }
        pushNotification({ type: 'success', message: 'íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆì–´ìš”!' });
        return cred.user;
      } catch (error) {
        const message = error?.message || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆì–´ìš”.';
        dispatch({ type: actionTypes.AUTH_SET_ERROR, payload: message });
        dispatch({ type: actionTypes.AUTH_SET_STATUS, payload: 'unauthenticated' });
        pushNotification({ type: 'error', message });
        throw error;
      }
    }, [pushNotification]),

    signInWithEmail: useCallback(async ({ email, password }) => {
      dispatch({ type: actionTypes.AUTH_SET_STATUS, payload: 'loading' });
      try {
        const cred = await signInWithEmailAndPassword(firebaseAuth, email, password);
        pushNotification({ type: 'success', message: 'í™˜ì˜í•©ë‹ˆë‹¤! ë¡œê·¸ì¸ì— ì„±ê³µí–ˆì–´ìš”.' });
        return cred.user;
      } catch (error) {
        const message = error?.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆì–´ìš”.';
        dispatch({ type: actionTypes.AUTH_SET_ERROR, payload: message });
        dispatch({ type: actionTypes.AUTH_SET_STATUS, payload: 'unauthenticated' });
        pushNotification({ type: 'error', message });
        throw error;
      }
    }, [pushNotification]),

    signOut: useCallback(async () => {
      dispatch({ type: actionTypes.AUTH_SET_STATUS, payload: 'loading' });
      try {
        await firebaseSignOut(firebaseAuth);
        pushNotification({ type: 'info', message: 'ë¡œê·¸ì•„ì›ƒë˜ì—ˆì–´ìš”.' });
      } catch (error) {
        const message = error?.message || 'ë¡œê·¸ì•„ì›ƒ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆì–´ìš”.';
        dispatch({ type: actionTypes.AUTH_SET_ERROR, payload: message });
        dispatch({ type: actionTypes.AUTH_SET_STATUS, payload: 'error' });
        pushNotification({ type: 'error', message });
        throw error;
      }
    }, [pushNotification]),

    // UI ê´€ë ¨ ì•¡ì…˜ë“¤
    setCurrentPage: useCallback((page) => {
      dispatch({ type: actionTypes.SET_CURRENT_PAGE, payload: page });
    }, []),
    
    addNotification: useCallback((notification) => {
      pushNotification(notification);
    }, [pushNotification]),
    
    removeNotification: useCallback((id) => {
      dispatch({ type: actionTypes.REMOVE_NOTIFICATION, payload: id });
    }, []),
    
    setError: useCallback((error) => {
      dispatch({ type: actionTypes.SET_ERROR, payload: error });
    }, []),
    
    clearError: useCallback(() => {
      dispatch({ type: actionTypes.CLEAR_ERROR });
    }, []),
  };
  
  const value = {
    state,
    actions,
    dispatch
  };

  useEffect(() => {
    // ì´ˆê¸° ë¡œë”© ìƒíƒœë¥¼ í‘œì‹œí•˜ê³  Firebase Auth ìƒíƒœ ë³€í™”ë¥¼ êµ¬ë…
    dispatch({ type: actionTypes.AUTH_SET_STATUS, payload: 'loading' });
    const unsubscribe = onAuthStateChanged(
      firebaseAuth,
      (firebaseUser) => {
        if (firebaseUser) {
          const { uid, displayName, email, photoURL } = firebaseUser;
          dispatch({
            type: actionTypes.AUTH_STATE_CHANGE,
            payload: { uid, displayName, email, photoURL },
          });
        } else {
          dispatch({ type: actionTypes.AUTH_STATE_CHANGE, payload: null });
        }
      },
      (error) => {
        dispatch({
          type: actionTypes.AUTH_SET_ERROR,
          payload: error?.message || 'Authentication error',
        });
        dispatch({ type: actionTypes.AUTH_SET_STATUS, payload: 'error' });
      }
    );

    return () => unsubscribe();
  }, [dispatch]);

  useEffect(() => {
    let unsubscribeLibrary = null;
    const userId = state.auth.user?.uid;

    if (userId) {
      dispatch({ type: actionTypes.SET_LIBRARY_LOADING, payload: true });
      unsubscribeLibrary = subscribeToUserLibrary(userId, {
        onUpdate: (items) => {
          dispatch({ type: actionTypes.SET_LIBRARY_ITEMS, payload: items });
        },
        onError: (error) => {
          dispatch({
            type: actionTypes.SET_LIBRARY_ERROR,
            payload: error?.message || 'ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”.',
          });
          pushNotification({ type: 'error', message: 'ë¼ì´ë¸ŒëŸ¬ë¦¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”.' });
        },
      });
    } else {
      dispatch({ type: actionTypes.CLEAR_LIBRARY });
    }

    return () => {
      unsubscribeLibrary?.();
    };
  }, [state.auth.user?.uid, pushNotification, dispatch]);

  return (
    <MusicContext.Provider value={value}>
      {children}
    </MusicContext.Provider>
  );
}

// ì»¤ìŠ¤í…€ í›…
export function useMusicContext() {
  const context = useContext(MusicContext);
  if (!context) {
    throw new Error('useMusicContext must be used within a MusicContextProvider');
  }
  return context;
}

export { actionTypes };
</file>

<file path="src/lib/magentaCompat.js">
// src/lib/magentaCompat.js

let _mmPromise = null;

export async function loadMagenta() {
  if (!_mmPromise) {

    _mmPromise = import('@magenta/music/es6');
  }
  return _mmPromise;
}
</file>

<file path="src/pages/Auth.js">
import React, { useMemo, useState, useEffect } from 'react';
import {
  Box,
  Button,
  Container,
  Paper,
  Stack,
  Tab,
  Tabs,
  TextField,
  Typography,
  Alert,
} from '@mui/material';
import { useNavigate, useLocation } from 'react-router-dom';

import { useMusicContext } from '../context/MusicContext';

const colors = {
  background: '#050505',
  backgroundSoft: '#060708',
  cardBg: '#101416',
  accent: '#2DD4BF',
  accentDark: '#1AA38E',
  border: '#1F2A2E',
  text: '#FFFFFF',
  textMuted: '#8FA3B5',
};

function TabPanel({ value, index, children }) {
  if (value !== index) return null;
  return (
    <Box sx={{ mt: 3 }}>
      {children}
    </Box>
  );
}

export default function AuthPage() {
  const navigate = useNavigate();
  const location = useLocation();
  const { state, actions } = useMusicContext();
  const authState = state.auth;
  const isLoading = authState.status === 'loading';
  const [tab, setTab] = useState(0);
  const [signUpForm, setSignUpForm] = useState({ displayName: '', email: '', password: '' });
  const [loginForm, setLoginForm] = useState({ email: '', password: '' });
  const [localError, setLocalError] = useState('');
  const textFieldStyles = useMemo(
    () => ({
      '& .MuiOutlinedInput-root': {
        bgcolor: '#12181B',
        borderRadius: 2,
        color: colors.text,
        transition: 'border-color 0.2s ease, box-shadow 0.2s ease',
        '& input': { color: colors.text },
        '& fieldset': { borderColor: colors.border },
        '&:hover fieldset': { borderColor: colors.accent },
        '&.Mui-focused fieldset': { borderColor: colors.accent },
      },
      '& .MuiInputLabel-root': { color: colors.textMuted },
      '& .MuiInputLabel-root.Mui-focused': { color: colors.accent },
    }),
    []
  );

  const gradient = useMemo(
    () =>
      [
        'radial-gradient(55% 60% at 20% 20%, rgba(45,212,191,0.18), rgba(4,8,8,0) 70%)',
        'radial-gradient(45% 55% at 80% 15%, rgba(32,178,170,0.1), rgba(0,0,0,0) 72%)',
        'linear-gradient(145deg, #050505 0%, #040606 45%, #000000 100%)',
      ].join(', '),
    []
  );

  useEffect(() => {
    if (authState.user) {
      navigate('/library', { replace: true });
    }
  }, [authState.user, navigate]);

  const handleSignUp = async (e) => {
    e.preventDefault();
    setLocalError('');
    const { email, password, displayName } = signUpForm;
    if (!email || !password || !displayName) {
      setLocalError('ì´ë¦„, ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    try {
      await actions.signUpWithEmail({ email, password, displayName });
    } catch (error) {
      // ì´ë¯¸ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ì§€ë§Œ, í¼ì—ì„œë„ ì•ˆë‚´ ìœ ì§€
      setLocalError(error?.message || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆì–´ìš”.');
    }
  };

  const handleLogin = async (e) => {
    e.preventDefault();
    setLocalError('');
    const { email, password } = loginForm;
    if (!email || !password) {
      setLocalError('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    try {
      await actions.signInWithEmail({ email, password });
    } catch (error) {
      setLocalError(error?.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆì–´ìš”.');
    }
  };

  const redirectFrom = location.state?.from;
  const errorMessage = localError || authState.error;

  return (
    <Box
      sx={{
        minHeight: '100vh',
        position: 'relative',
        bgcolor: colors.background,
        display: 'flex',
        alignItems: 'center',
        py: { xs: 6, md: 10 },
        backgroundImage: gradient,
        '&::after': {
          content: '""',
          position: 'absolute',
          inset: 0,
          background: 'radial-gradient(50% 35% at 60% 95%, rgba(45,212,191,0.1), rgba(0,0,0,0) 75%)',
          pointerEvents: 'none',
        },
      }}
    >
      <Container maxWidth="sm">
        <Paper
          elevation={10}
          sx={{
            position: 'relative',
            bgcolor: colors.cardBg,
            color: colors.text,
            borderRadius: 4,
            border: `1px solid ${colors.border}`,
            boxShadow: `0 25px 55px rgba(0,0,0,0.6), 0 0 35px rgba(45,212,191,0.18)`,
            overflow: 'hidden',
          }}
        >
          <Box sx={{ p: { xs: 4, md: 6 } }}>
            <Typography variant="h4" sx={{ fontWeight: 700, textAlign: 'center', mb: 1 }}>
              AI MUSE
            </Typography>
            <Typography sx={{ color: colors.textMuted, textAlign: 'center', mb: 4 }}>
              ë‚˜ë§Œì˜ ìŒì•…ì„ ì €ì¥í•˜ê³  ê³µìœ í•˜ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.
            </Typography>

            <Tabs
              value={tab}
              onChange={(_, value) => {
                setTab(value);
                setLocalError('');
              }}
              variant="fullWidth"
              textColor="inherit"
              TabIndicatorProps={{ style: { backgroundColor: colors.accent } }}
              sx={{
                '& .MuiTab-root': {
                  color: colors.textMuted,
                  fontWeight: 600,
                  textTransform: 'none',
                },
                '& .Mui-selected': {
                  color: colors.text,
                },
              }}
            >
              <Tab label="ë¡œê·¸ì¸" />
              <Tab label="íšŒì›ê°€ì…" />
            </Tabs>

            {redirectFrom && !authState.user && (
              <Alert
                severity="info"
                sx={{
                  mt: 3,
                  bgcolor: 'rgba(45,212,191,0.12)',
                  color: colors.accent,
                  borderRadius: 2,
                  border: '1px solid rgba(45,212,191,0.35)',
                  fontWeight: 500,
                }}
              >
                {redirectFrom === '/library'
                  ? 'ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆì–´ìš”.'
                  : 'ì´ í˜ì´ì§€ëŠ” ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆì–´ìš”.'}
              </Alert>
            )}

            {errorMessage && (
              <Alert
                severity="error"
                sx={{
                  mt: 3,
                  bgcolor: 'rgba(239,68,68,0.12)',
                  color: '#FCA5A5',
                  borderRadius: 2,
                  border: '1px solid rgba(239,68,68,0.35)',
                }}
              >
                {errorMessage}
              </Alert>
            )}

            <TabPanel value={tab} index={0}>
              <Box component="form" onSubmit={handleLogin} noValidate>
                <Stack spacing={3}>
                  <TextField
                    label="ì´ë©”ì¼"
                    type="email"
                    fullWidth
                    value={loginForm.email}
                    onChange={(e) => setLoginForm((prev) => ({ ...prev, email: e.target.value }))}
                    sx={textFieldStyles}
                  />
                  <TextField
                    label="ë¹„ë°€ë²ˆí˜¸"
                    type="password"
                    fullWidth
                    value={loginForm.password}
                    onChange={(e) => setLoginForm((prev) => ({ ...prev, password: e.target.value }))}
                    sx={textFieldStyles}
                  />
                  <Button
                    type="submit"
                    fullWidth
                    size="large"
                    disabled={isLoading}
                    sx={{
                      mt: 1,
                      py: 1.5,
                      fontWeight: 700,
                      borderRadius: 999,
                      bgcolor: colors.accent,
                      color: '#041311',
                      '&:hover': {
                        bgcolor: colors.accentDark,
                      },
                      '&:disabled': {
                        bgcolor: '#1f3a36',
                        color: '#6fbfb0',
                      },
                    }}
                  >
                    {isLoading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'ë¡œê·¸ì¸'}
                  </Button>
                </Stack>
              </Box>
            </TabPanel>

            <TabPanel value={tab} index={1}>
              <Box component="form" onSubmit={handleSignUp} noValidate>
                <Stack spacing={3}>
                  <TextField
                    label="ë‹‰ë„¤ì„"
                    fullWidth
                    value={signUpForm.displayName}
                    onChange={(e) => setSignUpForm((prev) => ({ ...prev, displayName: e.target.value }))}
                    sx={textFieldStyles}
                  />
                  <TextField
                    label="ì´ë©”ì¼"
                    type="email"
                    fullWidth
                    value={signUpForm.email}
                    onChange={(e) => setSignUpForm((prev) => ({ ...prev, email: e.target.value }))}
                    sx={textFieldStyles}
                  />
                  <TextField
                    label="ë¹„ë°€ë²ˆí˜¸"
                    type="password"
                    fullWidth
                    value={signUpForm.password}
                    onChange={(e) => setSignUpForm((prev) => ({ ...prev, password: e.target.value }))}
                    sx={textFieldStyles}
                  />
                  <Typography variant="caption" sx={{ color: colors.textMuted }}>
                    ìµœì†Œ 6ì ì´ìƒì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
                  </Typography>
                  <Button
                    type="submit"
                    fullWidth
                    size="large"
                    disabled={isLoading}
                    sx={{
                      mt: 1,
                      py: 1.5,
                      fontWeight: 700,
                      borderRadius: 999,
                      bgcolor: colors.accent,
                      color: '#041311',
                      '&:hover': {
                        bgcolor: colors.accentDark,
                      },
                      '&:disabled': {
                        bgcolor: '#1f3a36',
                        color: '#6fbfb0',
                      },
                    }}
                  >
                    {isLoading ? 'ê°€ì… ì¤‘...' : 'íšŒì›ê°€ì…'}
                  </Button>
                </Stack>
              </Box>
            </TabPanel>

            <Typography sx={{ mt: 6, fontSize: 12, color: colors.textMuted, textAlign: 'center' }}>
              ìŒì•… ìƒì„± ê¸°ëŠ¥ì€ ë¡œê·¸ì¸ ì—†ì´ë„ ì²´í—˜í•  ìˆ˜ ìˆì§€ë§Œ, ì €ì¥ê³¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê¸°ëŠ¥ì€ ê³„ì •ì´ í•„ìš”í•´ìš”.
            </Typography>
          </Box>
        </Paper>
      </Container>
    </Box>
  );
}
</file>

<file path="src/pages/MusicConversion.js">
// src/pages/MusicConversion.js
import React, { useEffect, useRef, useState } from 'react';
import { Box, Container, Grid, Paper, Typography } from '@mui/material';
import MusicNote from '@mui/icons-material/MusicNote';
import { useNavigate } from 'react-router-dom';

import TransportBar from '../components/beat/TransportBar';
import BeatGrid from '../components/beat/BeatGrid';
import BlendPad from '../components/beat/BlendPad';
import { createKit } from '../components/beat/SampleKit';
import { PRESETS, clonePattern, TRACKS } from '../components/beat/presets';
import { downloadBlob } from '../utils/audioExport';
import { getTone, ensureAudioStart } from '../lib/toneCompat';

const colors = {
  background: '#0A0A0A',
  cardBg: '#1A1A1A',
  primary: '#50E3C2',
  accent: '#2DD4BF',
  text: '#FFFFFF',
  textLight: '#CCCCCC',
  border: '#333333',
  shadow: 'rgba(80,227,194,0.35)',
};

const STEPS = 16;

export default function MusicConversion() {
  const [bpm, setBpm] = useState(96);
  const [measures, setMeasures] = useState(2);
  const [currentStep, setCurrentStep] = useState(0);

  // ì´ˆê¸° íŒ¨í„´: Rock 1
  const [pattern, setPattern] = useState(clonePattern(PRESETS['Rock 1']));
  const [corners, setCorners] = useState({
    A: PRESETS['Rock 1'],
    B: PRESETS['Pop Punk'],
    C: PRESETS['Reggaeton'],
    D: PRESETS['Samba Full Time'],
  });

  const kitRef = useRef(null);
  const synthReadyRef = useRef(false);

  // Tone.js ë¡œ ìƒ˜í”Œ ë¡œë”©
  useEffect(() => {
    let mounted = true;
    (async () => {
      const Tone = await getTone();
      await ensureAudioStart(Tone);
      kitRef.current = await createKit(Tone);
      synthReadyRef.current = true;
    })();
    return () => {
      mounted = false;
    };
  }, []);

  const handleToggle = (rowName, stepIdx) => {
    setPattern((prev) => {
      const next = { ...prev, [rowName]: [...prev[rowName]] };
      next[rowName][stepIdx] = !next[rowName][stepIdx];
      return next;
    });
  };

  // BlendPadì—ì„œ ìƒˆ íŒ¨í„´ì´ ì˜¤ë©´ ê·¸ë¦¬ë“œ êµì²´
  const handleBlend = (newPattern) => {
    setPattern(newPattern);
  };

  return (
    <Box sx={{ minHeight: '100vh', bgcolor: colors.background, pt: 4 }}>
      <Container maxWidth="lg">
        <Typography variant="h4" sx={{ color: colors.text, fontWeight: 800, mb: 2 }}>
          <MusicNote sx={{ mr: 1, verticalAlign: 'middle', color: colors.accent }} />
          ë¹„íŠ¸ ë§Œë“¤ê¸°
        </Typography>

        <Grid container spacing={3}>
          {/* ì™¼ìª½: íŒ¨ë“œ */}
          <Grid item xs={12} md={6}>
            <Paper sx={{ p: 2, bgcolor: colors.cardBg, border: `1px solid ${colors.border}` }}>
              <BlendPad
                colors={colors}
                corners={corners}
                onChangeCorners={setCorners}
                onBlend={handleBlend}
              />
            </Paper>
          </Grid>

          {/* ì˜¤ë¥¸ìª½: ê·¸ë¦¬ë“œ */}
          <Grid item xs={12} md={6}>
            <Paper sx={{ p: 2, bgcolor: colors.cardBg, border: `1px solid ${colors.border}` }}>
              <BeatGrid pattern={pattern} currentStep={currentStep} onToggle={handleToggle} />
            </Paper>
          </Grid>
        </Grid>
      </Container>
    </Box>
  );
}
</file>

<file path="src/pages/ResultPage.js">
import React, { useState, useEffect, useRef } from 'react';
import {
  Container, Box, Typography, Paper, Button, Grid, Chip, Alert, IconButton, Slider
} from '@mui/material';
import {
  CheckCircle, PlayArrow, Pause, Download, Refresh, Share, Home, LibraryMusic, VolumeUp, BookmarkBorder
} from '@mui/icons-material';
import { useNavigate } from 'react-router-dom';

import { useMusicContext } from '../context/MusicContext';
import { GENRE_OPTIONS } from '../components/common/GenreSelector';
import { MOOD_OPTIONS } from '../components/common/MoodSelector';
import AudioWaveform from '../components/common/AudioWaveform';

const ResultPage = () => {
  const navigate = useNavigate();
  const { state, actions } = useMusicContext();

  // ë””ë²„ê¹…: í˜„ì¬ ìƒíƒœ í™•ì¸
  console.log('=== ResultPage ë””ë²„ê¹… ===');
  console.log('ì „ì²´ state:', state);
  console.log('state.result:', state.result);
  console.log('state.generation:', state.generation);
  console.log('=== ResultPage ìƒì„¸ ë””ë²„ê¹… ===');
  console.log('ì „ì²´ state:', JSON.stringify(state, null, 2));
  if (state.result) {
    console.log('state.result í‚¤ë“¤:', Object.keys(state.result));
    console.log('state.result.convertedMusic:', state.result.convertedMusic);
    console.log('state.result.generatedMusic:', state.result.generatedMusic);
  }
  
  if (state.generation) {
    console.log('state.generation í‚¤ë“¤:', Object.keys(state.generation));
    console.log('state.generation.generatedMusic:', state.generation.generatedMusic);
  }
  
  console.log('actions.setResult í•¨ìˆ˜:', typeof actions.setResult);
  console.log('================================');

  // ì˜¤ë””ì˜¤ ì œì–´ìš©
  const audioRef = useRef(null);
  const [isPlaying, setIsPlaying] = useState(false);
  const [currentTime, setCurrentTime] = useState(0);
  const [duration, setDuration] = useState(180);
  const [volume, setVolume] = useState(70);

  // ê²°ê³¼ ë°ì´í„° (result > generation ìˆœìœ¼ë¡œ ì¡°íšŒ)
  const generatedFromResult = state.result?.generatedMusic;
  const convertedFromResult = state.result?.convertedMusic;
  const generatedFromGeneration = state.generation?.generatedMusic;

  console.log('generatedFromResult:', generatedFromResult);
  console.log('convertedFromResult:', convertedFromResult);
  console.log('generatedFromGeneration:', generatedFromGeneration);

  // localStorage í™•ì¸ ì¶”ê°€
  const musicData =
    generatedFromResult ||
    convertedFromResult ||
    generatedFromGeneration ||
    (() => {
      const stored = localStorage.getItem('scoreGeneratedMusic');
      if (stored) {
        console.log('localStorageì—ì„œ ìŒì•… ë°ì´í„° ë¡œë“œ:', JSON.parse(stored));
        // ì‚¬ìš© í›„ ì‚­ì œ
        localStorage.removeItem('scoreGeneratedMusic');
        return JSON.parse(stored);
      }
      return null;
    })();

  console.log('ìµœì¢… musicData:', musicData);

  const audioUrl = musicData?.audioUrl || '';
  const isConversion = !!(state.result?.convertedMusic);

  // ìƒ‰ìƒ í…Œë§ˆ(ì›ë³¸ ìœ ì§€)
  const colors = {
    background: '#0A0A0A', cardBg: '#1A1A1A', primary: '#50E3C2',
    secondary: '#40D9B8', accent: '#2DD4BF', text: '#FFFFFF',
    textLight: '#CCCCCC', border: '#333333', shadow: 'rgba(80, 227, 194, 0.3)'
  };

  // ------- í›…ì€ í•­ìƒ í˜¸ì¶œë˜ë„ë¡! (ì¡°ê±´ë¶€ í˜¸ì¶œ ê¸ˆì§€) -------

  // ì˜¤ë””ì˜¤ ì´ë²¤íŠ¸ ì—°ê²° + ì†ŒìŠ¤ ë³€ê²½
  useEffect(() => {
    const audio = audioRef.current;
    if (!audio) return;

    audio.src = audioUrl || '';
    const onLoadedMetadata = () => {
      setDuration(isFinite(audio.duration) ? audio.duration : 180);
    };
    const onTimeUpdate = () => setCurrentTime(audio.currentTime || 0);
    const onEnded = () => setIsPlaying(false);

    audio.addEventListener('loadedmetadata', onLoadedMetadata);
    audio.addEventListener('timeupdate', onTimeUpdate);
    audio.addEventListener('ended', onEnded);

    return () => {
      audio.removeEventListener('loadedmetadata', onLoadedMetadata);
      audio.removeEventListener('timeupdate', onTimeUpdate);
      audio.removeEventListener('ended', onEnded);
    };
  }, [audioUrl]);

  // ë³¼ë¥¨ ë°˜ì˜
  useEffect(() => {
    if (audioRef.current) audioRef.current.volume = volume / 100;
  }, [volume]);

  // -----------------------------------------------------

  const getGenreInfo = (genreId) =>
    GENRE_OPTIONS.find((g) => g.id === genreId) || { label: genreId, color: '#6366F1' };

  const getMoodInfo = (moodId) =>
    MOOD_OPTIONS.find((m) => m.id === moodId) || { label: moodId, emoji: 'ğŸµ' };

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  const handlePlayPause = async () => {
    const audio = audioRef.current;
    if (!audio || !audioUrl) return;

    if (!isPlaying) {
      try {
        await audio.play();
        setIsPlaying(true);
        actions.setPlaying?.(true);
      } catch {
        actions.addNotification?.({
          type: 'info',
          message: 'ë¸Œë¼ìš°ì € ìë™ì¬ìƒì´ ì°¨ë‹¨ë˜ë©´ ìˆ˜ë™ìœ¼ë¡œ ì¬ìƒí•´ì•¼ í•©ë‹ˆë‹¤.'
        });
      }
    } else {
      audio.pause();
      setIsPlaying(false);
      actions.setPlaying?.(false);
    }
  };

  const handleTimeChange = (e, newValue) => {
    setCurrentTime(newValue);
    if (audioRef.current) audioRef.current.currentTime = newValue;
    actions.updateCurrentTime?.(newValue);
  };

  const handleVolumeChange = (e, newValue) => setVolume(newValue);

  const handleDownload = () => {
    try {
      const a = document.createElement('a');
      a.href = audioUrl;
      a.download = (musicData.title || 'music') + '.mp3';
      document.body.appendChild(a);
      a.click();
      a.remove();
      actions.addNotification?.({ type: 'success', message: 'ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.' });
    } catch {
      actions.addNotification?.({ type: 'error', message: 'ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' });
    }
  };

  const handleShare = () =>
    actions.addNotification?.({ type: 'info', message: 'ê³µìœ  ê¸°ëŠ¥ì€ ì¶”í›„ ì—…ë°ì´íŠ¸ë  ì˜ˆì •ì…ë‹ˆë‹¤.' });

  const handleSaveToLibrary = () => {
    actions.addToLibrary?.(musicData);
    actions.addNotification?.({ type: 'success', message: 'ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.' });
  };

  const handleRegenerate = () => {
    if (state.result?.generatedMusic || state.generation?.generatedMusic) navigate('/generate');
    else navigate('/convert');
  };

  const hasMusic = !!(musicData && audioUrl);

  console.log('audioUrl:', audioUrl);
  console.log('hasMusic:', hasMusic);
  console.log('=====================');

  return (
    <Box sx={{ minHeight: '100vh', bgcolor: colors.background }}>
      <Container maxWidth="lg" sx={{ py: 6 }}>
        {!hasMusic ? (
          // ===== fallback (ì´ì „ì˜ early returnì„ JSXë¡œ ì´ë™) =====
          <Box sx={{ textAlign: 'center' }}>
            <Alert severity="warning" sx={{ mb: 3 }}>
              í‘œì‹œí•  ìŒì•… ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
            </Alert>
            <Button variant="contained" onClick={() => navigate('/')} startIcon={<Home />}>
              í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </Button>
          </Box>
        ) : (
          // ================= ì •ìƒ ê²°ê³¼ í™”ë©´ (ë””ìì¸ ìœ ì§€) =================
          <>
            {/* í—¤ë” */}
            <Box sx={{ mb: 6, textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: '4rem', color: colors.accent, mb: 2 }} />
              <Typography variant="h3" component="h1" sx={{ fontWeight: 600, color: colors.text, mb: 1, letterSpacing: '-0.02em' }}>
                {isConversion ? 'ìŒì•… ë³€í™˜ ì™„ë£Œ' : 'ìŒì•… ìƒì„± ì™„ë£Œ'}
              </Typography>
              <Typography variant="h6" color={colors.textLight} sx={{ fontWeight: 400, opacity: 0.8 }}>
                {isConversion ? 'ìŒì•…ì´ ì„±ê³µì ìœ¼ë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤' : 'ìƒˆë¡œìš´ ìŒì•…ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤'}
              </Typography>
            </Box>

            <Grid container spacing={4}>
              {/* ë©”ì¸ ì»¨í…ì¸  */}
              <Grid xs={12} lg={9}>
                {/* í”Œë ˆì´ì–´ ì¹´ë“œ */}
                <Paper elevation={0} sx={{ p: 4, border: `1px solid ${colors.border}`, borderRadius: 2, mb: 3, bgcolor: colors.cardBg, color: colors.text }}>
                  <Box sx={{ mb: 3 }}>
                    <Typography variant="h4" fontWeight={600} sx={{ mb: 1, color: colors.text }}>
                      {musicData.title}
                    </Typography>
                    <Typography variant="body1" sx={{ opacity: 0.8, color: colors.textLight }}>
                      {isConversion
                        ? `${musicData.originalFile}ì„(ë¥¼) ${musicData.targetGenre} ìŠ¤íƒ€ì¼ë¡œ ë³€í™˜í–ˆìŠµë‹ˆë‹¤.`
                        : 'ìŒì•…ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.'}
                    </Typography>
                  </Box>

                  {/* ì›¨ì´ë¸Œí¼ */}
                  <Box sx={{ mb: 3 }}>
                    <AudioWaveform
                      isPlaying={isPlaying}
                      progress={(currentTime / duration) * 100}
                      height={100}
                      barCount={80}
                      color={colors.accent}
                    />
                  </Box>

                  {/* ì¬ìƒ ì»¨íŠ¸ë¡¤ */}
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 3 }}>
                    <IconButton
                      onClick={handlePlayPause}
                      sx={{ bgcolor: colors.accent, color: colors.background, '&:hover': { bgcolor: colors.text } }}
                      size="large"
                    >
                      {isPlaying ? <Pause /> : <PlayArrow />}
                    </IconButton>

                    <Box sx={{ flexGrow: 1 }}>
                      <Slider
                        value={currentTime}
                        onChange={handleTimeChange}
                        min={0}
                        max={duration}
                        sx={{
                          color: colors.accent,
                          '& .MuiSlider-track': { bgcolor: colors.accent },
                          '& .MuiSlider-thumb': {
                            bgcolor: colors.accent,
                            '&:hover': { boxShadow: `0px 0px 0px 8px ${colors.shadow}` }
                          }
                        }}
                      />
                      <Box sx={{ display: 'flex', justifyContent: 'space-between', mt: 0.5 }}>
                        <Typography variant="caption" sx={{ opacity: 0.8, color: colors.textLight }}>
                          {formatTime(currentTime)}
                        </Typography>
                        <Typography variant="caption" sx={{ opacity: 0.8, color: colors.textLight }}>
                          {formatTime(duration)}
                        </Typography>
                      </Box>
                    </Box>

                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, minWidth: 100 }}>
                      <VolumeUp sx={{ opacity: 0.8, color: colors.textLight }} />
                      <Slider
                        value={volume}
                        onChange={handleVolumeChange}
                        min={0}
                        max={100}
                        size="small"
                        sx={{
                          color: colors.accent,
                          '& .MuiSlider-track': { bgcolor: colors.accent },
                          '& .MuiSlider-thumb': { bgcolor: colors.accent }
                        }}
                      />
                    </Box>
                  </Box>

                  {/* ì‹¤ì œ ì˜¤ë””ì˜¤ (ìˆ¨ê¹€) */}
                  <audio ref={audioRef} src={audioUrl} preload="auto" style={{ display: 'none' }} />
                </Paper>

                {/* ì •ë³´ ì¹´ë“œ */}
                <Paper elevation={0} sx={{ p: 4, border: `1px solid ${colors.border}`, borderRadius: 2, bgcolor: colors.cardBg }}>
                  <Typography variant="h6" fontWeight={600} sx={{ mb: 3, color: colors.text }}>
                    {isConversion ? 'ë³€í™˜ ì •ë³´' : 'ìŒì•… ì •ë³´'}
                  </Typography>

                  <Grid container spacing={3}>
                    <Grid xs={12} sm={6}>
                      <Typography variant="subtitle2" sx={{ mb: 1, color: colors.textLight }}>
                        {isConversion ? 'ë³€í™˜ëœ ì¥ë¥´' : 'ì¥ë¥´'}
                      </Typography>
                      <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1 }}>
                        {(musicData.genres || [musicData.targetGenre]).filter(Boolean).map((genreId) => {
                          const genre = getGenreInfo(genreId);
                          return (
                            <Chip
                              key={genreId}
                              label={genre.label}
                              size="small"
                              sx={{
                                bgcolor: colors.cardBg,
                                color: colors.primary,
                                border: `1px solid ${colors.primary}`,
                                fontWeight: 600
                              }}
                            />
                          );
                        })}
                      </Box>
                    </Grid>

                    {isConversion && musicData.intensity && (
                      <Grid xs={12} sm={6}>
                        <Typography variant="subtitle2" sx={{ mb: 1, color: colors.textLight }}>
                          ë³€í™˜ ê°•ë„
                        </Typography>
                        <Typography variant="body2" color={colors.text}>
                          {musicData.intensity}/5
                        </Typography>
                      </Grid>
                    )}

                    {!isConversion && musicData.moods && musicData.moods.length > 0 && (
                      <Grid xs={12} sm={6}>
                        <Typography variant="subtitle2" sx={{ mb: 1, color: colors.textLight }}>
                          ë¶„ìœ„ê¸°
                        </Typography>
                        <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1 }}>
                          {musicData.moods.map((moodId) => {
                            const mood = getMoodInfo(moodId);
                            return (
                              <Chip
                                key={moodId}
                                label={`${mood.emoji} ${mood.label}`}
                                size="small"
                                sx={{
                                  bgcolor: colors.cardBg,
                                  color: colors.primary,
                                  border: `1px solid ${colors.primary}`,
                                  fontWeight: 600
                                }}
                              />
                            );
                          })}
                        </Box>
                      </Grid>
                    )}

                    <Grid xs={12} sm={6}>
                      <Typography variant="subtitle2" sx={{ mb: 1, color: colors.textLight }}>
                        ê¸¸ì´
                      </Typography>
                      <Typography variant="body2" color={colors.text}>
                        {formatTime(musicData.duration || duration)}
                      </Typography>
                    </Grid>

                    <Grid xs={12} sm={6}>
                      <Typography variant="subtitle2" sx={{ mb: 1, color: colors.textLight }}>
                        ìƒì„± ì‹œê°„
                      </Typography>
                      <Typography variant="body2" color={colors.text}>
                        {new Date(musicData.createdAt).toLocaleString('ko-KR')}
                      </Typography>
                    </Grid>
                  </Grid>
                </Paper>
              </Grid>

              {/* ì‚¬ì´ë“œë°” */}
              <Grid xs={12} lg={3}>
                <Box sx={{ position: 'sticky', top: 24 }}>
                  <Paper elevation={0} sx={{ p: 4, border: `1px solid ${colors.border}`, borderRadius: 2, bgcolor: colors.cardBg, minHeight: '600px', display: 'flex', flexDirection: 'column' }}>
                    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 3, flex: 1 }}>
                      <Button fullWidth variant="contained" startIcon={<BookmarkBorder />} onClick={handleSaveToLibrary}
                        sx={{ bgcolor: colors.accent, color: colors.background, fontWeight: 600, textTransform: 'none', py: 2, '&:hover': { bgcolor: colors.text } }}>
                        ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì €ì¥
                      </Button>

                      <Button fullWidth variant="outlined" startIcon={<Download />} onClick={handleDownload}
                        sx={{ color: colors.text, borderColor: colors.border, fontWeight: 600, textTransform: 'none', py: 2, '&:hover': { bgcolor: colors.accent, borderColor: colors.accent, color: colors.background } }}>
                        ë‹¤ìš´ë¡œë“œ
                      </Button>

                      <Button fullWidth variant="outlined" startIcon={<Share />} onClick={handleShare}
                        sx={{ color: colors.text, borderColor: colors.border, fontWeight: 600, textTransform: 'none', py: 2, '&:hover': { bgcolor: colors.accent, borderColor: colors.accent, color: colors.background } }}>
                        ê³µìœ í•˜ê¸°
                      </Button>

                      <Button fullWidth variant="outlined" startIcon={<Refresh />} onClick={handleRegenerate}
                        sx={{ color: colors.text, borderColor: colors.border, fontWeight: 600, textTransform: 'none', py: 2, '&:hover': { bgcolor: colors.accent, borderColor: colors.accent, color: colors.background } }}>
                        ë‹¤ì‹œ {isConversion ? 'ë³€í™˜' : 'ìƒì„±'}í•˜ê¸°
                      </Button>

                      <Button fullWidth variant="outlined" startIcon={<LibraryMusic />} onClick={() => navigate('/library')}
                        sx={{ color: colors.text, borderColor: colors.border, fontWeight: 600, textTransform: 'none', py: 2, '&:hover': { bgcolor: colors.accent, borderColor: colors.accent, color: colors.background } }}>
                        ë¼ì´ë¸ŒëŸ¬ë¦¬ ë³´ê¸°
                      </Button>

                      <Button fullWidth variant="outlined" startIcon={<Home />} onClick={() => navigate('/')}
                        sx={{ color: colors.text, borderColor: colors.border, fontWeight: 600, textTransform: 'none', py: 2, '&:hover': { bgcolor: colors.accent, borderColor: colors.accent, color: colors.background } }}>
                        í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                      </Button>
                    </Box>
                  </Paper>
                </Box>
              </Grid>
            </Grid>
          </>
        )}
      </Container>
    </Box>
  );
};

export default ResultPage;
</file>

<file path="src/pages/ScoreToMusic.js">
// musicgen-app-main/src/pages/ScoreToMusic.js

import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useMusicContext } from '../context/MusicContext';
import {
    Typography,
    Button,
    CircularProgress,
    Box,
    MenuItem,
    Select,
    FormControl,
    InputLabel
} from '@mui/material';
import UploadFileIcon from '@mui/icons-material/UploadFile';

const ScoreToMusic = () => {
    const [pdfFile, setPdfFile] = useState(null);
    const [isLoading, setIsLoading] = useState(false);
    const [fileName, setFileName] = useState('');
    const [format, setFormat] = useState('midi'); // ë³€í™˜ í˜•ì‹ ìƒíƒœ
    const navigate = useNavigate();
    
    const { actions } = useMusicContext();

    const handleFileChange = (event) => {
        const file = event.target.files[0];
        if (file && file.type === "application/pdf") {
            setPdfFile(file);
            setFileName(file.name);
        } else {
            alert("PDF íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            setPdfFile(null);
            setFileName('');
        }
    };

    const handleFormatChange = (event) => {
        setFormat(event.target.value);
    };

    // ì‘ì—… ìƒíƒœ í´ë§
    const pollTaskStatus = async (taskId) => {
        const maxAttempts = 60;
        let attempts = 0;

        while (attempts < maxAttempts) {
            try {
                const response = await fetch(`http://127.0.0.1:5000/api/music/task/status?taskId=${taskId}`);
                if (!response.ok) throw new Error('ì‘ì—… ìƒíƒœ í™•ì¸ ì‹¤íŒ¨');

                const statusData = await response.json();
                console.log('ì‘ì—… ìƒíƒœ:', statusData);
                
                if (statusData.status === 'succeeded') {
                    const musicData = {
                        id: statusData.result?.id || `score_${Date.now()}`,
                        title: statusData.result?.title || `ì•…ë³´ ê¸°ë°˜ ìƒì„± ìŒì•…`,
                        audioUrl: statusData.audioUrl || statusData.result?.audioUrl,
                        genres: statusData.result?.genres || ['Classical'],
                        moods: statusData.result?.moods || [],
                        duration: statusData.result?.duration || 180,
                        createdAt: statusData.result?.createdAt || new Date().toISOString(),
                        type: 'score-generated',
                        originalFile: fileName,
                        targetGenre: 'Classical',
                        format: format
                    };

                    console.log('ìƒì„±ëœ musicData:', musicData);

                    if (actions.setResult) actions.setResult({ convertedMusic: musicData });
                    localStorage.setItem('scoreGeneratedMusic', JSON.stringify(musicData));

                    return true;
                } else if (statusData.status === 'failed') {
                    throw new Error(statusData.error || 'ìŒì•… ìƒì„± ì‹¤íŒ¨');
                } else if (statusData.status === 'running' || statusData.status === 'queued') {
                    console.log(`ì‘ì—… ì§„í–‰ì¤‘... (${attempts + 1}/${maxAttempts})`);
                    await new Promise(resolve => setTimeout(resolve, 5000));
                    attempts++;
                } else {
                    throw new Error(`ì•Œ ìˆ˜ ì—†ëŠ” ì‘ì—… ìƒíƒœ: ${statusData.status}`);
                }
            } catch (error) {
                console.error('ì‘ì—… ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                throw error;
            }
        }
        throw new Error('ì‘ì—… ì‹œê°„ ì´ˆê³¼ (30ë¶„)');
    };

    const handleSubmit = async () => {
    if (!pdfFile) {
        alert("ì•…ë³´ PDF íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
        return;
    }

    setIsLoading(true);
    const formData = new FormData();
    formData.append('score', pdfFile);
    formData.append('format', format); // ì„ íƒëœ ë³€í™˜ í˜•ì‹ ì „ì†¡

    try {
        console.log('=== ì•…ë³´ ì²˜ë¦¬ ì‹œì‘ ===');
        const response = await fetch('http://127.0.0.1:5000/api/process-score', {
            method: 'POST',
            body: formData,
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || 'ìŒì•… ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }

        const data = await response.json();
        console.log('ì„œë²„ ì‘ë‹µ:', data);

        const taskId = data.taskId;
        if (!taskId) throw new Error('ì‘ì—… IDë¥¼ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

        await pollTaskStatus(taskId);

        // âœ… navigateë¥¼ ë¨¼ì € ì‹¤í–‰ (setIsLoadingë³´ë‹¤ ìš°ì„ )
        navigate('/result');

    } catch (error) {
        console.error("Error generating music from score:", error);
        alert(`ìŒì•… ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
    } finally {
        // âœ… navigate í›„ 1ì´ˆ ë’¤ ìƒíƒœ í•´ì œ (ì•ˆì •ì„± í™•ë³´)
        setTimeout(() => setIsLoading(false), 1000);
    }
};


    return (
        <Box
            sx={{
                width: '100%',
                minHeight: '100vh',
                bgcolor: '#000',
                display: 'flex',
                justifyContent: 'center',
                alignItems: 'flex-start',
                pt: 8,
                pb: 4,
            }}
        >
            <Box
                sx={{
                    width: { xs: '90%', sm: '600px' },
                    bgcolor: '#1A1A1A',
                    borderRadius: 3,
                    p: { xs: 3, sm: 4 },
                    textAlign: 'center',
                    boxShadow: '0 0 20px rgba(80, 227, 194, 0.2)',
                    color: '#FFF'
                }}
            >
                <Typography variant="h4" gutterBottom>
                    ì•…ë³´ ì—°ì£¼í•˜ê¸°
                </Typography>
                <Typography variant="body1" sx={{ mb: 4, color: '#CCC' }}>
                    PDF ì•…ë³´ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ AIê°€ ë¶„ì„í•˜ì—¬ ìŒì•…ì„ ì—°ì£¼í•´ì¤ë‹ˆë‹¤.
                </Typography>

                {/* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ */}
                <Box
                    sx={{
                        border: '2px dashed #555',
                        borderRadius: '10px',
                        p: 4,
                        mb: 3,
                        cursor: 'pointer',
                        bgcolor: '#0a0a0a',
                        '&:hover': {
                            borderColor: '#50E3C2',
                            bgcolor: '#111'
                        }
                    }}
                    onClick={() => document.getElementById('pdf-upload').click()}
                >
                    <UploadFileIcon sx={{ fontSize: 60, color: '#777' }} />
                    <Typography sx={{ color: '#CCC', mt: 1 }}>
                        {fileName || 'í´ë¦­í•˜ì—¬ PDF íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”'}
                    </Typography>
                    <input
                        type="file"
                        id="pdf-upload"
                        hidden
                        accept="application/pdf"
                        onChange={handleFileChange}
                    />
                </Box>

                {/* ë³€í™˜ í˜•ì‹ ì„ íƒ */}
                <FormControl
                    fullWidth
                    sx={{ mb: 3, bgcolor: '#0a0a0a', borderRadius: 1 }}
                >
                    <InputLabel sx={{ color: '#CCC' }}>ë³€í™˜ í˜•ì‹</InputLabel>
                    <Select
                        value={format}
                        onChange={handleFormatChange}
                        sx={{
                            color: '#FFF',
                            borderColor: '#555',
                            '.MuiOutlinedInput-notchedOutline': { borderColor: '#555' },
                            '&:hover .MuiOutlinedInput-notchedOutline': { borderColor: '#50E3C2' },
                            '& .MuiSvgIcon-root': { color: '#50E3C2' },
                        }}
                    >
                        <MenuItem value="midi">MIDIë¡œ ë³€í™˜</MenuItem>
                        <MenuItem value="wav">WAVë¡œ ë³€í™˜</MenuItem>
                       
                    </Select>
                </FormControl>

                {/* ë³€í™˜ ë²„íŠ¼ */}
                <Button
                    variant="contained"
                    color="primary"
                    size="large"
                    onClick={handleSubmit}
                    disabled={isLoading || !pdfFile}
                    sx={{
                        minWidth: '200px',
                        minHeight: '50px',
                        bgcolor: '#50E3C2',
                        color: '#000',
                        fontWeight: 600,
                        '&:hover': { bgcolor: '#40D9B8' },
                        '&:disabled': { bgcolor: '#333', color: '#666' }
                    }}
                >
                    {isLoading ? (
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                            <CircularProgress size={24} color="inherit" />
                            <span>ì²˜ë¦¬ ì¤‘...</span>
                        </Box>
                    ) : (
                        'ë³€í™˜í•˜ê¸°'
                    )}
                </Button>

                {/* ë¡œë”© ìƒíƒœ í‘œì‹œ */}
                {isLoading && (
                    <Box sx={{ mt: 3 }}>
                        <Typography variant="body2" sx={{ color: '#AAA', mb: 1 }}>
                            ì•…ë³´ë¥¼ ë¶„ì„í•˜ê³  {format.toUpperCase()} í˜•ì‹ìœ¼ë¡œ ë³€í™˜ ì¤‘ì…ë‹ˆë‹¤...
                        </Typography>
                        <Typography variant="caption" sx={{ color: '#666' }}>
                            ìµœëŒ€ 10ë¶„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </Typography>
                    </Box>
                )}
            </Box>
        </Box>
    );
};

export default ScoreToMusic;
</file>

<file path="src/styles/beatpad.css">
/* íŒ¨ë“œ ì»¨í…Œì´ë„ˆ(í¬ê¸°/ë‘¥ê·¼ëª¨ì„œë¦¬/ë°°ê²½) */
.pad-stack {
  position: relative;
  width: 100%;
  height: 320px;          /* í•„ìš”í•˜ë©´ 360px ë“±ìœ¼ë¡œ ë°”ê¿”ë„ ë¨ */
  border-radius: 12px;
  overflow: hidden;
  background: #1b1b1b;
  /* ê¸°ë³¸ ê·¸ë¦¬ë“œ ëŠë‚Œì˜ ë°°ê²½(ì…€ ìˆ˜ì™€ ì •í™•íˆ ì¼ì¹˜í•˜ì§„ ì•Šì§€ë§Œ ë¹ˆ í™”ë©´ ë°©ì§€ìš©) */
  background-image:
    repeating-linear-gradient(0deg, rgba(255,255,255,0.05) 0 1px, transparent 1px 24px),
    repeating-linear-gradient(90deg, rgba(255,255,255,0.05) 0 1px, transparent 1px 24px);
  background-size: 100% 100%;
}

/* ë‘ ìº”ë²„ìŠ¤ëŠ” ë˜í¼ë¥¼ ê½‰ ì±„ì›€ */
.blendpad-canvas,
.blendpad-ghost {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  display: block;
}

/* í´ë¦­/ë“œë˜ê·¸ìš© ìº”ë²„ìŠ¤ */
.blendpad-canvas {
  cursor: crosshair;         /* ì…€ ëª¨ë“œì¼ ë•Œ */
}

/* ê³ ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸°ëŠ” í¬ì¸í„°ë¥¼ ë§‰ì•„ì•¼ í´ë¦­ì´ ì•„ë˜ë¡œ ì „ë‹¬ë¨ */
.blendpad-ghost {
  pointer-events: none;
}

/* (ì„ íƒ) ë‹¤í¬ í…Œë§ˆ ê²½ê³„ ê°•ì¡° */
.pad-stack::after {
  content: '';
  position: absolute;
  inset: 0;
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 12px;
  pointer-events: none;
}

.path-overlay{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:none;          /* ê²½ë¡œ ìº”ë²„ìŠ¤ëŠ” í´ë¦­ ë§‰ì§€ ì•Šë„ë¡ */
  z-index:3;
}
</file>

</files>
